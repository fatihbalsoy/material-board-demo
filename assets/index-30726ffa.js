var vs=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var W=(e,t,r)=>(vs(e,t,"read from private field"),r?r.call(e):t.get(e)),X=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},fe=(e,t,r,s)=>(vs(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);var me=(e,t,r)=>(vs(e,t,"access private method"),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const Po=async(e,{pluginPath:t,pluginName:r},s)=>{s==null||s.tracker.setCaption(`Activating ${r||t}`);const n=[`${await e.documentRoot}/wp-load.php`,`${await e.documentRoot}/wp-admin/includes/plugin.php`];if(!n.every(o=>e.fileExists(o)))throw new Error(`Required WordPress files do not exist: ${n.join(", ")}`);if((await e.run({code:`<?php
define( 'WP_ADMIN', true );
${n.map(o=>`require_once( '${o}' );`).join(`
`)}
$plugin_path = '${t}';
if (!is_dir($plugin_path)) {
	activate_plugin($plugin_path);
	return;
}
// Find plugin entry file
foreach ( ( glob( $plugin_path . '/*.php' ) ?: array() ) as $file ) {
	$info = get_plugin_data( $file, false, false );
	if ( ! empty( $info['Name'] ) ) {
		activate_plugin( $file );
		return;
	}
}
echo 'NO_ENTRY_FILE';
`})).text.endsWith("NO_ENTRY_FILE"))throw new Error("Could not find plugin entry file.")},Eo=async(e,{themeFolderName:t},r)=>{r==null||r.tracker.setCaption(`Activating ${t}`);const s=`${await e.documentRoot}/wp-load.php`;if(!e.fileExists(s))throw new Error(`Required WordPress file does not exist: ${s}`);await e.run({code:`<?php
define( 'WP_ADMIN', true );
require_once( '${s}' );
switch_theme( '${t}' );
`})};function ds(e){const t=e.split(".").shift().replace(/-/g," ");return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}async function yt(e,t,r){let s="";await e.fileExists(t)&&(s=await e.readFileAsText(t)),await e.writeFile(t,r(s))}async function Qi(e){return new Uint8Array(await e.arrayBuffer())}class Xi extends File{constructor(t,r){super(t,r),this.buffers=t}async arrayBuffer(){return this.buffers[0]}}const As=File.prototype.arrayBuffer instanceof Function?File:Xi,Un="/vfs-blueprints",lr=async(e,{consts:t,virtualize:r=!1})=>{const s=await e.documentRoot,n=r?Un:s,o=`${n}/playground-consts.json`,i=`${n}/wp-config.php`;return r&&(e.mkdir(Un),e.setPhpIniEntry("auto_prepend_file",i)),await yt(e,o,l=>JSON.stringify({...JSON.parse(l||"{}"),...t})),await yt(e,i,l=>l.includes("playground-consts.json")?l:`<?php
	$consts = json_decode(file_get_contents('${o}'), true);
	foreach ($consts as $const => $value) {
		if (!defined($const)) {
			define($const, $value);
		}
	}
?>${l}`),i},ea=`<?php

/**
 * This transport delegates PHP HTTP requests to JavaScript synchronous XHR.
 *
 * This file isn't actually used. It's just here for reference and development. The actual
 * PHP code used in WordPress is hardcoded copy residing in wordpress.mjs in the _patchWordPressCode
 * function.
 *
 * @TODO Make the build pipeline use this exact file instead of creating it
 *       from within the JavaScript runtime.
 */

class Requests_Transport_Fetch implements Requests_Transport
{
	public $headers = '';

	public function __construct()
	{
	}

	public function __destruct()
	{
	}

	/**
	 * Delegates PHP HTTP requests to JavaScript synchronous XHR.
	 *
	 * @TODO Implement handling for more $options such as cookies, filename, auth, etc.
	 *
	 * @param $url
	 * @param $headers
	 * @param $data
	 * @param $options
	 *
	 * @return false|string
	 */
	public function request($url, $headers = array(), $data = array(), $options = array())
	{
		// Disable wp-cron requests that are extremely slow in node.js runtime environment.
		// @TODO: Make wp-cron requests faster.
		if (str_contains($url, '/wp-cron.php')) {
			return false;
		}

		$headers = Requests::flatten($headers);
		if (!empty($data)) {
			$data_format = $options['data_format'];
			if ($data_format === 'query') {
				$url  = self::format_get($url, $data);
				$data = '';
			} elseif (!is_string($data)) {
				$data = http_build_query($data, null, '&');
			}
		}

		$request = json_encode(json_encode(array(
			'headers' => $headers,
			'data'    => $data,
			'url'     => $url,
			'method'  => $options['type'],
		)));

		$js = <<<JAVASCRIPT
const request = JSON.parse({$request});
console.log("Requesting " + request.url);
const xhr = new XMLHttpRequest();
xhr.open(
	request.method,
	request.url,
	false // false makes the xhr synchronous
);
for ( var name in request.headers ) {
	xhr.setRequestHeader(name, request.headers[name]);
}
xhr.send(request.data);

[
	"HTTP/1.1 " + xhr.status + " " + xhr.statusText,
	xhr.getAllResponseHeaders(),
	"",
	xhr.responseText
].join("\\\\r\\\\n");
JAVASCRIPT;

		$this->headers = vrzno_eval($js);

		return $this->headers;
	}

	public function request_multiple($requests, $options)
	{
		$responses = array();
		$class     = get_class($this);
		foreach ($requests as $id => $request) {
			try {
				$handler          = new $class();
				$responses[$id] = $handler->request($request['url'], $request['headers'], $request['data'], $request['options']);
				$request['options']['hooks']->dispatch('transport.internal.parse_response', array(&$responses[$id], $request));
			} catch (Requests_Exception $e) {
				$responses[$id] = $e;
			}
			if (!is_string($responses[$id])) {
				$request['options']['hooks']->dispatch('multiple.request.complete', array(&$responses[$id], $id));
			}
		}

		return $responses;
	}

	protected static function format_get($url, $data)
	{
		if (!empty($data)) {
			$query     = '';
			$url_parts = parse_url($url);
			if (empty($url_parts['query'])) {
				$url_parts['query'] = '';
			} else {
				$query = $url_parts['query'];
			}
			$query .= '&' . http_build_query($data, null, '&');
			$query = trim($query, '&');
			if (empty($url_parts['query'])) {
				$url .= '?' . $query;
			} else {
				$url = str_replace($url_parts['query'], $query, $url);
			}
		}

		return $url;
	}

	public static function test($capabilities = array())
	{
		if (!function_exists('vrzno_eval')) {
			return false;
		}

		if (vrzno_eval("typeof XMLHttpRequest;") !== 'function') {
			return false;
		}

		return true;
	}
}
`,ta=`<?php

/**
 * This transport does not perform any HTTP requests and only exists
 * to prevent the Requests class from complaining about not having any
 * transports.
 */
class Requests_Transport_Dummy implements Requests_Transport
{
	public $headers = '';

	public function __construct()
	{
	}

	public function __destruct()
	{
	}

	public function request($url, $headers = array(), $data = array(), $options = array())
	{
		return false;
	}

	public function request_multiple($requests, $options)
	{
		$responses = array();
		foreach ($requests as $id => $request) {
			$responses[] = false;
		}
		return $responses;
	}

	protected static function format_get($url, $data)
	{
		return $url;
	}

	public static function test($capabilities = array())
	{
		return true;
	}
}
`,ra=`<?php
/**
 * The default WordPress requests transports have been disabled
 * at this point. However, the Requests class requires at least
 * one working transport or else it throws warnings and acts up.
 * 
 * This mu-plugin provides that transport. It's one of the two:
 * 
 * * Requests_Transport_Fetch – Sends requests using browser's fetch() function.
 *                              Only enabled when PHP was compiled with the VRZNO
 * 								extension.
 * * Requests_Transport_Dummy – Does not send any requests and only exists to keep
 * 								the Requests class happy.
 */
if (defined('USE_FETCH_FOR_REQUESTS') && USE_FETCH_FOR_REQUESTS) {
    require(__DIR__ . '/includes/requests_transport_fetch.php');
	Requests::add_transport('Requests_Transport_Fetch');
	add_filter('http_request_host_is_external', function ($arg) {
		return true;
	});
} else {
    require(__DIR__ . '/includes/requests_transport_dummy.php');
    Requests::add_transport('Requests_Transport_Dummy');
}
`,sa=`<?php
/**
 * Add a notice to wp-login.php offering the username and password.
 */

add_action(
	'login_message',
	function() {
		return <<<EOT
<div class="message info">
	<strong>username:</strong> <code>admin</code><br /><strong>password</strong>: <code>password</code>
</div>
EOT;
	}
);
`,na=`<?php
/**
 * Because the in-browser Playground doesn't have access to the internet, 
 * network-dependent features like directories don't work. Normally, you'll 
 * see a confusing message like "An unexpected error occurred." This mu-plugin
 * makes it more clear that the feature is not yet supported.
 * 
 * https://github.com/WordPress/wordpress-playground/issues/498
 */

add_filter( 'plugins_api_result', function( $res ) {
    if($res instanceof WP_Error) {
        $res = new WP_Error(
            'plugins_api_failed',
            'Playground <a href="https://github.com/WordPress/wordpress-playground/issues/85">does not yet support</a> connecting to the plugin directory yet. You can still upload plugins or install them using the <a href="https://wordpress.github.io/wordpress-playground/query-api">Query API</a> (e.g. ?plugin=coblocks).'
        );
    }
    return $res;
} );

add_filter( 'gettext', function( $translation ) {
    // There is no better hook for swapping the error message
    // on the themes page, unfortunately.
    global $pagenow;

    // Only change the message on /wp-admin/theme-install.php
    if( 'theme-install.php' !== $pagenow ) {
        return $translation;
    }

    if($translation === 'An unexpected error occurred. Something may be wrong with WordPress.org or this server&#8217;s configuration. If you continue to have problems, please try the <a href="%s">support forums</a>.') {
        return 'Playground <a href="https://github.com/WordPress/wordpress-playground/issues/85">does not yet support</a> connecting to the themes directory yet. You can still upload a theme or install it using the <a href="https://wordpress.github.io/wordpress-playground/query-api">Query API</a> (e.g. ?theme=pendant).';
    }
    return $translation;
} );
`,oa=`<?php
/**
 * Links with target="top" don't work in the playground iframe because of
 * the sandbox attribute. What they really should be targeting is the
 * playground iframe itself (name="playground"). This mu-plugin rewrites
 * all target="_top" links to target="playground" instead.
 * 
 * https://github.com/WordPress/wordpress-playground/issues/266
 */

add_action('admin_print_scripts', function () {
    ?>
    <script>
        document.addEventListener('click', function (event) {
            if (event.target.tagName === 'A' && ['_parent', '_top'].includes(event.target.target)) {
                event.target.target = 'wordpress-playground';
            }
        });
    <\/script>
    <?php
});
`,ia=async(e,t)=>{const r=new aa(e,t.wordpressPath||"/wordpress",t.siteUrl);t.addPhpInfo===!0&&await r.addPhpInfo(),t.siteUrl&&await r.patchSiteUrl(),t.patchSecrets===!0&&await r.patchSecrets(),t.disableSiteHealth===!0&&await r.disableSiteHealth(),t.disableWpNewBlogNotification===!0&&await r.disableWpNewBlogNotification(),t.makeEditorFrameControlled===!0&&await So(e,r.wordpressPath,[`${r.wordpressPath}/wp-includes/js/dist/block-editor.js`,`${r.wordpressPath}/wp-includes/js/dist/block-editor.min.js`]),t.prepareForRunningInsideWebBrowser===!0&&await r.prepareForRunningInsideWebBrowser()};class aa{constructor(t,r,s){this.php=t,this.scopedSiteUrl=s,this.wordpressPath=r}async addPhpInfo(){await this.php.writeFile(`${this.wordpressPath}/phpinfo.php`,"<?php phpinfo(); ")}async patchSiteUrl(){await lr(this.php,{consts:{WP_HOME:this.scopedSiteUrl,WP_SITEURL:this.scopedSiteUrl},virtualize:!0})}async patchSecrets(){await lr(this.php,{consts:{AUTH_KEY:Ye(40),SECURE_AUTH_KEY:Ye(40),LOGGED_IN_KEY:Ye(40),NONCE_KEY:Ye(40),AUTH_SALT:Ye(40),SECURE_AUTH_SALT:Ye(40),LOGGED_IN_SALT:Ye(40),NONCE_SALT:Ye(40)}}),await yt(this.php,`${this.wordpressPath}/wp-config.php`,t=>t.replaceAll("', 'put your unique phrase here'","__', ''"))}async disableSiteHealth(){await yt(this.php,`${this.wordpressPath}/wp-includes/default-filters.php`,t=>t.replace(/add_filter[^;]+wp_maybe_grant_site_health_caps[^;]+;/i,""))}async disableWpNewBlogNotification(){await yt(this.php,`${this.wordpressPath}/wp-config.php`,t=>`${t} function wp_new_blog_notification(...$args){} `)}async prepareForRunningInsideWebBrowser(){await lr(this.php,{consts:{USE_FETCH_FOR_REQUESTS:!1}});const t=[`${this.wordpressPath}/wp-includes/Requests/Transport/fsockopen.php`,`${this.wordpressPath}/wp-includes/Requests/Transport/cURL.php`];for(const r of t)await this.php.fileExists(r)&&await yt(this.php,r,s=>s.replace("public static function test","public static function test( $capabilities = array() ) { return false; } public static function test2"));await this.php.mkdirTree(`${this.wordpressPath}/wp-content/mu-plugins/includes`),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/includes/requests_transport_fetch.php`,ea),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/includes/requests_transport_dummy.php`,ta),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/add_requests_transport.php`,ra),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/1-show-admin-credentials-on-wp-login.php`,sa),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/2-nice-error-messages-for-plugins-and-themes-directories.php`,na),await this.php.writeFile(`${this.wordpressPath}/wp-content/mu-plugins/3-links-targeting-top-frame-should-target-playground-iframe.php`,oa)}}function Ye(e){const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+=-[]/.,<>?";let r="";for(let s=e;s>0;--s)r+=t[Math.floor(Math.random()*t.length)];return r}async function So(e,t,r){const s=`
	/**
	 * A synchronous function to read a blob URL as text.
	 * 
	 * @param {string} url 
	 * @returns {string}
	 */
	const __playground_readBlobAsText = function (url) {
		try {
		  let xhr = new XMLHttpRequest();
		  xhr.open('GET', url, false);
		  xhr.overrideMimeType('text/plain;charset=utf-8');
		  xhr.send();
		  return xhr.responseText;
		} catch(e) {
		  return '';
		} finally {
		  URL.revokeObjectURL(url);
		}
	}
	
	window.__playground_ControlledIframe = window.wp.element.forwardRef(function (props, ref) {
		const source = window.wp.element.useMemo(function () {
			if (props.srcDoc) {
				// WordPress <= 6.2 uses a srcDoc that only contains a doctype.
				return '/wp-includes/empty.html';
			} else if (props.src && props.src.startsWith('blob:')) {
				// WordPress 6.3 uses a blob URL with doctype and a list of static assets.
				// Let's pass the document content to empty.html and render it there.
				return '/wp-includes/empty.html#' + encodeURIComponent(__playground_readBlobAsText(props.src));
			} else {
				// WordPress >= 6.4 uses a plain HTTPS URL that needs no correction.
				return props.src;
			}
		}, [props.src]);
		return (
			window.wp.element.createElement('iframe', {
				...props,
				ref: ref,
				src: source,
				// Make sure there's no srcDoc, as it would interfere with the src.
				srcDoc: undefined
			})
		)
	});`;for(const n of r)await e.fileExists(n)&&await yt(e,n,o=>`${s} ${o.replace(/\(\s*"iframe",/,"(__playground_ControlledIframe,")}`);await e.writeFile(`${t}/wp-includes/empty.html`,"<!doctype html><script>const hash = window.location.hash.substring(1); if ( hash ) document.write(decodeURIComponent(hash))<\/script>")}const ca=async(e,{code:t})=>await e.run({code:t}),la=async(e,{options:t})=>await e.run(t),ua=async(e,{key:t,value:r})=>{await e.setPhpIniEntry(t,r)},pa=async(e,{request:t})=>await e.request(t),da=async(e,{fromPath:t,toPath:r})=>{await e.writeFile(r,await e.readFileAsBuffer(t))},ha=async(e,{fromPath:t,toPath:r})=>{await e.mv(t,r)},fa=async(e,{path:t})=>{await e.unlink(t)},ma=async(e,{path:t})=>{await e.mkdir(t)},ya=async(e,{path:t})=>{await e.rmdir(t)},To=async(e,{path:t,data:r})=>{r instanceof File&&(r=await Qi(r)),await e.writeFile(t,r)},ga=async(e,{siteUrl:t})=>await lr(e,{consts:{WP_HOME:t,WP_SITEURL:t}});class ko{constructor({concurrency:t}){this._running=0,this.concurrency=t,this.queue=[]}get running(){return this._running}async acquire(){for(;;)if(this._running>=this.concurrency)await new Promise(t=>this.queue.push(t));else{this._running++;let t=!1;return()=>{t||(t=!0,this._running--,this.queue.length>0&&this.queue.shift()())}}}async run(t){const r=await this.acquire();try{return await t()}finally{r()}}}const wa=Symbol("literal");function Kt(e){if(typeof e=="string")return e.startsWith("$")?e:JSON.stringify(e);if(typeof e=="number")return e.toString();if(Array.isArray(e))return`array(${e.map(Kt).join(", ")})`;if(e===null)return"null";if(typeof e=="object")return wa in e?e.toString():`array(${Object.entries(e).map(([t,r])=>`${JSON.stringify(t)} => ${Kt(r)}`).join(", ")})`;if(typeof e=="function")return e();throw new Error(`Unsupported value: ${e}`)}function Ds(e){const t={};for(const r in e)t[r]=Kt(e[r]);return t}const Fn=`<?php

function zipDir($dir, $output, $additionalFiles = array())
{
    $zip = new ZipArchive;
    $res = $zip->open($output, ZipArchive::CREATE);
    if ($res === TRUE) {
        foreach ($additionalFiles as $file) {
            $zip->addFile($file);
        }
        $directories = array(
            rtrim($dir, '/') . '/'
        );
        while (sizeof($directories)) {
            $dir = array_pop($directories);

            if ($handle = opendir($dir)) {
                while (false !== ($entry = readdir($handle))) {
                    if ($entry == '.' || $entry == '..') {
                        continue;
                    }

                    $entry = $dir . $entry;

                    if (is_dir($entry)) {
                        $directory_path = $entry . '/';
                        array_push($directories, $directory_path);
                    } else if (is_file($entry)) {
                        $zip->addFile($entry);
                    }
                }
                closedir($handle);
            }
        }
        $zip->close();
        chmod($output, 0777);
    }
}

function unzip($zipPath, $extractTo, $overwrite = true)
{
    if(!is_dir($extractTo)) {
        mkdir($extractTo, 0777, true);
    }
    $zip = new ZipArchive;
    $res = $zip->open($zipPath);
    if ($res === TRUE) {
        $zip->extractTo($extractTo);
        $zip->close();
        chmod($extractTo, 0777);
    }
}


function delTree($dir)
{
    $files = array_diff(scandir($dir), array('.', '..'));
    foreach ($files as $file) {
        (is_dir("$dir/$file")) ? delTree("$dir/$file") : unlink("$dir/$file");
    }
    return rmdir($dir);
}
`;async function va(e){const t="wordpress-playground.zip",r=`/tmp/${t}`,s=Ds({zipPath:r,documentRoot:await e.documentRoot});await Co(e,`zipDir(${s.documentRoot}, ${s.zipPath});`);const n=await e.readFileAsBuffer(r);return e.unlink(r),new File([n],t)}const $a=async(e,{fullSiteZip:t})=>{const r="/import.zip";await e.writeFile(r,new Uint8Array(await t.arrayBuffer()));const s=await e.absoluteUrl,n=await e.documentRoot;await e.rmdir(n),await Ms(e,{zipPath:r,extractToPath:"/"});const o=Ds({absoluteUrl:s});await Pa(e,`${n}/wp-config.php`,i=>`<?php
			if(!defined('WP_HOME')) {
				define('WP_HOME', ${o.absoluteUrl});
				define('WP_SITEURL', ${o.absoluteUrl});
			}
			?>${i}`)},Ms=async(e,{zipPath:t,extractToPath:r})=>{const s=Ds({zipPath:t,extractToPath:r});await Co(e,`unzip(${s.zipPath}, ${s.extractToPath});`)},ba=async(e,{file:t})=>{var l;const r=await e.request({url:"/wp-admin/admin.php?import=wordpress"}),s=(l=Ln(r).getElementById("import-upload-form"))==null?void 0:l.getAttribute("action"),n=await e.request({url:`/wp-admin/${s}`,method:"POST",files:{import:t}}),o=Ln(n).querySelector("#wpbody-content form");if(!o)throw console.log(n.text),new Error("Could not find an importer form in response. See the response text above for details.");const i=_a(o);i.fetch_attachments="1";for(const f in i)if(f.startsWith("user_map[")){const u="user_new["+f.slice(9,-1)+"]";i[u]="1"}await e.request({url:o.action,method:"POST",formData:i})};function Ln(e){return new DOMParser().parseFromString(e.text,"text/html")}function _a(e){return Object.fromEntries(new FormData(e).entries())}async function Pa(e,t,r){await e.writeFile(t,r(await e.readFileAsText(t)))}async function Co(e,t){const r=await e.run({code:Fn+t});if(r.exitCode!==0)throw console.log(Fn+t),console.log(t+""),console.log(r.errors),r.errors;return r}async function No(e,{targetPath:t,zipFile:r}){const s=r.name,n=s.replace(/\.zip$/,""),o=`/tmp/assets/${n}`,i=`/tmp/${s}`,l=()=>e.rmdir(o,{recursive:!0});await e.fileExists(o)&&await l(),await To(e,{path:i,data:r});const f=()=>Promise.all([l,()=>e.unlink(i)]);try{await Ms(e,{zipPath:i,extractToPath:o});const u=await e.listFiles(o,{prependPath:!0}),d=u.length===1&&await e.isDir(u[0]);let m,$="";d?($=u[0],m=u[0].split("/").pop()):($=o,m=n);const x=`${t}/${m}`;return await e.mv($,x),await f(),{assetFolderPath:x,assetFolderName:m}}catch(u){throw await f(),u}}const Ea=async(e,{pluginZipFile:t,options:r={}},s)=>{const n=t.name.split("/").pop()||"plugin.zip",o=ds(n);s==null||s.tracker.setCaption(`Installing the ${o} plugin`);try{const{assetFolderPath:i}=await No(e,{zipFile:t,targetPath:`${await e.documentRoot}/wp-content/plugins`});(!("activate"in r)||r.activate)&&await Po(e,{pluginPath:i,pluginName:o},s),await Sa(e)}catch(i){console.error(`Proceeding without the ${o} plugin. Could not install it in wp-admin. The original error was: ${i}`),console.error(i)}};async function Sa(e){await e.isDir("/wordpress/wp-content/plugins/gutenberg")&&!await e.fileExists("/wordpress/.gutenberg-patched")&&(await e.writeFile("/wordpress/.gutenberg-patched","1"),await So(e,"/wordpress",["/wordpress/wp-content/plugins/gutenberg/build/block-editor/index.js","/wordpress/wp-content/plugins/gutenberg/build/block-editor/index.min.js"]))}const Ta=async(e,{themeZipFile:t,options:r={}},s)=>{const n=ds(t.name);s==null||s.tracker.setCaption(`Installing the ${n} theme`);try{const{assetFolderName:o}=await No(e,{zipFile:t,targetPath:`${await e.documentRoot}/wp-content/themes`});(!("activate"in r)||r.activate)&&await Eo(e,{themeFolderName:o},s)}catch(o){console.error(`Proceeding without the ${n} theme. Could not install it in wp-admin. The original error was: ${o}`),console.error(o)}},ka=async(e,{username:t="admin",password:r="password"}={},s)=>{s==null||s.tracker.setCaption((s==null?void 0:s.initialCaption)||"Logging in"),await e.request({url:"/wp-login.php"}),await e.request({url:"/wp-login.php",method:"POST",formData:{log:t,pwd:r,rememberme:"forever"}})},Ca=async(e,{options:t})=>{await e.request({url:"/wp-admin/install.php?step=2",method:"POST",formData:{language:"en",prefix:"wp_",weblog_title:"My WordPress Website",user_name:t.adminPassword||"admin",admin_password:t.adminPassword||"password",admin_password2:t.adminPassword||"password",Submit:"Install WordPress",pw_weak:"1",admin_email:"admin@localhost.com"}})},Na=async(e,{options:t})=>{const r=`<?php
	include 'wordpress/wp-load.php';
	$site_options = ${Kt(t)};
	foreach($site_options as $name => $value) {
		update_option($name, $value);
	}
	echo "Success";
	`,s=await e.run({code:r});return jo(s),{code:r,result:s}},ja=async(e,{meta:t,userId:r})=>{const s=`<?php
	include 'wordpress/wp-load.php';
	$meta = ${Kt(t)};
	foreach($meta as $name => $value) {
		update_user_meta(${Kt(r)}, $name, $value);
	}
	echo "Success";
	`,n=await e.run({code:s});return jo(n),{code:s,result:n}};async function jo(e){if(e.text!=="Success")throw console.log(e),new Error(`Failed to run code: ${e.text} ${e.errors}`)}const xa=Object.freeze(Object.defineProperty({__proto__:null,activatePlugin:Po,activateTheme:Eo,applyWordPressPatches:ia,cp:da,defineSiteUrl:ga,defineWpConfigConsts:lr,importFile:ba,installPlugin:Ea,installTheme:Ta,login:ka,mkdir:ma,mv:ha,replaceSite:$a,request:pa,rm:fa,rmdir:ya,runPHP:ca,runPHPWithOptions:la,runWpInstallationWizard:Ca,setPhpIniEntry:ua,setSiteOptions:Na,unzip:Ms,updateUserMeta:ja,writeFile:To,zipEntireSite:va},Symbol.toStringTag,{value:"Module"})),Ra=5*1024*1024;function Oa(e,t){const r=e.headers.get("content-length")||"",s=parseInt(r,10)||Ra;function n(o,i){t(new CustomEvent("progress",{detail:{loaded:o,total:i}}))}return new Response(new ReadableStream({async start(o){if(!e.body){o.close();return}const i=e.body.getReader();let l=0;for(;;)try{const{done:f,value:u}=await i.read();if(u&&(l+=u.byteLength),f){n(l,l),o.close();break}else n(l,s),o.enqueue(u)}catch(f){console.error({e:f}),o.error(f);break}}}),{status:e.status,statusText:e.statusText,headers:e.headers})}const $s=1e-5;class hs extends EventTarget{constructor({weight:t=1,caption:r="",fillTime:s=4}={}){super(),this._selfWeight=1,this._selfDone=!1,this._selfProgress=0,this._selfCaption="",this._isFilling=!1,this._subTrackers=[],this._weight=t,this._selfCaption=r,this._fillTime=s}stage(t,r=""){if(t||(t=this._selfWeight),this._selfWeight-t<-$s)throw new Error(`Cannot add a stage with weight ${t} as the total weight of registered stages would exceed 1.`);this._selfWeight-=t;const s=new hs({caption:r,weight:t,fillTime:this._fillTime});return this._subTrackers.push(s),s.addEventListener("progress",()=>this.notifyProgress()),s.addEventListener("done",()=>{this.done&&this.notifyDone()}),s}fillSlowly({stopBeforeFinishing:t=!0}={}){if(this._isFilling)return;this._isFilling=!0;const r=100,s=this._fillTime/r;this._fillInterval=setInterval(()=>{this.set(this._selfProgress+1),t&&this._selfProgress>=99&&clearInterval(this._fillInterval)},s)}set(t){this._selfProgress=Math.min(t,100),this.notifyProgress(),this._selfProgress+$s>=100&&this.finish()}finish(){this._fillInterval&&clearInterval(this._fillInterval),this._selfDone=!0,this._selfProgress=100,this._isFilling=!1,this._fillInterval=void 0,this.notifyProgress(),this.notifyDone()}get caption(){for(let t=this._subTrackers.length-1;t>=0;t--)if(!this._subTrackers[t].done){const r=this._subTrackers[t].caption;if(r)return r}return this._selfCaption}setCaption(t){this._selfCaption=t,this.notifyProgress()}get done(){return this.progress+$s>=100}get progress(){if(this._selfDone)return 100;const t=this._subTrackers.reduce((r,s)=>r+s.progress*s.weight,this._selfProgress*this._selfWeight);return Math.round(t*1e4)/1e4}get weight(){return this._weight}get observer(){return this._progressObserver||(this._progressObserver=t=>{this.set(t)}),this._progressObserver}get loadingListener(){return this._loadingListener||(this._loadingListener=t=>{this.set(t.detail.loaded/t.detail.total*100)}),this._loadingListener}pipe(t){t.setProgress({progress:this.progress,caption:this.caption}),this.addEventListener("progress",r=>{t.setProgress({progress:r.detail.progress,caption:r.detail.caption})}),this.addEventListener("done",()=>{t.setLoaded()})}addEventListener(t,r){super.addEventListener(t,r)}removeEventListener(t,r){super.removeEventListener(t,r)}notifyProgress(){const t=this;this.dispatchEvent(new CustomEvent("progress",{detail:{get progress(){return t.progress},get caption(){return t.caption}}}))}notifyDone(){this.dispatchEvent(new CustomEvent("done"))}}const zn=Symbol("error"),Hn=Symbol("message");class Us extends Event{constructor(t,r={}){super(t),this[zn]=r.error===void 0?null:r.error,this[Hn]=r.message===void 0?"":r.message}get error(){return this[zn]}get message(){return this[Hn]}}Object.defineProperty(Us.prototype,"error",{enumerable:!0});Object.defineProperty(Us.prototype,"message",{enumerable:!0});const Ia=typeof globalThis.ErrorEvent=="function"?globalThis.ErrorEvent:Us;function qa(e){return e instanceof Error?"exitCode"in e&&(e==null?void 0:e.exitCode)===0||(e==null?void 0:e.name)==="ExitStatus"&&"status"in e&&e.status===0:!1}class Aa extends EventTarget{constructor(){super(...arguments),this.listenersCount=0}addEventListener(t,r){++this.listenersCount,super.addEventListener(t,r)}removeEventListener(t,r){--this.listenersCount,super.removeEventListener(t,r)}hasListeners(){return this.listenersCount>0}}function Da(e){e.asm={...e.asm};const t=new Aa;for(const r in e.asm)if(typeof e.asm[r]=="function"){const s=e.asm[r];e.asm[r]=function(...n){var o;try{return s(...n)}catch(i){if(!(i instanceof Error))throw i;const l=Ua(i,(o=e.lastAsyncifyStackSource)==null?void 0:o.stack);if(e.lastAsyncifyStackSource&&(i.cause=e.lastAsyncifyStackSource),t.hasListeners()){t.dispatchEvent(new Ia("error",{error:i,message:l}));return}throw qa(i)||za(l),i}}}return t}let ks=[];function Ma(){return ks}function Ua(e,t){if(e.message==="unreachable"){let r=Fa;t||(r+=`

This stack trace is lacking. For a better one initialize 
the PHP runtime with { debug: true }, e.g. PHPNode.load('8.1', { debug: true }).

`),ks=Ha(t||e.stack||"");for(const s of ks)r+=`    * ${s}
`;return r}return e.message}const Fa=`
"unreachable" WASM instruction executed.

The typical reason is a PHP function missing from the ASYNCIFY_ONLY
list when building PHP.wasm.

You will need to file a new issue in the WordPress Playground repository
and paste this error message there:

https://github.com/WordPress/wordpress-playground/issues/new

If you're a core developer, the typical fix is to:

* Isolate a minimal reproduction of the error
* Add a reproduction of the error to php-asyncify.spec.ts in the WordPress Playground repository
* Run 'npm run fix-asyncify'
* Commit the changes, push to the repo, release updated NPM packages

Below is a list of all the PHP functions found in the stack trace to
help with the minimal reproduction. If they're all already listed in
the Dockerfile, you'll need to trigger this error again with long stack
traces enabled. In node.js, you can do it using the --stack-trace-limit=100
CLI option: 

`,Vn="\x1B[41m",La="\x1B[1m",Wn="\x1B[0m",Kn="\x1B[K";let Bn=!1;function za(e){if(!Bn){Bn=!0,console.log(`${Vn}
${Kn}
${La}  WASM ERROR${Wn}${Vn}`);for(const t of e.split(`
`))console.log(`${Kn}  ${t} `);console.log(`${Wn}`)}}function Ha(e){try{const t=e.split(`
`).slice(1).map(r=>{const s=r.trim().substring(3).split(" ");return{fn:s.length>=2?s[0]:"<unknown>",isWasm:r.includes("wasm://")}}).filter(({fn:r,isWasm:s})=>s&&!r.startsWith("dynCall_")&&!r.startsWith("invoke_")).map(({fn:r})=>r);return Array.from(new Set(t))}catch{return[]}}class bt{constructor(t,r,s,n="",o=0){this.httpStatusCode=t,this.headers=r,this.bytes=s,this.exitCode=o,this.errors=n}static fromRawData(t){return new bt(t.httpStatusCode,t.headers,t.bytes,t.errors,t.exitCode)}toRawData(){return{headers:this.headers,bytes:this.bytes,errors:this.errors,exitCode:this.exitCode,httpStatusCode:this.httpStatusCode}}get json(){return JSON.parse(this.text)}get text(){return new TextDecoder().decode(this.bytes)}}const xo=["8.2","8.1","8.0","7.4","7.3","7.2","7.1","7.0","5.6"],Va=xo[0],Ro=["iconv","mbstring","xml-bundle","gd"],Gn={"kitchen-sink":Ro};var gt,Ft,Jr,Oo,Zr,Io;class Wa{constructor(t,r={}){X(this,Jr);X(this,Zr);X(this,gt,void 0);X(this,Ft,void 0);this.requestHandler=t,fe(this,gt,{}),fe(this,Ft,{handleRedirects:!1,maxRedirects:4,...r})}async request(t,r=0){const s=await this.requestHandler.request({...t,headers:{...t.headers,cookie:me(this,Zr,Io).call(this)}});if(s.headers["set-cookie"]&&me(this,Jr,Oo).call(this,s.headers["set-cookie"]),W(this,Ft).handleRedirects&&s.headers.location&&r<W(this,Ft).maxRedirects){const n=new URL(s.headers.location[0],this.requestHandler.absoluteUrl);return this.request({url:n.toString(),method:"GET",headers:{}},r+1)}return s}pathToInternalUrl(t){return this.requestHandler.pathToInternalUrl(t)}internalUrlToPath(t){return this.requestHandler.internalUrlToPath(t)}get absoluteUrl(){return this.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.documentRoot}}gt=new WeakMap,Ft=new WeakMap,Jr=new WeakSet,Oo=function(t){for(const r of t)try{if(!r.includes("="))continue;const s=r.indexOf("="),n=r.substring(0,s),o=r.substring(s+1).split(";")[0];W(this,gt)[n]=o}catch(s){console.error(s)}},Zr=new WeakSet,Io=function(){const t=[];for(const r in W(this,gt))t.push(`${r}=${W(this,gt)[r]}`);return t.join("; ")};const Ka="http://example.com";function Jn(e){return e.toString().substring(e.origin.length)}function Zn(e,t){return!t||!e.startsWith(t)?e:e.substring(t.length)}function Ba(e,t){return!t||e.startsWith(t)?e:t+e}var ze,Lt,gr,wt,zt,He,Ht,Vt,Yr,qo,Qr,Ao,Xr,Do;class Ga{constructor(t,r={}){X(this,Yr);X(this,Qr);X(this,Xr);X(this,ze,void 0);X(this,Lt,void 0);X(this,gr,void 0);X(this,wt,void 0);X(this,zt,void 0);X(this,He,void 0);X(this,Ht,void 0);X(this,Vt,void 0);fe(this,Vt,new ko({concurrency:1}));const{documentRoot:s="/www/",absoluteUrl:n=typeof location=="object"?location==null?void 0:location.href:""}=r;this.php=t,fe(this,ze,s);const o=new URL(n);fe(this,gr,o.hostname),fe(this,wt,o.port?Number(o.port):o.protocol==="https:"?443:80),fe(this,Lt,(o.protocol||"").replace(":",""));const i=W(this,wt)!==443&&W(this,wt)!==80;fe(this,zt,[W(this,gr),i?`:${W(this,wt)}`:""].join("")),fe(this,He,o.pathname.replace(/\/+$/,"")),fe(this,Ht,[`${W(this,Lt)}://`,W(this,zt),W(this,He)].join(""))}pathToInternalUrl(t){return`${this.absoluteUrl}${t}`}internalUrlToPath(t){const r=new URL(t);return r.pathname.startsWith(W(this,He))&&(r.pathname=r.pathname.slice(W(this,He).length)),Jn(r)}get isRequestRunning(){return W(this,Vt).running>0}get absoluteUrl(){return W(this,Ht)}get documentRoot(){return W(this,ze)}async request(t){const r=t.url.startsWith("http://")||t.url.startsWith("https://"),s=new URL(t.url,r?void 0:Ka),n=Zn(s.pathname,W(this,He)),o=`${W(this,ze)}${n}`;return Ya(o)?await me(this,Qr,Ao).call(this,t,s):me(this,Yr,qo).call(this,o)}}ze=new WeakMap,Lt=new WeakMap,gr=new WeakMap,wt=new WeakMap,zt=new WeakMap,He=new WeakMap,Ht=new WeakMap,Vt=new WeakMap,Yr=new WeakSet,qo=function(t){if(!this.php.fileExists(t))return new bt(404,{"x-file-type":["static"]},new TextEncoder().encode("404 File not found"));const r=this.php.readFileAsBuffer(t);return new bt(200,{"content-length":[`${r.byteLength}`],"content-type":[Za(t)],"accept-ranges":["bytes"],"cache-control":["public, max-age=0"]},r)},Qr=new WeakSet,Ao=async function(t,r){var n;const s=await W(this,Vt).acquire();try{this.php.addServerGlobalEntry("DOCUMENT_ROOT",W(this,ze)),this.php.addServerGlobalEntry("HTTPS",W(this,Ht).startsWith("https://")?"on":"");let o="GET";const i={host:W(this,zt),...Zo(t.headers||{})},l=[];if(t.files&&Object.keys(t.files).length){o="POST";for(const d in t.files){const m=t.files[d];l.push({key:d,name:m.name,type:m.type,data:new Uint8Array(await m.arrayBuffer())})}(n=i["content-type"])!=null&&n.startsWith("multipart/form-data")&&(t.formData=Ja(t.body||""),i["content-type"]="application/x-www-form-urlencoded",delete t.body)}let f;t.formData!==void 0?(o="POST",i["content-type"]=i["content-type"]||"application/x-www-form-urlencoded",f=new URLSearchParams(t.formData).toString()):f=t.body;let u;try{u=me(this,Xr,Do).call(this,r.pathname)}catch{return new bt(404,{},new TextEncoder().encode("404 File not found"))}return await this.php.run({relativeUri:Ba(Jn(r),W(this,He)),protocol:W(this,Lt),method:t.method||o,body:f,fileInfos:l,scriptPath:u,headers:i})}finally{s()}},Xr=new WeakSet,Do=function(t){let r=Zn(t,W(this,He));r.includes(".php")?r=r.split(".php")[0]+".php":(r.endsWith("/")||(r+="/"),r.endsWith("index.php")||(r+="index.php"));const s=`${W(this,ze)}${r}`;if(this.php.fileExists(s))return s;if(!this.php.fileExists(`${W(this,ze)}/index.php`))throw new Error(`File not found: ${s}`);return`${W(this,ze)}/index.php`};function Ja(e){const t={},r=e.match(/--(.*)\r\n/);if(!r)return t;const s=r[1],n=e.split(`--${s}`);return n.shift(),n.pop(),n.forEach(o=>{const i=o.indexOf(`\r
\r
`),l=o.substring(0,i).trim(),f=o.substring(i+4).trim(),u=l.match(/name="([^"]+)"/);if(u){const d=u[1];t[d]=f}}),t}function Za(e){switch(e.split(".").pop()){case"css":return"text/css";case"js":return"application/javascript";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"svg":return"image/svg+xml";case"woff":return"font/woff";case"woff2":return"font/woff2";case"ttf":return"font/ttf";case"otf":return"font/otf";case"eot":return"font/eot";case"ico":return"image/x-icon";case"html":return"text/html";case"json":return"application/json";case"xml":return"application/xml";case"txt":case"md":return"text/plain";default:return"application-octet-stream"}}function Ya(e){return Qa(e)||Xa(e)}function Qa(e){return e.endsWith(".php")||e.includes(".php/")}function Xa(e){return!e.split("/").pop().includes(".")}const Yn={0:"No error occurred. System call completed successfully.",1:"Argument list too long.",2:"Permission denied.",3:"Address in use.",4:"Address not available.",5:"Address family not supported.",6:"Resource unavailable, or operation would block.",7:"Connection already in progress.",8:"Bad file descriptor.",9:"Bad message.",10:"Device or resource busy.",11:"Operation canceled.",12:"No child processes.",13:"Connection aborted.",14:"Connection refused.",15:"Connection reset.",16:"Resource deadlock would occur.",17:"Destination address required.",18:"Mathematics argument out of domain of function.",19:"Reserved.",20:"File exists.",21:"Bad address.",22:"File too large.",23:"Host is unreachable.",24:"Identifier removed.",25:"Illegal byte sequence.",26:"Operation in progress.",27:"Interrupted function.",28:"Invalid argument.",29:"I/O error.",30:"Socket is connected.",31:"There is a directory under that path.",32:"Too many levels of symbolic links.",33:"File descriptor value too large.",34:"Too many links.",35:"Message too large.",36:"Reserved.",37:"Filename too long.",38:"Network is down.",39:"Connection aborted by network.",40:"Network unreachable.",41:"Too many files open in system.",42:"No buffer space available.",43:"No such device.",44:"There is no such file or directory OR the parent directory does not exist.",45:"Executable file format error.",46:"No locks available.",47:"Reserved.",48:"Not enough space.",49:"No message of the desired type.",50:"Protocol not available.",51:"No space left on device.",52:"Function not supported.",53:"The socket is not connected.",54:"Not a directory or a symbolic link to a directory.",55:"Directory not empty.",56:"State not recoverable.",57:"Not a socket.",58:"Not supported, or operation not supported on socket.",59:"Inappropriate I/O control operation.",60:"No such device or address.",61:"Value too large to be stored in data type.",62:"Previous owner died.",63:"Operation not permitted.",64:"Broken pipe.",65:"Protocol error.",66:"Protocol not supported.",67:"Protocol wrong type for socket.",68:"Result too large.",69:"Read-only file system.",70:"Invalid seek.",71:"No such process.",72:"Reserved.",73:"Connection timed out.",74:"Text file busy.",75:"Cross-device link.",76:"Extension: Capabilities insufficient."};function qe(e=""){return function(t,r,s){const n=s.value;s.value=function(...o){try{return n.apply(this,o)}catch(i){const l=typeof i=="object"?i==null?void 0:i.errno:null;if(l in Yn){const f=Yn[l],u=typeof o[0]=="string"?o[0]:null,d=u!==null?e.replaceAll("{path}",u):e;throw new Error(`${d}: ${f}`,{cause:i})}throw i}}}}const ec=[];function tc(e){return ec[e]}(function(){var e;return typeof process<"u"&&((e=process.release)==null?void 0:e.name)==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"})();var rc=Object.defineProperty,sc=Object.getOwnPropertyDescriptor,Ae=(e,t,r,s)=>{for(var n=s>1?void 0:s?sc(t,r):t,o=e.length-1,i;o>=0;o--)(i=e[o])&&(n=(s?i(t,r,n):i(n))||n);return s&&n&&rc(t,r,n),n};const we="string",It="number",re=Symbol("__private__dont__use");var vt,et,$t,tt,Wt,es,Mo,ts,Uo,rs,Fo,ss,Lo,ns,zo,os,Ho,is,Vo,as,Wo,cs,Ko,ls,Bo,us,Go,ps,Jo;class De{constructor(t,r){X(this,es);X(this,ts);X(this,rs);X(this,ss);X(this,ns);X(this,os);X(this,is);X(this,as);X(this,cs);X(this,ls);X(this,us);X(this,ps);X(this,vt,void 0);X(this,et,void 0);X(this,$t,void 0);X(this,tt,void 0);X(this,Wt,void 0);fe(this,vt,[]),fe(this,et,!1),fe(this,$t,null),fe(this,tt,{}),fe(this,Wt,[]),t!==void 0&&this.initializeRuntime(t),r&&(this.requestHandler=new Wa(new Ga(this,r)))}async onMessage(t){W(this,Wt).push(t)}get absoluteUrl(){return this.requestHandler.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.requestHandler.documentRoot}pathToInternalUrl(t){return this.requestHandler.requestHandler.pathToInternalUrl(t)}internalUrlToPath(t){return this.requestHandler.requestHandler.internalUrlToPath(t)}initializeRuntime(t){if(this[re])throw new Error("PHP runtime already initialized.");const r=tc(t);if(!r)throw new Error("Invalid PHP runtime id.");this[re]=r,r.onMessage=s=>{for(const n of W(this,Wt))n(s)},fe(this,$t,Da(r))}setPhpIniPath(t){if(W(this,et))throw new Error("Cannot set PHP ini path after calling run().");this[re].ccall("wasm_set_phpini_path",null,["string"],[t])}setPhpIniEntry(t,r){if(W(this,et))throw new Error("Cannot set PHP ini entries after calling run().");W(this,vt).push([t,r])}chdir(t){this[re].FS.chdir(t)}async request(t,r){if(!this.requestHandler)throw new Error("No request handler available.");return this.requestHandler.request(t,r)}async run(t){W(this,et)||(me(this,es,Mo).call(this),fe(this,et,!0)),me(this,as,Wo).call(this,t.scriptPath||""),me(this,rs,Fo).call(this,t.relativeUri||""),me(this,ns,zo).call(this,t.method||"GET");const{host:r,...s}={host:"example.com:443",...Zo(t.headers||{})};if(me(this,ss,Lo).call(this,r,t.protocol||"http"),me(this,os,Ho).call(this,s),t.body&&me(this,is,Vo).call(this,t.body),t.fileInfos)for(const n of t.fileInfos)me(this,ls,Bo).call(this,n);return t.code&&me(this,us,Go).call(this," ?>"+t.code),me(this,cs,Ko).call(this),await me(this,ps,Jo).call(this)}addServerGlobalEntry(t,r){W(this,tt)[t]=r}mkdir(t){this[re].FS.mkdirTree(t)}mkdirTree(t){this.mkdir(t)}readFileAsText(t){return new TextDecoder().decode(this.readFileAsBuffer(t))}readFileAsBuffer(t){return this[re].FS.readFile(t)}writeFile(t,r){this[re].FS.writeFile(t,r)}unlink(t){this[re].FS.unlink(t)}mv(t,r){this[re].FS.rename(t,r)}rmdir(t,r={recursive:!0}){r!=null&&r.recursive&&this.listFiles(t).forEach(s=>{const n=`${t}/${s}`;this.isDir(n)?this.rmdir(n,r):this.unlink(n)}),this[re].FS.rmdir(t)}listFiles(t,r={prependPath:!1}){if(!this.fileExists(t))return[];try{const s=this[re].FS.readdir(t).filter(n=>n!=="."&&n!=="..");if(r.prependPath){const n=t.replace(/\/$/,"");return s.map(o=>`${n}/${o}`)}return s}catch(s){return console.error(s,{path:t}),[]}}isDir(t){return this.fileExists(t)?this[re].FS.isDir(this[re].FS.lookupPath(t).node.mode):!1}fileExists(t){try{return this[re].FS.lookupPath(t),!0}catch{return!1}}}vt=new WeakMap,et=new WeakMap,$t=new WeakMap,tt=new WeakMap,Wt=new WeakMap,es=new WeakSet,Mo=function(){if(W(this,vt).length>0){const t=W(this,vt).map(([r,s])=>`${r}=${s}`).join(`
`)+`

`;this[re].ccall("wasm_set_phpini_entries",null,[we],[t])}this[re].ccall("php_wasm_init",null,[],[])},ts=new WeakSet,Uo=function(){const t="/tmp/headers.json";if(!this.fileExists(t))throw new Error("SAPI Error: Could not find response headers file.");const r=JSON.parse(this.readFileAsText(t)),s={};for(const n of r.headers){if(!n.includes(": "))continue;const o=n.indexOf(": "),i=n.substring(0,o).toLowerCase(),l=n.substring(o+2);i in s||(s[i]=[]),s[i].push(l)}return{headers:s,httpStatusCode:r.status}},rs=new WeakSet,Fo=function(t){if(this[re].ccall("wasm_set_request_uri",null,[we],[t]),t.includes("?")){const r=t.substring(t.indexOf("?")+1);this[re].ccall("wasm_set_query_string",null,[we],[r])}},ss=new WeakSet,Lo=function(t,r){this[re].ccall("wasm_set_request_host",null,[we],[t]);let s;try{s=parseInt(new URL(t).port,10)}catch{}(!s||isNaN(s)||s===80)&&(s=r==="https"?443:80),this[re].ccall("wasm_set_request_port",null,[It],[s]),(r==="https"||!r&&s===443)&&this.addServerGlobalEntry("HTTPS","on")},ns=new WeakSet,zo=function(t){this[re].ccall("wasm_set_request_method",null,[we],[t])},os=new WeakSet,Ho=function(t){t.cookie&&this[re].ccall("wasm_set_cookies",null,[we],[t.cookie]),t["content-type"]&&this[re].ccall("wasm_set_content_type",null,[we],[t["content-type"]]),t["content-length"]&&this[re].ccall("wasm_set_content_length",null,[It],[parseInt(t["content-length"],10)]);for(const r in t){let s="HTTP_";["content-type","content-length"].includes(r.toLowerCase())&&(s=""),this.addServerGlobalEntry(`${s}${r.toUpperCase().replace(/-/g,"_")}`,t[r])}},is=new WeakSet,Vo=function(t){this[re].ccall("wasm_set_request_body",null,[we],[t]),this[re].ccall("wasm_set_content_length",null,[It],[new TextEncoder().encode(t).length])},as=new WeakSet,Wo=function(t){this[re].ccall("wasm_set_path_translated",null,[we],[t])},cs=new WeakSet,Ko=function(){for(const t in W(this,tt))this[re].ccall("wasm_add_SERVER_entry",null,[we,we],[t,W(this,tt)[t]])},ls=new WeakSet,Bo=function(t){const{key:r,name:s,type:n,data:o}=t,i=`/tmp/${Math.random().toFixed(20)}`;this.writeFile(i,o);const l=0;this[re].ccall("wasm_add_uploaded_file",null,[we,we,we,we,It,It],[r,s,n,i,l,o.byteLength])},us=new WeakSet,Go=function(t){this[re].ccall("wasm_set_php_code",null,[we],[t])},ps=new WeakSet,Jo=async function(){var o;let t,r;try{t=await new Promise((i,l)=>{var u;r=d=>{const m=new Error("Rethrown");m.cause=d.error,m.betterMessage=d.message,l(m)},(u=W(this,$t))==null||u.addEventListener("error",r);const f=this[re].ccall("wasm_sapi_handle_request",It,[],[]);return f instanceof Promise?f.then(i,l):i(f)})}catch(i){for(const d in this)typeof this[d]=="function"&&(this[d]=()=>{throw new Error("PHP runtime has crashed – see the earlier error for details.")});this.functionsMaybeMissingFromAsyncify=Ma();const l=i,f="betterMessage"in l?l.betterMessage:l.message,u=new Error(f);throw u.cause=l,u}finally{(o=W(this,$t))==null||o.removeEventListener("error",r),fe(this,tt,{})}const{headers:s,httpStatusCode:n}=me(this,ts,Uo).call(this);return new bt(n,s,this.readFileAsBuffer("/tmp/stdout"),this.readFileAsText("/tmp/stderr"),t)};Ae([qe('Could not create directory "{path}"')],De.prototype,"mkdir",1);Ae([qe('Could not create directory "{path}"')],De.prototype,"mkdirTree",1);Ae([qe('Could not read "{path}"')],De.prototype,"readFileAsText",1);Ae([qe('Could not read "{path}"')],De.prototype,"readFileAsBuffer",1);Ae([qe('Could not write to "{path}"')],De.prototype,"writeFile",1);Ae([qe('Could not unlink "{path}"')],De.prototype,"unlink",1);Ae([qe('Could not move "{path}"')],De.prototype,"mv",1);Ae([qe('Could not remove directory "{path}"')],De.prototype,"rmdir",1);Ae([qe('Could not list files in "{path}"')],De.prototype,"listFiles",1);Ae([qe('Could not stat "{path}"')],De.prototype,"isDir",1);Ae([qe('Could not stat "{path}"')],De.prototype,"fileExists",1);function Zo(e){const t={};for(const r in e)t[r.toLowerCase()]=e[r];return t}const nc=["vfs","literal","wordpress.org/themes","wordpress.org/plugins","url"];function oc(e){return e&&typeof e=="object"&&typeof e.resource=="string"&&nc.includes(e.resource)}class Et{static create(t,{semaphore:r,progress:s}){let n;switch(t.resource){case"vfs":n=new ic(t,s);break;case"literal":n=new ac(t,s);break;case"wordpress.org/themes":n=new uc(t,s);break;case"wordpress.org/plugins":n=new pc(t,s);break;case"url":n=new lc(t,s);break;default:throw new Error(`Invalid resource: ${t}`)}return n=new dc(n),r&&(n=new hc(n,r)),n}setPlayground(t){this.playground=t}get isAsync(){return!1}}class ic extends Et{constructor(t,r){super(),this.resource=t,this.progress=r}async resolve(){var r;const t=await this.playground.readFileAsBuffer(this.resource.path);return(r=this.progress)==null||r.set(100),new As([t],this.name)}get name(){return this.resource.path.split("/").pop()||""}}class ac extends Et{constructor(t,r){super(),this.resource=t,this.progress=r}async resolve(){var t;return(t=this.progress)==null||t.set(100),new As([this.resource.contents],this.resource.name)}get name(){return this.resource.name}}class Fs extends Et{constructor(t){super(),this.progress=t}async resolve(){var s,n;(s=this.progress)==null||s.setCaption(this.caption);const t=this.getURL();let r=await fetch(t);if(r=await Oa(r,((n=this.progress)==null?void 0:n.loadingListener)??cc),r.status!==200)throw new Error(`Could not download "${t}"`);return new As([await r.blob()],this.name)}get caption(){return`Downloading ${this.name}`}get name(){try{return new URL(this.getURL(),"http://example.com").pathname.split("/").pop()}catch{return this.getURL()}}get isAsync(){return!0}}const cc=()=>{};class lc extends Fs{constructor(t,r){super(r),this.resource=t}getURL(){return this.resource.url}get caption(){return this.resource.caption??super.caption}}class uc extends Fs{constructor(t,r){super(r),this.resource=t}get name(){return ds(this.resource.slug)}getURL(){return`https://downloads.wordpress.org/theme/${Yo(this.resource.slug)}`}}class pc extends Fs{constructor(t,r){super(r),this.resource=t}get name(){return ds(this.resource.slug)}getURL(){return`https://downloads.wordpress.org/plugin/${Yo(this.resource.slug)}`}}function Yo(e){return!e||e.endsWith(".zip")?e:e+".latest-stable.zip"}class Qo extends Et{constructor(t){super(),this.resource=t}async resolve(){return this.resource.resolve()}async setPlayground(t){return this.resource.setPlayground(t)}get progress(){return this.resource.progress}set progress(t){this.resource.progress=t}get name(){return this.resource.name}get isAsync(){return this.resource.isAsync}}class dc extends Qo{async resolve(){return this.promise||(this.promise=super.resolve()),this.promise}}class hc extends Qo{constructor(t,r){super(t),this.semaphore=r}async resolve(){return this.isAsync?this.semaphore.run(()=>super.resolve()):super.resolve()}}var fc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Cs={exports:{}},Xo={},Ie={},Bt={},wr={},B={},yr={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(E){if(super(),!e.IDENTIFIER.test(E))throw new Error("CodeGen: name must be a valid identifier");this.str=E}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class s extends t{constructor(E){super(),this._items=typeof E=="string"?[E]:E}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const E=this._items[0];return E===""||E==='""'}get str(){var E;return(E=this._str)!==null&&E!==void 0?E:this._str=this._items.reduce((k,R)=>`${k}${R}`,"")}get names(){var E;return(E=this._names)!==null&&E!==void 0?E:this._names=this._items.reduce((k,R)=>(R instanceof r&&(k[R.str]=(k[R.str]||0)+1),k),{})}}e._Code=s,e.nil=new s("");function n(g,...E){const k=[g[0]];let R=0;for(;R<E.length;)l(k,E[R]),k.push(g[++R]);return new s(k)}e._=n;const o=new s("+");function i(g,...E){const k=[x(g[0])];let R=0;for(;R<E.length;)k.push(o),l(k,E[R]),k.push(o,x(g[++R]));return f(k),new s(k)}e.str=i;function l(g,E){E instanceof s?g.push(...E._items):E instanceof r?g.push(E):g.push(m(E))}e.addCodeArg=l;function f(g){let E=1;for(;E<g.length-1;){if(g[E]===o){const k=u(g[E-1],g[E+1]);if(k!==void 0){g.splice(E-1,3,k);continue}g[E++]="+"}E++}}function u(g,E){if(E==='""')return g;if(g==='""')return E;if(typeof g=="string")return E instanceof r||g[g.length-1]!=='"'?void 0:typeof E!="string"?`${g.slice(0,-1)}${E}"`:E[0]==='"'?g.slice(0,-1)+E.slice(1):void 0;if(typeof E=="string"&&E[0]==='"'&&!(g instanceof r))return`"${g}${E.slice(1)}`}function d(g,E){return E.emptyStr()?g:g.emptyStr()?E:i`${g}${E}`}e.strConcat=d;function m(g){return typeof g=="number"||typeof g=="boolean"||g===null?g:x(Array.isArray(g)?g.join(","):g)}function $(g){return new s(x(g))}e.stringify=$;function x(g){return JSON.stringify(g).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=x;function P(g){return typeof g=="string"&&e.IDENTIFIER.test(g)?new s(`.${g}`):n`[${g}]`}e.getProperty=P;function T(g){if(typeof g=="string"&&e.IDENTIFIER.test(g))return new s(`${g}`);throw new Error(`CodeGen: invalid export name: ${g}, use explicit $id name mapping`)}e.getEsmExportName=T;function v(g){return new s(g.toString())}e.regexpCode=v})(yr);var Ns={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=yr;class r extends Error{constructor(u){super(`CodeGen: "code" for ${u} not defined`),this.value=u.value}}var s;(function(f){f[f.Started=0]="Started",f[f.Completed=1]="Completed"})(s=e.UsedValueState||(e.UsedValueState={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class n{constructor({prefixes:u,parent:d}={}){this._names={},this._prefixes=u,this._parent=d}toName(u){return u instanceof t.Name?u:this.name(u)}name(u){return new t.Name(this._newName(u))}_newName(u){const d=this._names[u]||this._nameGroup(u);return`${u}${d.index++}`}_nameGroup(u){var d,m;if(!((m=(d=this._parent)===null||d===void 0?void 0:d._prefixes)===null||m===void 0)&&m.has(u)||this._prefixes&&!this._prefixes.has(u))throw new Error(`CodeGen: prefix "${u}" is not allowed in this scope`);return this._names[u]={prefix:u,index:0}}}e.Scope=n;class o extends t.Name{constructor(u,d){super(d),this.prefix=u}setValue(u,{property:d,itemIndex:m}){this.value=u,this.scopePath=(0,t._)`.${new t.Name(d)}[${m}]`}}e.ValueScopeName=o;const i=(0,t._)`\n`;class l extends n{constructor(u){super(u),this._values={},this._scope=u.scope,this.opts={...u,_n:u.lines?i:t.nil}}get(){return this._scope}name(u){return new o(u,this._newName(u))}value(u,d){var m;if(d.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const $=this.toName(u),{prefix:x}=$,P=(m=d.key)!==null&&m!==void 0?m:d.ref;let T=this._values[x];if(T){const E=T.get(P);if(E)return E}else T=this._values[x]=new Map;T.set(P,$);const v=this._scope[x]||(this._scope[x]=[]),g=v.length;return v[g]=d.ref,$.setValue(d,{property:x,itemIndex:g}),$}getValue(u,d){const m=this._values[u];if(m)return m.get(d)}scopeRefs(u,d=this._values){return this._reduceValues(d,m=>{if(m.scopePath===void 0)throw new Error(`CodeGen: name "${m}" has no value`);return(0,t._)`${u}${m.scopePath}`})}scopeCode(u=this._values,d,m){return this._reduceValues(u,$=>{if($.value===void 0)throw new Error(`CodeGen: name "${$}" has no value`);return $.value.code},d,m)}_reduceValues(u,d,m={},$){let x=t.nil;for(const P in u){const T=u[P];if(!T)continue;const v=m[P]=m[P]||new Map;T.forEach(g=>{if(v.has(g))return;v.set(g,s.Started);let E=d(g);if(E){const k=this.opts.es5?e.varKinds.var:e.varKinds.const;x=(0,t._)`${x}${k} ${g} = ${E};${this.opts._n}`}else if(E=$==null?void 0:$(g))x=(0,t._)`${x}${E}${this.opts._n}`;else throw new r(g);v.set(g,s.Completed)})}return x}}e.ValueScope=l})(Ns);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=yr,r=Ns;var s=yr;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return s.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return s.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return s.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return s.Name}});var n=Ns;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return n.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return n.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return n.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return n.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class o{optimizeNodes(){return this}optimizeNames(c,y){return this}}class i extends o{constructor(c,y,N){super(),this.varKind=c,this.name=y,this.rhs=N}render({es5:c,_n:y}){const N=c?r.varKinds.var:this.varKind,D=this.rhs===void 0?"":` = ${this.rhs}`;return`${N} ${this.name}${D};`+y}optimizeNames(c,y){if(c[this.name.str])return this.rhs&&(this.rhs=pe(this.rhs,c,y)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class l extends o{constructor(c,y,N){super(),this.lhs=c,this.rhs=y,this.sideEffects=N}render({_n:c}){return`${this.lhs} = ${this.rhs};`+c}optimizeNames(c,y){if(!(this.lhs instanceof t.Name&&!c[this.lhs.str]&&!this.sideEffects))return this.rhs=pe(this.rhs,c,y),this}get names(){const c=this.lhs instanceof t.Name?{}:{...this.lhs.names};return Se(c,this.rhs)}}class f extends l{constructor(c,y,N,D){super(c,N,D),this.op=y}render({_n:c}){return`${this.lhs} ${this.op}= ${this.rhs};`+c}}class u extends o{constructor(c){super(),this.label=c,this.names={}}render({_n:c}){return`${this.label}:`+c}}class d extends o{constructor(c){super(),this.label=c,this.names={}}render({_n:c}){return`break${this.label?` ${this.label}`:""};`+c}}class m extends o{constructor(c){super(),this.error=c}render({_n:c}){return`throw ${this.error};`+c}get names(){return this.error.names}}class $ extends o{constructor(c){super(),this.code=c}render({_n:c}){return`${this.code};`+c}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(c,y){return this.code=pe(this.code,c,y),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class x extends o{constructor(c=[]){super(),this.nodes=c}render(c){return this.nodes.reduce((y,N)=>y+N.render(c),"")}optimizeNodes(){const{nodes:c}=this;let y=c.length;for(;y--;){const N=c[y].optimizeNodes();Array.isArray(N)?c.splice(y,1,...N):N?c[y]=N:c.splice(y,1)}return c.length>0?this:void 0}optimizeNames(c,y){const{nodes:N}=this;let D=N.length;for(;D--;){const M=N[D];M.optimizeNames(c,y)||(nt(c,M.names),N.splice(D,1))}return N.length>0?this:void 0}get names(){return this.nodes.reduce((c,y)=>Y(c,y.names),{})}}class P extends x{render(c){return"{"+c._n+super.render(c)+"}"+c._n}}class T extends x{}class v extends P{}v.kind="else";class g extends P{constructor(c,y){super(y),this.condition=c}render(c){let y=`if(${this.condition})`+super.render(c);return this.else&&(y+="else "+this.else.render(c)),y}optimizeNodes(){super.optimizeNodes();const c=this.condition;if(c===!0)return this.nodes;let y=this.else;if(y){const N=y.optimizeNodes();y=this.else=Array.isArray(N)?new v(N):N}if(y)return c===!1?y instanceof g?y:y.nodes:this.nodes.length?this:new g(ot(c),y instanceof g?[y]:y.nodes);if(!(c===!1||!this.nodes.length))return this}optimizeNames(c,y){var N;if(this.else=(N=this.else)===null||N===void 0?void 0:N.optimizeNames(c,y),!!(super.optimizeNames(c,y)||this.else))return this.condition=pe(this.condition,c,y),this}get names(){const c=super.names;return Se(c,this.condition),this.else&&Y(c,this.else.names),c}}g.kind="if";class E extends P{}E.kind="for";class k extends E{constructor(c){super(),this.iteration=c}render(c){return`for(${this.iteration})`+super.render(c)}optimizeNames(c,y){if(super.optimizeNames(c,y))return this.iteration=pe(this.iteration,c,y),this}get names(){return Y(super.names,this.iteration.names)}}class R extends E{constructor(c,y,N,D){super(),this.varKind=c,this.name=y,this.from=N,this.to=D}render(c){const y=c.es5?r.varKinds.var:this.varKind,{name:N,from:D,to:M}=this;return`for(${y} ${N}=${D}; ${N}<${M}; ${N}++)`+super.render(c)}get names(){const c=Se(super.names,this.from);return Se(c,this.to)}}class q extends E{constructor(c,y,N,D){super(),this.loop=c,this.varKind=y,this.name=N,this.iterable=D}render(c){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(c)}optimizeNames(c,y){if(super.optimizeNames(c,y))return this.iterable=pe(this.iterable,c,y),this}get names(){return Y(super.names,this.iterable.names)}}class b extends P{constructor(c,y,N){super(),this.name=c,this.args=y,this.async=N}render(c){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(c)}}b.kind="func";class S extends x{render(c){return"return "+super.render(c)}}S.kind="return";class I extends P{render(c){let y="try"+super.render(c);return this.catch&&(y+=this.catch.render(c)),this.finally&&(y+=this.finally.render(c)),y}optimizeNodes(){var c,y;return super.optimizeNodes(),(c=this.catch)===null||c===void 0||c.optimizeNodes(),(y=this.finally)===null||y===void 0||y.optimizeNodes(),this}optimizeNames(c,y){var N,D;return super.optimizeNames(c,y),(N=this.catch)===null||N===void 0||N.optimizeNames(c,y),(D=this.finally)===null||D===void 0||D.optimizeNames(c,y),this}get names(){const c=super.names;return this.catch&&Y(c,this.catch.names),this.finally&&Y(c,this.finally.names),c}}class H extends P{constructor(c){super(),this.error=c}render(c){return`catch(${this.error})`+super.render(c)}}H.kind="catch";class G extends P{render(c){return"finally"+super.render(c)}}G.kind="finally";class ae{constructor(c,y={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...y,_n:y.lines?`
`:""},this._extScope=c,this._scope=new r.Scope({parent:c}),this._nodes=[new T]}toString(){return this._root.render(this.opts)}name(c){return this._scope.name(c)}scopeName(c){return this._extScope.name(c)}scopeValue(c,y){const N=this._extScope.value(c,y);return(this._values[N.prefix]||(this._values[N.prefix]=new Set)).add(N),N}getScopeValue(c,y){return this._extScope.getValue(c,y)}scopeRefs(c){return this._extScope.scopeRefs(c,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(c,y,N,D){const M=this._scope.toName(y);return N!==void 0&&D&&(this._constants[M.str]=N),this._leafNode(new i(c,M,N)),M}const(c,y,N){return this._def(r.varKinds.const,c,y,N)}let(c,y,N){return this._def(r.varKinds.let,c,y,N)}var(c,y,N){return this._def(r.varKinds.var,c,y,N)}assign(c,y,N){return this._leafNode(new l(c,y,N))}add(c,y){return this._leafNode(new f(c,e.operators.ADD,y))}code(c){return typeof c=="function"?c():c!==t.nil&&this._leafNode(new $(c)),this}object(...c){const y=["{"];for(const[N,D]of c)y.length>1&&y.push(","),y.push(N),(N!==D||this.opts.es5)&&(y.push(":"),(0,t.addCodeArg)(y,D));return y.push("}"),new t._Code(y)}if(c,y,N){if(this._blockNode(new g(c)),y&&N)this.code(y).else().code(N).endIf();else if(y)this.code(y).endIf();else if(N)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(c){return this._elseNode(new g(c))}else(){return this._elseNode(new v)}endIf(){return this._endBlockNode(g,v)}_for(c,y){return this._blockNode(c),y&&this.code(y).endFor(),this}for(c,y){return this._for(new k(c),y)}forRange(c,y,N,D,M=this.opts.es5?r.varKinds.var:r.varKinds.let){const J=this._scope.toName(c);return this._for(new R(M,J,y,N),()=>D(J))}forOf(c,y,N,D=r.varKinds.const){const M=this._scope.toName(c);if(this.opts.es5){const J=y instanceof t.Name?y:this.var("_arr",y);return this.forRange("_i",0,(0,t._)`${J}.length`,Z=>{this.var(M,(0,t._)`${J}[${Z}]`),N(M)})}return this._for(new q("of",D,M,y),()=>N(M))}forIn(c,y,N,D=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(c,(0,t._)`Object.keys(${y})`,N);const M=this._scope.toName(c);return this._for(new q("in",D,M,y),()=>N(M))}endFor(){return this._endBlockNode(E)}label(c){return this._leafNode(new u(c))}break(c){return this._leafNode(new d(c))}return(c){const y=new S;if(this._blockNode(y),this.code(c),y.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(S)}try(c,y,N){if(!y&&!N)throw new Error('CodeGen: "try" without "catch" and "finally"');const D=new I;if(this._blockNode(D),this.code(c),y){const M=this.name("e");this._currNode=D.catch=new H(M),y(M)}return N&&(this._currNode=D.finally=new G,this.code(N)),this._endBlockNode(H,G)}throw(c){return this._leafNode(new m(c))}block(c,y){return this._blockStarts.push(this._nodes.length),c&&this.code(c).endBlock(y),this}endBlock(c){const y=this._blockStarts.pop();if(y===void 0)throw new Error("CodeGen: not in self-balancing block");const N=this._nodes.length-y;if(N<0||c!==void 0&&N!==c)throw new Error(`CodeGen: wrong number of nodes: ${N} vs ${c} expected`);return this._nodes.length=y,this}func(c,y=t.nil,N,D){return this._blockNode(new b(c,y,N)),D&&this.code(D).endFunc(),this}endFunc(){return this._endBlockNode(b)}optimize(c=1){for(;c-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(c){return this._currNode.nodes.push(c),this}_blockNode(c){this._currNode.nodes.push(c),this._nodes.push(c)}_endBlockNode(c,y){const N=this._currNode;if(N instanceof c||y&&N instanceof y)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${y?`${c.kind}/${y.kind}`:c.kind}"`)}_elseNode(c){const y=this._currNode;if(!(y instanceof g))throw new Error('CodeGen: "else" without "if"');return this._currNode=y.else=c,this}get _root(){return this._nodes[0]}get _currNode(){const c=this._nodes;return c[c.length-1]}set _currNode(c){const y=this._nodes;y[y.length-1]=c}}e.CodeGen=ae;function Y(_,c){for(const y in c)_[y]=(_[y]||0)+(c[y]||0);return _}function Se(_,c){return c instanceof t._CodeOrName?Y(_,c.names):_}function pe(_,c,y){if(_ instanceof t.Name)return N(_);if(!D(_))return _;return new t._Code(_._items.reduce((M,J)=>(J instanceof t.Name&&(J=N(J)),J instanceof t._Code?M.push(...J._items):M.push(J),M),[]));function N(M){const J=y[M.str];return J===void 0||c[M.str]!==1?M:(delete c[M.str],J)}function D(M){return M instanceof t._Code&&M._items.some(J=>J instanceof t.Name&&c[J.str]===1&&y[J.str]!==void 0)}}function nt(_,c){for(const y in c)_[y]=(_[y]||0)-(c[y]||0)}function ot(_){return typeof _=="boolean"||typeof _=="number"||_===null?!_:(0,t._)`!${O(_)}`}e.not=ot;const St=w(e.operators.AND);function Yt(..._){return _.reduce(St)}e.and=Yt;const Tt=w(e.operators.OR);function A(..._){return _.reduce(Tt)}e.or=A;function w(_){return(c,y)=>c===t.nil?y:y===t.nil?c:(0,t._)`${O(c)} ${_} ${O(y)}`}function O(_){return _ instanceof t.Name?_:(0,t._)`(${_})`}})(B);var ee={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.checkStrictMode=e.getErrorPath=e.Type=e.useFunc=e.setEvaluated=e.evaluatedPropsToName=e.mergeEvaluated=e.eachItem=e.unescapeJsonPointer=e.escapeJsonPointer=e.escapeFragment=e.unescapeFragment=e.schemaRefOrVal=e.schemaHasRulesButRef=e.schemaHasRules=e.checkUnknownRules=e.alwaysValidSchema=e.toHash=void 0;const t=B,r=yr;function s(b){const S={};for(const I of b)S[I]=!0;return S}e.toHash=s;function n(b,S){return typeof S=="boolean"?S:Object.keys(S).length===0?!0:(o(b,S),!i(S,b.self.RULES.all))}e.alwaysValidSchema=n;function o(b,S=b.schema){const{opts:I,self:H}=b;if(!I.strictSchema||typeof S=="boolean")return;const G=H.RULES.keywords;for(const ae in S)G[ae]||q(b,`unknown keyword: "${ae}"`)}e.checkUnknownRules=o;function i(b,S){if(typeof b=="boolean")return!b;for(const I in b)if(S[I])return!0;return!1}e.schemaHasRules=i;function l(b,S){if(typeof b=="boolean")return!b;for(const I in b)if(I!=="$ref"&&S.all[I])return!0;return!1}e.schemaHasRulesButRef=l;function f({topSchemaRef:b,schemaPath:S},I,H,G){if(!G){if(typeof I=="number"||typeof I=="boolean")return I;if(typeof I=="string")return(0,t._)`${I}`}return(0,t._)`${b}${S}${(0,t.getProperty)(H)}`}e.schemaRefOrVal=f;function u(b){return $(decodeURIComponent(b))}e.unescapeFragment=u;function d(b){return encodeURIComponent(m(b))}e.escapeFragment=d;function m(b){return typeof b=="number"?`${b}`:b.replace(/~/g,"~0").replace(/\//g,"~1")}e.escapeJsonPointer=m;function $(b){return b.replace(/~1/g,"/").replace(/~0/g,"~")}e.unescapeJsonPointer=$;function x(b,S){if(Array.isArray(b))for(const I of b)S(I);else S(b)}e.eachItem=x;function P({mergeNames:b,mergeToName:S,mergeValues:I,resultToName:H}){return(G,ae,Y,Se)=>{const pe=Y===void 0?ae:Y instanceof t.Name?(ae instanceof t.Name?b(G,ae,Y):S(G,ae,Y),Y):ae instanceof t.Name?(S(G,Y,ae),ae):I(ae,Y);return Se===t.Name&&!(pe instanceof t.Name)?H(G,pe):pe}}e.mergeEvaluated={props:P({mergeNames:(b,S,I)=>b.if((0,t._)`${I} !== true && ${S} !== undefined`,()=>{b.if((0,t._)`${S} === true`,()=>b.assign(I,!0),()=>b.assign(I,(0,t._)`${I} || {}`).code((0,t._)`Object.assign(${I}, ${S})`))}),mergeToName:(b,S,I)=>b.if((0,t._)`${I} !== true`,()=>{S===!0?b.assign(I,!0):(b.assign(I,(0,t._)`${I} || {}`),v(b,I,S))}),mergeValues:(b,S)=>b===!0?!0:{...b,...S},resultToName:T}),items:P({mergeNames:(b,S,I)=>b.if((0,t._)`${I} !== true && ${S} !== undefined`,()=>b.assign(I,(0,t._)`${S} === true ? true : ${I} > ${S} ? ${I} : ${S}`)),mergeToName:(b,S,I)=>b.if((0,t._)`${I} !== true`,()=>b.assign(I,S===!0?!0:(0,t._)`${I} > ${S} ? ${I} : ${S}`)),mergeValues:(b,S)=>b===!0?!0:Math.max(b,S),resultToName:(b,S)=>b.var("items",S)})};function T(b,S){if(S===!0)return b.var("props",!0);const I=b.var("props",(0,t._)`{}`);return S!==void 0&&v(b,I,S),I}e.evaluatedPropsToName=T;function v(b,S,I){Object.keys(I).forEach(H=>b.assign((0,t._)`${S}${(0,t.getProperty)(H)}`,!0))}e.setEvaluated=v;const g={};function E(b,S){return b.scopeValue("func",{ref:S,code:g[S.code]||(g[S.code]=new r._Code(S.code))})}e.useFunc=E;var k;(function(b){b[b.Num=0]="Num",b[b.Str=1]="Str"})(k=e.Type||(e.Type={}));function R(b,S,I){if(b instanceof t.Name){const H=S===k.Num;return I?H?(0,t._)`"[" + ${b} + "]"`:(0,t._)`"['" + ${b} + "']"`:H?(0,t._)`"/" + ${b}`:(0,t._)`"/" + ${b}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return I?(0,t.getProperty)(b).toString():"/"+m(b)}e.getErrorPath=R;function q(b,S,I=b.opts.strictSchema){if(I){if(S=`strict mode: ${S}`,I===!0)throw new Error(S);b.self.logger.warn(S)}}e.checkStrictMode=q})(ee);var Ke={};Object.defineProperty(Ke,"__esModule",{value:!0});const ve=B,yc={data:new ve.Name("data"),valCxt:new ve.Name("valCxt"),instancePath:new ve.Name("instancePath"),parentData:new ve.Name("parentData"),parentDataProperty:new ve.Name("parentDataProperty"),rootData:new ve.Name("rootData"),dynamicAnchors:new ve.Name("dynamicAnchors"),vErrors:new ve.Name("vErrors"),errors:new ve.Name("errors"),this:new ve.Name("this"),self:new ve.Name("self"),scope:new ve.Name("scope"),json:new ve.Name("json"),jsonPos:new ve.Name("jsonPos"),jsonLen:new ve.Name("jsonLen"),jsonPart:new ve.Name("jsonPart")};Ke.default=yc;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=B,r=ee,s=Ke;e.keywordError={message:({keyword:v})=>(0,t.str)`must pass "${v}" keyword validation`},e.keyword$DataError={message:({keyword:v,schemaType:g})=>g?(0,t.str)`"${v}" keyword must be ${g} ($data)`:(0,t.str)`"${v}" keyword is invalid ($data)`};function n(v,g=e.keywordError,E,k){const{it:R}=v,{gen:q,compositeRule:b,allErrors:S}=R,I=m(v,g,E);k??(b||S)?f(q,I):u(R,(0,t._)`[${I}]`)}e.reportError=n;function o(v,g=e.keywordError,E){const{it:k}=v,{gen:R,compositeRule:q,allErrors:b}=k,S=m(v,g,E);f(R,S),q||b||u(k,s.default.vErrors)}e.reportExtraError=o;function i(v,g){v.assign(s.default.errors,g),v.if((0,t._)`${s.default.vErrors} !== null`,()=>v.if(g,()=>v.assign((0,t._)`${s.default.vErrors}.length`,g),()=>v.assign(s.default.vErrors,null)))}e.resetErrorsCount=i;function l({gen:v,keyword:g,schemaValue:E,data:k,errsCount:R,it:q}){if(R===void 0)throw new Error("ajv implementation error");const b=v.name("err");v.forRange("i",R,s.default.errors,S=>{v.const(b,(0,t._)`${s.default.vErrors}[${S}]`),v.if((0,t._)`${b}.instancePath === undefined`,()=>v.assign((0,t._)`${b}.instancePath`,(0,t.strConcat)(s.default.instancePath,q.errorPath))),v.assign((0,t._)`${b}.schemaPath`,(0,t.str)`${q.errSchemaPath}/${g}`),q.opts.verbose&&(v.assign((0,t._)`${b}.schema`,E),v.assign((0,t._)`${b}.data`,k))})}e.extendErrors=l;function f(v,g){const E=v.const("err",g);v.if((0,t._)`${s.default.vErrors} === null`,()=>v.assign(s.default.vErrors,(0,t._)`[${E}]`),(0,t._)`${s.default.vErrors}.push(${E})`),v.code((0,t._)`${s.default.errors}++`)}function u(v,g){const{gen:E,validateName:k,schemaEnv:R}=v;R.$async?E.throw((0,t._)`new ${v.ValidationError}(${g})`):(E.assign((0,t._)`${k}.errors`,g),E.return(!1))}const d={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function m(v,g,E){const{createErrors:k}=v.it;return k===!1?(0,t._)`{}`:$(v,g,E)}function $(v,g,E={}){const{gen:k,it:R}=v,q=[x(R,E),P(v,E)];return T(v,g,q),k.object(...q)}function x({errorPath:v},{instancePath:g}){const E=g?(0,t.str)`${v}${(0,r.getErrorPath)(g,r.Type.Str)}`:v;return[s.default.instancePath,(0,t.strConcat)(s.default.instancePath,E)]}function P({keyword:v,it:{errSchemaPath:g}},{schemaPath:E,parentSchema:k}){let R=k?g:(0,t.str)`${g}/${v}`;return E&&(R=(0,t.str)`${R}${(0,r.getErrorPath)(E,r.Type.Str)}`),[d.schemaPath,R]}function T(v,{params:g,message:E},k){const{keyword:R,data:q,schemaValue:b,it:S}=v,{opts:I,propertyName:H,topSchemaRef:G,schemaPath:ae}=S;k.push([d.keyword,R],[d.params,typeof g=="function"?g(v):g||(0,t._)`{}`]),I.messages&&k.push([d.message,typeof E=="function"?E(v):E]),I.verbose&&k.push([d.schema,b],[d.parentSchema,(0,t._)`${G}${ae}`],[s.default.data,q]),H&&k.push([d.propertyName,H])}})(wr);Object.defineProperty(Bt,"__esModule",{value:!0});Bt.boolOrEmptySchema=Bt.topBoolOrEmptySchema=void 0;const gc=wr,wc=B,vc=Ke,$c={message:"boolean schema is false"};function bc(e){const{gen:t,schema:r,validateName:s}=e;r===!1?ei(e,!1):typeof r=="object"&&r.$async===!0?t.return(vc.default.data):(t.assign((0,wc._)`${s}.errors`,null),t.return(!0))}Bt.topBoolOrEmptySchema=bc;function _c(e,t){const{gen:r,schema:s}=e;s===!1?(r.var(t,!1),ei(e)):r.var(t,!0)}Bt.boolOrEmptySchema=_c;function ei(e,t){const{gen:r,data:s}=e,n={gen:r,keyword:"false schema",data:s,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,gc.reportError)(n,$c,void 0,t)}var vr={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.getRules=_t.isJSONType=void 0;const Pc=["string","number","integer","boolean","null","object","array"],Ec=new Set(Pc);function Sc(e){return typeof e=="string"&&Ec.has(e)}_t.isJSONType=Sc;function Tc(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}_t.getRules=Tc;var Je={};Object.defineProperty(Je,"__esModule",{value:!0});Je.shouldUseRule=Je.shouldUseGroup=Je.schemaHasRulesForType=void 0;function kc({schema:e,self:t},r){const s=t.RULES.types[r];return s&&s!==!0&&ti(e,s)}Je.schemaHasRulesForType=kc;function ti(e,t){return t.rules.some(r=>ri(e,r))}Je.shouldUseGroup=ti;function ri(e,t){var r;return e[t.keyword]!==void 0||((r=t.definition.implements)===null||r===void 0?void 0:r.some(s=>e[s]!==void 0))}Je.shouldUseRule=ri;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.reportTypeError=e.checkDataTypes=e.checkDataType=e.coerceAndCheckDataType=e.getJSONTypes=e.getSchemaTypes=e.DataType=void 0;const t=_t,r=Je,s=wr,n=B,o=ee;var i;(function(k){k[k.Correct=0]="Correct",k[k.Wrong=1]="Wrong"})(i=e.DataType||(e.DataType={}));function l(k){const R=f(k.type);if(R.includes("null")){if(k.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!R.length&&k.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');k.nullable===!0&&R.push("null")}return R}e.getSchemaTypes=l;function f(k){const R=Array.isArray(k)?k:k?[k]:[];if(R.every(t.isJSONType))return R;throw new Error("type must be JSONType or JSONType[]: "+R.join(","))}e.getJSONTypes=f;function u(k,R){const{gen:q,data:b,opts:S}=k,I=m(R,S.coerceTypes),H=R.length>0&&!(I.length===0&&R.length===1&&(0,r.schemaHasRulesForType)(k,R[0]));if(H){const G=T(R,b,S.strictNumbers,i.Wrong);q.if(G,()=>{I.length?$(k,R,I):g(k)})}return H}e.coerceAndCheckDataType=u;const d=new Set(["string","number","integer","boolean","null"]);function m(k,R){return R?k.filter(q=>d.has(q)||R==="array"&&q==="array"):[]}function $(k,R,q){const{gen:b,data:S,opts:I}=k,H=b.let("dataType",(0,n._)`typeof ${S}`),G=b.let("coerced",(0,n._)`undefined`);I.coerceTypes==="array"&&b.if((0,n._)`${H} == 'object' && Array.isArray(${S}) && ${S}.length == 1`,()=>b.assign(S,(0,n._)`${S}[0]`).assign(H,(0,n._)`typeof ${S}`).if(T(R,S,I.strictNumbers),()=>b.assign(G,S))),b.if((0,n._)`${G} !== undefined`);for(const Y of q)(d.has(Y)||Y==="array"&&I.coerceTypes==="array")&&ae(Y);b.else(),g(k),b.endIf(),b.if((0,n._)`${G} !== undefined`,()=>{b.assign(S,G),x(k,G)});function ae(Y){switch(Y){case"string":b.elseIf((0,n._)`${H} == "number" || ${H} == "boolean"`).assign(G,(0,n._)`"" + ${S}`).elseIf((0,n._)`${S} === null`).assign(G,(0,n._)`""`);return;case"number":b.elseIf((0,n._)`${H} == "boolean" || ${S} === null
              || (${H} == "string" && ${S} && ${S} == +${S})`).assign(G,(0,n._)`+${S}`);return;case"integer":b.elseIf((0,n._)`${H} === "boolean" || ${S} === null
              || (${H} === "string" && ${S} && ${S} == +${S} && !(${S} % 1))`).assign(G,(0,n._)`+${S}`);return;case"boolean":b.elseIf((0,n._)`${S} === "false" || ${S} === 0 || ${S} === null`).assign(G,!1).elseIf((0,n._)`${S} === "true" || ${S} === 1`).assign(G,!0);return;case"null":b.elseIf((0,n._)`${S} === "" || ${S} === 0 || ${S} === false`),b.assign(G,null);return;case"array":b.elseIf((0,n._)`${H} === "string" || ${H} === "number"
              || ${H} === "boolean" || ${S} === null`).assign(G,(0,n._)`[${S}]`)}}}function x({gen:k,parentData:R,parentDataProperty:q},b){k.if((0,n._)`${R} !== undefined`,()=>k.assign((0,n._)`${R}[${q}]`,b))}function P(k,R,q,b=i.Correct){const S=b===i.Correct?n.operators.EQ:n.operators.NEQ;let I;switch(k){case"null":return(0,n._)`${R} ${S} null`;case"array":I=(0,n._)`Array.isArray(${R})`;break;case"object":I=(0,n._)`${R} && typeof ${R} == "object" && !Array.isArray(${R})`;break;case"integer":I=H((0,n._)`!(${R} % 1) && !isNaN(${R})`);break;case"number":I=H();break;default:return(0,n._)`typeof ${R} ${S} ${k}`}return b===i.Correct?I:(0,n.not)(I);function H(G=n.nil){return(0,n.and)((0,n._)`typeof ${R} == "number"`,G,q?(0,n._)`isFinite(${R})`:n.nil)}}e.checkDataType=P;function T(k,R,q,b){if(k.length===1)return P(k[0],R,q,b);let S;const I=(0,o.toHash)(k);if(I.array&&I.object){const H=(0,n._)`typeof ${R} != "object"`;S=I.null?H:(0,n._)`!${R} || ${H}`,delete I.null,delete I.array,delete I.object}else S=n.nil;I.number&&delete I.integer;for(const H in I)S=(0,n.and)(S,P(H,R,q,b));return S}e.checkDataTypes=T;const v={message:({schema:k})=>`must be ${k}`,params:({schema:k,schemaValue:R})=>typeof k=="string"?(0,n._)`{type: ${k}}`:(0,n._)`{type: ${R}}`};function g(k){const R=E(k);(0,s.reportError)(R,v)}e.reportTypeError=g;function E(k){const{gen:R,data:q,schema:b}=k,S=(0,o.schemaRefOrVal)(k,b,"type");return{gen:R,keyword:"type",data:q,schema:b.type,schemaCode:S,schemaValue:S,parentSchema:b,params:{},it:k}}})(vr);var fs={};Object.defineProperty(fs,"__esModule",{value:!0});fs.assignDefaults=void 0;const qt=B,Cc=ee;function Nc(e,t){const{properties:r,items:s}=e.schema;if(t==="object"&&r)for(const n in r)Qn(e,n,r[n].default);else t==="array"&&Array.isArray(s)&&s.forEach((n,o)=>Qn(e,o,n.default))}fs.assignDefaults=Nc;function Qn(e,t,r){const{gen:s,compositeRule:n,data:o,opts:i}=e;if(r===void 0)return;const l=(0,qt._)`${o}${(0,qt.getProperty)(t)}`;if(n){(0,Cc.checkStrictMode)(e,`default is ignored for: ${l}`);return}let f=(0,qt._)`${l} === undefined`;i.useDefaults==="empty"&&(f=(0,qt._)`${f} || ${l} === null || ${l} === ""`),s.if(f,(0,qt._)`${l} = ${(0,qt.stringify)(r)}`)}var We={},K={};Object.defineProperty(K,"__esModule",{value:!0});K.validateUnion=K.validateArray=K.usePattern=K.callValidateCode=K.schemaProperties=K.allSchemaProperties=K.noPropertyInData=K.propertyInData=K.isOwnProperty=K.hasPropFunc=K.reportMissingProp=K.checkMissingProp=K.checkReportMissingProp=void 0;const ie=B,Ls=ee,Qe=Ke,jc=ee;function xc(e,t){const{gen:r,data:s,it:n}=e;r.if(Hs(r,s,t,n.opts.ownProperties),()=>{e.setParams({missingProperty:(0,ie._)`${t}`},!0),e.error()})}K.checkReportMissingProp=xc;function Rc({gen:e,data:t,it:{opts:r}},s,n){return(0,ie.or)(...s.map(o=>(0,ie.and)(Hs(e,t,o,r.ownProperties),(0,ie._)`${n} = ${o}`)))}K.checkMissingProp=Rc;function Oc(e,t){e.setParams({missingProperty:t},!0),e.error()}K.reportMissingProp=Oc;function si(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,ie._)`Object.prototype.hasOwnProperty`})}K.hasPropFunc=si;function zs(e,t,r){return(0,ie._)`${si(e)}.call(${t}, ${r})`}K.isOwnProperty=zs;function Ic(e,t,r,s){const n=(0,ie._)`${t}${(0,ie.getProperty)(r)} !== undefined`;return s?(0,ie._)`${n} && ${zs(e,t,r)}`:n}K.propertyInData=Ic;function Hs(e,t,r,s){const n=(0,ie._)`${t}${(0,ie.getProperty)(r)} === undefined`;return s?(0,ie.or)(n,(0,ie.not)(zs(e,t,r))):n}K.noPropertyInData=Hs;function ni(e){return e?Object.keys(e).filter(t=>t!=="__proto__"):[]}K.allSchemaProperties=ni;function qc(e,t){return ni(t).filter(r=>!(0,Ls.alwaysValidSchema)(e,t[r]))}K.schemaProperties=qc;function Ac({schemaCode:e,data:t,it:{gen:r,topSchemaRef:s,schemaPath:n,errorPath:o},it:i},l,f,u){const d=u?(0,ie._)`${e}, ${t}, ${s}${n}`:t,m=[[Qe.default.instancePath,(0,ie.strConcat)(Qe.default.instancePath,o)],[Qe.default.parentData,i.parentData],[Qe.default.parentDataProperty,i.parentDataProperty],[Qe.default.rootData,Qe.default.rootData]];i.opts.dynamicRef&&m.push([Qe.default.dynamicAnchors,Qe.default.dynamicAnchors]);const $=(0,ie._)`${d}, ${r.object(...m)}`;return f!==ie.nil?(0,ie._)`${l}.call(${f}, ${$})`:(0,ie._)`${l}(${$})`}K.callValidateCode=Ac;const Dc=(0,ie._)`new RegExp`;function Mc({gen:e,it:{opts:t}},r){const s=t.unicodeRegExp?"u":"",{regExp:n}=t.code,o=n(r,s);return e.scopeValue("pattern",{key:o.toString(),ref:o,code:(0,ie._)`${n.code==="new RegExp"?Dc:(0,jc.useFunc)(e,n)}(${r}, ${s})`})}K.usePattern=Mc;function Uc(e){const{gen:t,data:r,keyword:s,it:n}=e,o=t.name("valid");if(n.allErrors){const l=t.let("valid",!0);return i(()=>t.assign(l,!1)),l}return t.var(o,!0),i(()=>t.break()),o;function i(l){const f=t.const("len",(0,ie._)`${r}.length`);t.forRange("i",0,f,u=>{e.subschema({keyword:s,dataProp:u,dataPropType:Ls.Type.Num},o),t.if((0,ie.not)(o),l)})}}K.validateArray=Uc;function Fc(e){const{gen:t,schema:r,keyword:s,it:n}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(l=>(0,Ls.alwaysValidSchema)(n,l))&&!n.opts.unevaluated)return;const o=t.let("valid",!1),i=t.name("_valid");t.block(()=>r.forEach((l,f)=>{const u=e.subschema({keyword:s,schemaProp:f,compositeRule:!0},i);t.assign(o,(0,ie._)`${o} || ${i}`),e.mergeValidEvaluated(u,i)||t.if((0,ie.not)(o))})),e.result(o,()=>e.reset(),()=>e.error(!0))}K.validateUnion=Fc;Object.defineProperty(We,"__esModule",{value:!0});We.validateKeywordUsage=We.validSchemaType=We.funcKeywordCode=We.macroKeywordCode=void 0;const $e=B,dt=Ke,Lc=K,zc=wr;function Hc(e,t){const{gen:r,keyword:s,schema:n,parentSchema:o,it:i}=e,l=t.macro.call(i.self,n,o,i),f=oi(r,s,l);i.opts.validateSchema!==!1&&i.self.validateSchema(l,!0);const u=r.name("valid");e.subschema({schema:l,schemaPath:$e.nil,errSchemaPath:`${i.errSchemaPath}/${s}`,topSchemaRef:f,compositeRule:!0},u),e.pass(u,()=>e.error(!0))}We.macroKeywordCode=Hc;function Vc(e,t){var r;const{gen:s,keyword:n,schema:o,parentSchema:i,$data:l,it:f}=e;Kc(f,t);const u=!l&&t.compile?t.compile.call(f.self,o,i,f):t.validate,d=oi(s,n,u),m=s.let("valid");e.block$data(m,$),e.ok((r=t.valid)!==null&&r!==void 0?r:m);function $(){if(t.errors===!1)T(),t.modifying&&Xn(e),v(()=>e.error());else{const g=t.async?x():P();t.modifying&&Xn(e),v(()=>Wc(e,g))}}function x(){const g=s.let("ruleErrs",null);return s.try(()=>T((0,$e._)`await `),E=>s.assign(m,!1).if((0,$e._)`${E} instanceof ${f.ValidationError}`,()=>s.assign(g,(0,$e._)`${E}.errors`),()=>s.throw(E))),g}function P(){const g=(0,$e._)`${d}.errors`;return s.assign(g,null),T($e.nil),g}function T(g=t.async?(0,$e._)`await `:$e.nil){const E=f.opts.passContext?dt.default.this:dt.default.self,k=!("compile"in t&&!l||t.schema===!1);s.assign(m,(0,$e._)`${g}${(0,Lc.callValidateCode)(e,d,E,k)}`,t.modifying)}function v(g){var E;s.if((0,$e.not)((E=t.valid)!==null&&E!==void 0?E:m),g)}}We.funcKeywordCode=Vc;function Xn(e){const{gen:t,data:r,it:s}=e;t.if(s.parentData,()=>t.assign(r,(0,$e._)`${s.parentData}[${s.parentDataProperty}]`))}function Wc(e,t){const{gen:r}=e;r.if((0,$e._)`Array.isArray(${t})`,()=>{r.assign(dt.default.vErrors,(0,$e._)`${dt.default.vErrors} === null ? ${t} : ${dt.default.vErrors}.concat(${t})`).assign(dt.default.errors,(0,$e._)`${dt.default.vErrors}.length`),(0,zc.extendErrors)(e)},()=>e.error())}function Kc({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function oi(e,t,r){if(r===void 0)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,$e.stringify)(r)})}function Bc(e,t,r=!1){return!t.length||t.some(s=>s==="array"?Array.isArray(e):s==="object"?e&&typeof e=="object"&&!Array.isArray(e):typeof e==s||r&&typeof e>"u")}We.validSchemaType=Bc;function Gc({schema:e,opts:t,self:r,errSchemaPath:s},n,o){if(Array.isArray(n.keyword)?!n.keyword.includes(o):n.keyword!==o)throw new Error("ajv implementation error");const i=n.dependencies;if(i!=null&&i.some(l=>!Object.prototype.hasOwnProperty.call(e,l)))throw new Error(`parent schema must have dependencies of ${o}: ${i.join(",")}`);if(n.validateSchema&&!n.validateSchema(e[o])){const l=`keyword "${o}" value is invalid at path "${s}": `+r.errorsText(n.validateSchema.errors);if(t.validateSchema==="log")r.logger.error(l);else throw new Error(l)}}We.validateKeywordUsage=Gc;var st={};Object.defineProperty(st,"__esModule",{value:!0});st.extendSubschemaMode=st.extendSubschemaData=st.getSubschema=void 0;const Ve=B,ii=ee;function Jc(e,{keyword:t,schemaProp:r,schema:s,schemaPath:n,errSchemaPath:o,topSchemaRef:i}){if(t!==void 0&&s!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(t!==void 0){const l=e.schema[t];return r===void 0?{schema:l,schemaPath:(0,Ve._)`${e.schemaPath}${(0,Ve.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:l[r],schemaPath:(0,Ve._)`${e.schemaPath}${(0,Ve.getProperty)(t)}${(0,Ve.getProperty)(r)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,ii.escapeFragment)(r)}`}}if(s!==void 0){if(n===void 0||o===void 0||i===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:s,schemaPath:n,topSchemaRef:i,errSchemaPath:o}}throw new Error('either "keyword" or "schema" must be passed')}st.getSubschema=Jc;function Zc(e,t,{dataProp:r,dataPropType:s,data:n,dataTypes:o,propertyName:i}){if(n!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:l}=t;if(r!==void 0){const{errorPath:u,dataPathArr:d,opts:m}=t,$=l.let("data",(0,Ve._)`${t.data}${(0,Ve.getProperty)(r)}`,!0);f($),e.errorPath=(0,Ve.str)`${u}${(0,ii.getErrorPath)(r,s,m.jsPropertySyntax)}`,e.parentDataProperty=(0,Ve._)`${r}`,e.dataPathArr=[...d,e.parentDataProperty]}if(n!==void 0){const u=n instanceof Ve.Name?n:l.let("data",n,!0);f(u),i!==void 0&&(e.propertyName=i)}o&&(e.dataTypes=o);function f(u){e.data=u,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,u]}}st.extendSubschemaData=Zc;function Yc(e,{jtdDiscriminator:t,jtdMetadata:r,compositeRule:s,createErrors:n,allErrors:o}){s!==void 0&&(e.compositeRule=s),n!==void 0&&(e.createErrors=n),o!==void 0&&(e.allErrors=o),e.jtdDiscriminator=t,e.jtdMetadata=r}st.extendSubschemaMode=Yc;var ge={},ai=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var s,n,o;if(Array.isArray(t)){if(s=t.length,s!=r.length)return!1;for(n=s;n--!==0;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(o=Object.keys(t),s=o.length,s!==Object.keys(r).length)return!1;for(n=s;n--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[n]))return!1;for(n=s;n--!==0;){var i=o[n];if(!e(t[i],r[i]))return!1}return!0}return t!==t&&r!==r},ci={exports:{}},rt=ci.exports=function(e,t,r){typeof t=="function"&&(r=t,t={}),r=t.cb||r;var s=typeof r=="function"?r:r.pre||function(){},n=r.post||function(){};qr(t,s,n,e,"",e)};rt.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};rt.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};rt.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};rt.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function qr(e,t,r,s,n,o,i,l,f,u){if(s&&typeof s=="object"&&!Array.isArray(s)){t(s,n,o,i,l,f,u);for(var d in s){var m=s[d];if(Array.isArray(m)){if(d in rt.arrayKeywords)for(var $=0;$<m.length;$++)qr(e,t,r,m[$],n+"/"+d+"/"+$,o,n,d,s,$)}else if(d in rt.propsKeywords){if(m&&typeof m=="object")for(var x in m)qr(e,t,r,m[x],n+"/"+d+"/"+Qc(x),o,n,d,s,x)}else(d in rt.keywords||e.allKeys&&!(d in rt.skipKeywords))&&qr(e,t,r,m,n+"/"+d,o,n,d,s)}r(s,n,o,i,l,f,u)}}function Qc(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}var Xc=ci.exports;Object.defineProperty(ge,"__esModule",{value:!0});ge.getSchemaRefs=ge.resolveUrl=ge.normalizeId=ge._getFullPath=ge.getFullPath=ge.inlineRef=void 0;const el=ee,tl=ai,rl=Xc,sl=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function nl(e,t=!0){return typeof e=="boolean"?!0:t===!0?!js(e):t?li(e)<=t:!1}ge.inlineRef=nl;const ol=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function js(e){for(const t in e){if(ol.has(t))return!0;const r=e[t];if(Array.isArray(r)&&r.some(js)||typeof r=="object"&&js(r))return!0}return!1}function li(e){let t=0;for(const r in e)if(r==="$ref"||(t++,!sl.has(r)&&(typeof e[r]=="object"&&(0,el.eachItem)(e[r],s=>t+=li(s)),t===1/0)))return 1/0;return t}function ui(e,t="",r){r!==!1&&(t=Ut(t));const s=e.parse(t);return pi(e,s)}ge.getFullPath=ui;function pi(e,t){return e.serialize(t).split("#")[0]+"#"}ge._getFullPath=pi;const il=/#\/?$/;function Ut(e){return e?e.replace(il,""):""}ge.normalizeId=Ut;function al(e,t,r){return r=Ut(r),e.resolve(t,r)}ge.resolveUrl=al;const cl=/^[a-z_][-a-z0-9._]*$/i;function ll(e,t){if(typeof e=="boolean")return{};const{schemaId:r,uriResolver:s}=this.opts,n=Ut(e[r]||t),o={"":n},i=ui(s,n,!1),l={},f=new Set;return rl(e,{allKeys:!0},(m,$,x,P)=>{if(P===void 0)return;const T=i+$;let v=o[P];typeof m[r]=="string"&&(v=g.call(this,m[r])),E.call(this,m.$anchor),E.call(this,m.$dynamicAnchor),o[$]=v;function g(k){const R=this.opts.uriResolver.resolve;if(k=Ut(v?R(v,k):k),f.has(k))throw d(k);f.add(k);let q=this.refs[k];return typeof q=="string"&&(q=this.refs[q]),typeof q=="object"?u(m,q.schema,k):k!==Ut(T)&&(k[0]==="#"?(u(m,l[k],k),l[k]=m):this.refs[k]=T),k}function E(k){if(typeof k=="string"){if(!cl.test(k))throw new Error(`invalid anchor "${k}"`);g.call(this,`#${k}`)}}}),l;function u(m,$,x){if($!==void 0&&!tl(m,$))throw d(x)}function d(m){return new Error(`reference "${m}" resolves to more than one schema`)}}ge.getSchemaRefs=ll;Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getData=Ie.KeywordCxt=Ie.validateFunctionCode=void 0;const di=Bt,eo=vr,Vs=Je,Lr=vr,ul=fs,ur=We,bs=st,U=B,z=Ke,pl=ge,Ze=ee,ir=wr;function dl(e){if(mi(e)&&(yi(e),fi(e))){ml(e);return}hi(e,()=>(0,di.topBoolOrEmptySchema)(e))}Ie.validateFunctionCode=dl;function hi({gen:e,validateName:t,schema:r,schemaEnv:s,opts:n},o){n.code.es5?e.func(t,(0,U._)`${z.default.data}, ${z.default.valCxt}`,s.$async,()=>{e.code((0,U._)`"use strict"; ${to(r,n)}`),fl(e,n),e.code(o)}):e.func(t,(0,U._)`${z.default.data}, ${hl(n)}`,s.$async,()=>e.code(to(r,n)).code(o))}function hl(e){return(0,U._)`{${z.default.instancePath}="", ${z.default.parentData}, ${z.default.parentDataProperty}, ${z.default.rootData}=${z.default.data}${e.dynamicRef?(0,U._)`, ${z.default.dynamicAnchors}={}`:U.nil}}={}`}function fl(e,t){e.if(z.default.valCxt,()=>{e.var(z.default.instancePath,(0,U._)`${z.default.valCxt}.${z.default.instancePath}`),e.var(z.default.parentData,(0,U._)`${z.default.valCxt}.${z.default.parentData}`),e.var(z.default.parentDataProperty,(0,U._)`${z.default.valCxt}.${z.default.parentDataProperty}`),e.var(z.default.rootData,(0,U._)`${z.default.valCxt}.${z.default.rootData}`),t.dynamicRef&&e.var(z.default.dynamicAnchors,(0,U._)`${z.default.valCxt}.${z.default.dynamicAnchors}`)},()=>{e.var(z.default.instancePath,(0,U._)`""`),e.var(z.default.parentData,(0,U._)`undefined`),e.var(z.default.parentDataProperty,(0,U._)`undefined`),e.var(z.default.rootData,z.default.data),t.dynamicRef&&e.var(z.default.dynamicAnchors,(0,U._)`{}`)})}function ml(e){const{schema:t,opts:r,gen:s}=e;hi(e,()=>{r.$comment&&t.$comment&&wi(e),$l(e),s.let(z.default.vErrors,null),s.let(z.default.errors,0),r.unevaluated&&yl(e),gi(e),Pl(e)})}function yl(e){const{gen:t,validateName:r}=e;e.evaluated=t.const("evaluated",(0,U._)`${r}.evaluated`),t.if((0,U._)`${e.evaluated}.dynamicProps`,()=>t.assign((0,U._)`${e.evaluated}.props`,(0,U._)`undefined`)),t.if((0,U._)`${e.evaluated}.dynamicItems`,()=>t.assign((0,U._)`${e.evaluated}.items`,(0,U._)`undefined`))}function to(e,t){const r=typeof e=="object"&&e[t.schemaId];return r&&(t.code.source||t.code.process)?(0,U._)`/*# sourceURL=${r} */`:U.nil}function gl(e,t){if(mi(e)&&(yi(e),fi(e))){wl(e,t);return}(0,di.boolOrEmptySchema)(e,t)}function fi({schema:e,self:t}){if(typeof e=="boolean")return!e;for(const r in e)if(t.RULES.all[r])return!0;return!1}function mi(e){return typeof e.schema!="boolean"}function wl(e,t){const{schema:r,gen:s,opts:n}=e;n.$comment&&r.$comment&&wi(e),bl(e),_l(e);const o=s.const("_errs",z.default.errors);gi(e,o),s.var(t,(0,U._)`${o} === ${z.default.errors}`)}function yi(e){(0,Ze.checkUnknownRules)(e),vl(e)}function gi(e,t){if(e.opts.jtd)return ro(e,[],!1,t);const r=(0,eo.getSchemaTypes)(e.schema),s=(0,eo.coerceAndCheckDataType)(e,r);ro(e,r,!s,t)}function vl(e){const{schema:t,errSchemaPath:r,opts:s,self:n}=e;t.$ref&&s.ignoreKeywordsWithRef&&(0,Ze.schemaHasRulesButRef)(t,n.RULES)&&n.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function $l(e){const{schema:t,opts:r}=e;t.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,Ze.checkStrictMode)(e,"default is ignored in the schema root")}function bl(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,pl.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function _l(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function wi({gen:e,schemaEnv:t,schema:r,errSchemaPath:s,opts:n}){const o=r.$comment;if(n.$comment===!0)e.code((0,U._)`${z.default.self}.logger.log(${o})`);else if(typeof n.$comment=="function"){const i=(0,U.str)`${s}/$comment`,l=e.scopeValue("root",{ref:t.root});e.code((0,U._)`${z.default.self}.opts.$comment(${o}, ${i}, ${l}.schema)`)}}function Pl(e){const{gen:t,schemaEnv:r,validateName:s,ValidationError:n,opts:o}=e;r.$async?t.if((0,U._)`${z.default.errors} === 0`,()=>t.return(z.default.data),()=>t.throw((0,U._)`new ${n}(${z.default.vErrors})`)):(t.assign((0,U._)`${s}.errors`,z.default.vErrors),o.unevaluated&&El(e),t.return((0,U._)`${z.default.errors} === 0`))}function El({gen:e,evaluated:t,props:r,items:s}){r instanceof U.Name&&e.assign((0,U._)`${t}.props`,r),s instanceof U.Name&&e.assign((0,U._)`${t}.items`,s)}function ro(e,t,r,s){const{gen:n,schema:o,data:i,allErrors:l,opts:f,self:u}=e,{RULES:d}=u;if(o.$ref&&(f.ignoreKeywordsWithRef||!(0,Ze.schemaHasRulesButRef)(o,d))){n.block(()=>bi(e,"$ref",d.all.$ref.definition));return}f.jtd||Sl(e,t),n.block(()=>{for(const $ of d.rules)m($);m(d.post)});function m($){(0,Vs.shouldUseGroup)(o,$)&&($.type?(n.if((0,Lr.checkDataType)($.type,i,f.strictNumbers)),so(e,$),t.length===1&&t[0]===$.type&&r&&(n.else(),(0,Lr.reportTypeError)(e)),n.endIf()):so(e,$),l||n.if((0,U._)`${z.default.errors} === ${s||0}`))}}function so(e,t){const{gen:r,schema:s,opts:{useDefaults:n}}=e;n&&(0,ul.assignDefaults)(e,t.type),r.block(()=>{for(const o of t.rules)(0,Vs.shouldUseRule)(s,o)&&bi(e,o.keyword,o.definition,t.type)})}function Sl(e,t){e.schemaEnv.meta||!e.opts.strictTypes||(Tl(e,t),e.opts.allowUnionTypes||kl(e,t),Cl(e,e.dataTypes))}function Tl(e,t){if(t.length){if(!e.dataTypes.length){e.dataTypes=t;return}t.forEach(r=>{vi(e.dataTypes,r)||Ws(e,`type "${r}" not allowed by context "${e.dataTypes.join(",")}"`)}),jl(e,t)}}function kl(e,t){t.length>1&&!(t.length===2&&t.includes("null"))&&Ws(e,"use allowUnionTypes to allow union type keyword")}function Cl(e,t){const r=e.self.RULES.all;for(const s in r){const n=r[s];if(typeof n=="object"&&(0,Vs.shouldUseRule)(e.schema,n)){const{type:o}=n.definition;o.length&&!o.some(i=>Nl(t,i))&&Ws(e,`missing type "${o.join(",")}" for keyword "${s}"`)}}}function Nl(e,t){return e.includes(t)||t==="number"&&e.includes("integer")}function vi(e,t){return e.includes(t)||t==="integer"&&e.includes("number")}function jl(e,t){const r=[];for(const s of e.dataTypes)vi(t,s)?r.push(s):t.includes("integer")&&s==="number"&&r.push("integer");e.dataTypes=r}function Ws(e,t){const r=e.schemaEnv.baseId+e.errSchemaPath;t+=` at "${r}" (strictTypes)`,(0,Ze.checkStrictMode)(e,t,e.opts.strictTypes)}class $i{constructor(t,r,s){if((0,ur.validateKeywordUsage)(t,r,s),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=s,this.data=t.data,this.schema=t.schema[s],this.$data=r.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,Ze.schemaRefOrVal)(t,this.schema,s,this.$data),this.schemaType=r.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=r,this.$data)this.schemaCode=t.gen.const("vSchema",_i(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,ur.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${s} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=t.gen.const("_errs",z.default.errors))}result(t,r,s){this.failResult((0,U.not)(t),r,s)}failResult(t,r,s){this.gen.if(t),s?s():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,r){this.failResult((0,U.not)(t),void 0,r)}fail(t){if(t===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);const{schemaCode:r}=this;this.fail((0,U._)`${r} !== undefined && (${(0,U.or)(this.invalid$data(),t)})`)}error(t,r,s){if(r){this.setParams(r),this._error(t,s),this.setParams({});return}this._error(t,s)}_error(t,r){(t?ir.reportExtraError:ir.reportError)(this,this.def.error,r)}$dataError(){(0,ir.reportError)(this,this.def.$dataError||ir.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,ir.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,r){r?Object.assign(this.params,t):this.params=t}block$data(t,r,s=U.nil){this.gen.block(()=>{this.check$data(t,s),r()})}check$data(t=U.nil,r=U.nil){if(!this.$data)return;const{gen:s,schemaCode:n,schemaType:o,def:i}=this;s.if((0,U.or)((0,U._)`${n} === undefined`,r)),t!==U.nil&&s.assign(t,!0),(o.length||i.validateSchema)&&(s.elseIf(this.invalid$data()),this.$dataError(),t!==U.nil&&s.assign(t,!1)),s.else()}invalid$data(){const{gen:t,schemaCode:r,schemaType:s,def:n,it:o}=this;return(0,U.or)(i(),l());function i(){if(s.length){if(!(r instanceof U.Name))throw new Error("ajv implementation error");const f=Array.isArray(s)?s:[s];return(0,U._)`${(0,Lr.checkDataTypes)(f,r,o.opts.strictNumbers,Lr.DataType.Wrong)}`}return U.nil}function l(){if(n.validateSchema){const f=t.scopeValue("validate$data",{ref:n.validateSchema});return(0,U._)`!${f}(${r})`}return U.nil}}subschema(t,r){const s=(0,bs.getSubschema)(this.it,t);(0,bs.extendSubschemaData)(s,this.it,t),(0,bs.extendSubschemaMode)(s,t);const n={...this.it,...s,items:void 0,props:void 0};return gl(n,r),n}mergeEvaluated(t,r){const{it:s,gen:n}=this;s.opts.unevaluated&&(s.props!==!0&&t.props!==void 0&&(s.props=Ze.mergeEvaluated.props(n,t.props,s.props,r)),s.items!==!0&&t.items!==void 0&&(s.items=Ze.mergeEvaluated.items(n,t.items,s.items,r)))}mergeValidEvaluated(t,r){const{it:s,gen:n}=this;if(s.opts.unevaluated&&(s.props!==!0||s.items!==!0))return n.if(r,()=>this.mergeEvaluated(t,U.Name)),!0}}Ie.KeywordCxt=$i;function bi(e,t,r,s){const n=new $i(e,r,t);"code"in r?r.code(n,s):n.$data&&r.validate?(0,ur.funcKeywordCode)(n,r):"macro"in r?(0,ur.macroKeywordCode)(n,r):(r.compile||r.validate)&&(0,ur.funcKeywordCode)(n,r)}const xl=/^\/(?:[^~]|~0|~1)*$/,Rl=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function _i(e,{dataLevel:t,dataNames:r,dataPathArr:s}){let n,o;if(e==="")return z.default.rootData;if(e[0]==="/"){if(!xl.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);n=e,o=z.default.rootData}else{const u=Rl.exec(e);if(!u)throw new Error(`Invalid JSON-pointer: ${e}`);const d=+u[1];if(n=u[2],n==="#"){if(d>=t)throw new Error(f("property/index",d));return s[t-d]}if(d>t)throw new Error(f("data",d));if(o=r[t-d],!n)return o}let i=o;const l=n.split("/");for(const u of l)u&&(o=(0,U._)`${o}${(0,U.getProperty)((0,Ze.unescapeJsonPointer)(u))}`,i=(0,U._)`${i} && ${o}`);return i;function f(u,d){return`Cannot access ${u} ${d} levels up, current level is ${t}`}}Ie.getData=_i;var $r={};Object.defineProperty($r,"__esModule",{value:!0});class Ol extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}$r.default=Ol;var br={};Object.defineProperty(br,"__esModule",{value:!0});const _s=ge;class Il extends Error{constructor(t,r,s,n){super(n||`can't resolve reference ${s} from id ${r}`),this.missingRef=(0,_s.resolveUrl)(t,r,s),this.missingSchema=(0,_s.normalizeId)((0,_s.getFullPath)(t,this.missingRef))}}br.default=Il;var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.resolveSchema=Pe.getCompilingSchema=Pe.resolveRef=Pe.compileSchema=Pe.SchemaEnv=void 0;const xe=B,ql=$r,pt=Ke,Oe=ge,no=ee,Al=Ie;class ms{constructor(t){var r;this.refs={},this.dynamicAnchors={};let s;typeof t.schema=="object"&&(s=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=(r=t.baseId)!==null&&r!==void 0?r:(0,Oe.normalizeId)(s==null?void 0:s[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=s==null?void 0:s.$async,this.refs={}}}Pe.SchemaEnv=ms;function Ks(e){const t=Pi.call(this,e);if(t)return t;const r=(0,Oe.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:s,lines:n}=this.opts.code,{ownProperties:o}=this.opts,i=new xe.CodeGen(this.scope,{es5:s,lines:n,ownProperties:o});let l;e.$async&&(l=i.scopeValue("Error",{ref:ql.default,code:(0,xe._)`require("ajv/dist/runtime/validation_error").default`}));const f=i.scopeName("validate");e.validateName=f;const u={gen:i,allErrors:this.opts.allErrors,data:pt.default.data,parentData:pt.default.parentData,parentDataProperty:pt.default.parentDataProperty,dataNames:[pt.default.data],dataPathArr:[xe.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",this.opts.code.source===!0?{ref:e.schema,code:(0,xe.stringify)(e.schema)}:{ref:e.schema}),validateName:f,ValidationError:l,schema:e.schema,schemaEnv:e,rootId:r,baseId:e.baseId||r,schemaPath:xe.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,xe._)`""`,opts:this.opts,self:this};let d;try{this._compilations.add(e),(0,Al.validateFunctionCode)(u),i.optimize(this.opts.code.optimize);const m=i.toString();d=`${i.scopeRefs(pt.default.scope)}return ${m}`,this.opts.code.process&&(d=this.opts.code.process(d,e));const $=new Function(`${pt.default.self}`,`${pt.default.scope}`,d)(this,this.scope.get());if(this.scope.value(f,{ref:$}),$.errors=null,$.schema=e.schema,$.schemaEnv=e,e.$async&&($.$async=!0),this.opts.code.source===!0&&($.source={validateName:f,validateCode:m,scopeValues:i._values}),this.opts.unevaluated){const{props:x,items:P}=u;$.evaluated={props:x instanceof xe.Name?void 0:x,items:P instanceof xe.Name?void 0:P,dynamicProps:x instanceof xe.Name,dynamicItems:P instanceof xe.Name},$.source&&($.source.evaluated=(0,xe.stringify)($.evaluated))}return e.validate=$,e}catch(m){throw delete e.validate,delete e.validateName,d&&this.logger.error("Error compiling schema, function code:",d),m}finally{this._compilations.delete(e)}}Pe.compileSchema=Ks;function Dl(e,t,r){var s;r=(0,Oe.resolveUrl)(this.opts.uriResolver,t,r);const n=e.refs[r];if(n)return n;let o=Fl.call(this,e,r);if(o===void 0){const i=(s=e.localRefs)===null||s===void 0?void 0:s[r],{schemaId:l}=this.opts;i&&(o=new ms({schema:i,schemaId:l,root:e,baseId:t}))}if(o!==void 0)return e.refs[r]=Ml.call(this,o)}Pe.resolveRef=Dl;function Ml(e){return(0,Oe.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:Ks.call(this,e)}function Pi(e){for(const t of this._compilations)if(Ul(t,e))return t}Pe.getCompilingSchema=Pi;function Ul(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function Fl(e,t){let r;for(;typeof(r=this.refs[t])=="string";)t=r;return r||this.schemas[t]||ys.call(this,e,t)}function ys(e,t){const r=this.opts.uriResolver.parse(t),s=(0,Oe._getFullPath)(this.opts.uriResolver,r);let n=(0,Oe.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&s===n)return Ps.call(this,r,e);const o=(0,Oe.normalizeId)(s),i=this.refs[o]||this.schemas[o];if(typeof i=="string"){const l=ys.call(this,e,i);return typeof(l==null?void 0:l.schema)!="object"?void 0:Ps.call(this,r,l)}if(typeof(i==null?void 0:i.schema)=="object"){if(i.validate||Ks.call(this,i),o===(0,Oe.normalizeId)(t)){const{schema:l}=i,{schemaId:f}=this.opts,u=l[f];return u&&(n=(0,Oe.resolveUrl)(this.opts.uriResolver,n,u)),new ms({schema:l,schemaId:f,root:e,baseId:n})}return Ps.call(this,r,i)}}Pe.resolveSchema=ys;const Ll=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function Ps(e,{baseId:t,schema:r,root:s}){var n;if(((n=e.fragment)===null||n===void 0?void 0:n[0])!=="/")return;for(const l of e.fragment.slice(1).split("/")){if(typeof r=="boolean")return;const f=r[(0,no.unescapeFragment)(l)];if(f===void 0)return;r=f;const u=typeof r=="object"&&r[this.opts.schemaId];!Ll.has(l)&&u&&(t=(0,Oe.resolveUrl)(this.opts.uriResolver,t,u))}let o;if(typeof r!="boolean"&&r.$ref&&!(0,no.schemaHasRulesButRef)(r,this.RULES)){const l=(0,Oe.resolveUrl)(this.opts.uriResolver,t,r.$ref);o=ys.call(this,s,l)}const{schemaId:i}=this.opts;if(o=o||new ms({schema:r,schemaId:i,root:s,baseId:t}),o.schema!==o.root.schema)return o}const zl="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Hl="Meta-schema for $data reference (JSON AnySchema extension proposal)",Vl="object",Wl=["$data"],Kl={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},Bl=!1,Gl={$id:zl,description:Hl,type:Vl,required:Wl,properties:Kl,additionalProperties:Bl};var Bs={},xs={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(e,t){(function(r,s){s(t)})(fc,function(r){function s(){for(var a=arguments.length,p=Array(a),h=0;h<a;h++)p[h]=arguments[h];if(p.length>1){p[0]=p[0].slice(0,-1);for(var C=p.length-1,j=1;j<C;++j)p[j]=p[j].slice(1,-1);return p[C]=p[C].slice(1),p.join("")}else return p[0]}function n(a){return"(?:"+a+")"}function o(a){return a===void 0?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}function i(a){return a.toUpperCase()}function l(a){return a!=null?a instanceof Array?a:typeof a.length!="number"||a.split||a.setInterval||a.call?[a]:Array.prototype.slice.call(a):[]}function f(a,p){var h=a;if(p)for(var C in p)h[C]=p[C];return h}function u(a){var p="[A-Za-z]",h="[0-9]",C=s(h,"[A-Fa-f]"),j=n(n("%[EFef]"+C+"%"+C+C+"%"+C+C)+"|"+n("%[89A-Fa-f]"+C+"%"+C+C)+"|"+n("%"+C+C)),L="[\\:\\/\\?\\#\\[\\]\\@]",F="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",te=s(L,F),de=a?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",se=a?"[\\uE000-\\uF8FF]":"[]",Q=s(p,h,"[\\-\\.\\_\\~]",de);n(p+s(p,h,"[\\+\\-\\.]")+"*"),n(n(j+"|"+s(Q,F,"[\\:]"))+"*");var oe=n(n("25[0-5]")+"|"+n("2[0-4]"+h)+"|"+n("1"+h+h)+"|"+n("0?[1-9]"+h)+"|0?0?"+h),le=n(oe+"\\."+oe+"\\."+oe+"\\."+oe),V=n(C+"{1,4}"),he=n(n(V+"\\:"+V)+"|"+le),ne=n(n(V+"\\:")+"{6}"+he),ke=n("\\:\\:"+n(V+"\\:")+"{5}"+he),Ot=n(n(V)+"?\\:\\:"+n(V+"\\:")+"{4}"+he),je=n(n(n(V+"\\:")+"{0,1}"+V)+"?\\:\\:"+n(V+"\\:")+"{3}"+he),Be=n(n(n(V+"\\:")+"{0,2}"+V)+"?\\:\\:"+n(V+"\\:")+"{2}"+he),ct=n(n(n(V+"\\:")+"{0,3}"+V)+"?\\:\\:"+V+"\\:"+he),lt=n(n(n(V+"\\:")+"{0,4}"+V)+"?\\:\\:"+he),Ce=n(n(n(V+"\\:")+"{0,5}"+V)+"?\\:\\:"+V),Ge=n(n(n(V+"\\:")+"{0,6}"+V)+"?\\:\\:"),ut=n([ne,ke,Ot,je,Be,ct,lt,Ce,Ge].join("|")),Le=n(n(Q+"|"+j)+"+");n("[vV]"+C+"+\\."+s(Q,F,"[\\:]")+"+"),n(n(j+"|"+s(Q,F))+"*");var Er=n(j+"|"+s(Q,F,"[\\:\\@]"));return n(n(j+"|"+s(Q,F,"[\\@]"))+"+"),n(n(Er+"|"+s("[\\/\\?]",se))+"*"),{NOT_SCHEME:new RegExp(s("[^]",p,h,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(s("[^\\%\\:]",Q,F),"g"),NOT_HOST:new RegExp(s("[^\\%\\[\\]\\:]",Q,F),"g"),NOT_PATH:new RegExp(s("[^\\%\\/\\:\\@]",Q,F),"g"),NOT_PATH_NOSCHEME:new RegExp(s("[^\\%\\/\\@]",Q,F),"g"),NOT_QUERY:new RegExp(s("[^\\%]",Q,F,"[\\:\\@\\/\\?]",se),"g"),NOT_FRAGMENT:new RegExp(s("[^\\%]",Q,F,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(s("[^]",Q,F),"g"),UNRESERVED:new RegExp(Q,"g"),OTHER_CHARS:new RegExp(s("[^\\%]",Q,te),"g"),PCT_ENCODED:new RegExp(j,"g"),IPV4ADDRESS:new RegExp("^("+le+")$"),IPV6ADDRESS:new RegExp("^\\[?("+ut+")"+n(n("\\%25|\\%(?!"+C+"{2})")+"("+Le+")")+"?\\]?$")}}var d=u(!1),m=u(!0),$=function(){function a(p,h){var C=[],j=!0,L=!1,F=void 0;try{for(var te=p[Symbol.iterator](),de;!(j=(de=te.next()).done)&&(C.push(de.value),!(h&&C.length===h));j=!0);}catch(se){L=!0,F=se}finally{try{!j&&te.return&&te.return()}finally{if(L)throw F}}return C}return function(p,h){if(Array.isArray(p))return p;if(Symbol.iterator in Object(p))return a(p,h);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),x=function(a){if(Array.isArray(a)){for(var p=0,h=Array(a.length);p<a.length;p++)h[p]=a[p];return h}else return Array.from(a)},P=2147483647,T=36,v=1,g=26,E=38,k=700,R=72,q=128,b="-",S=/^xn--/,I=/[^\0-\x7E]/,H=/[\x2E\u3002\uFF0E\uFF61]/g,G={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ae=T-v,Y=Math.floor,Se=String.fromCharCode;function pe(a){throw new RangeError(G[a])}function nt(a,p){for(var h=[],C=a.length;C--;)h[C]=p(a[C]);return h}function ot(a,p){var h=a.split("@"),C="";h.length>1&&(C=h[0]+"@",a=h[1]),a=a.replace(H,".");var j=a.split("."),L=nt(j,p).join(".");return C+L}function St(a){for(var p=[],h=0,C=a.length;h<C;){var j=a.charCodeAt(h++);if(j>=55296&&j<=56319&&h<C){var L=a.charCodeAt(h++);(L&64512)==56320?p.push(((j&1023)<<10)+(L&1023)+65536):(p.push(j),h--)}else p.push(j)}return p}var Yt=function(a){return String.fromCodePoint.apply(String,x(a))},Tt=function(a){return a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:T},A=function(a,p){return a+22+75*(a<26)-((p!=0)<<5)},w=function(a,p,h){var C=0;for(a=h?Y(a/k):a>>1,a+=Y(a/p);a>ae*g>>1;C+=T)a=Y(a/ae);return Y(C+(ae+1)*a/(a+E))},O=function(a){var p=[],h=a.length,C=0,j=q,L=R,F=a.lastIndexOf(b);F<0&&(F=0);for(var te=0;te<F;++te)a.charCodeAt(te)>=128&&pe("not-basic"),p.push(a.charCodeAt(te));for(var de=F>0?F+1:0;de<h;){for(var se=C,Q=1,oe=T;;oe+=T){de>=h&&pe("invalid-input");var le=Tt(a.charCodeAt(de++));(le>=T||le>Y((P-C)/Q))&&pe("overflow"),C+=le*Q;var V=oe<=L?v:oe>=L+g?g:oe-L;if(le<V)break;var he=T-V;Q>Y(P/he)&&pe("overflow"),Q*=he}var ne=p.length+1;L=w(C-se,ne,se==0),Y(C/ne)>P-j&&pe("overflow"),j+=Y(C/ne),C%=ne,p.splice(C++,0,j)}return String.fromCodePoint.apply(String,p)},_=function(a){var p=[];a=St(a);var h=a.length,C=q,j=0,L=R,F=!0,te=!1,de=void 0;try{for(var se=a[Symbol.iterator](),Q;!(F=(Q=se.next()).done);F=!0){var oe=Q.value;oe<128&&p.push(Se(oe))}}catch(or){te=!0,de=or}finally{try{!F&&se.return&&se.return()}finally{if(te)throw de}}var le=p.length,V=le;for(le&&p.push(b);V<h;){var he=P,ne=!0,ke=!1,Ot=void 0;try{for(var je=a[Symbol.iterator](),Be;!(ne=(Be=je.next()).done);ne=!0){var ct=Be.value;ct>=C&&ct<he&&(he=ct)}}catch(or){ke=!0,Ot=or}finally{try{!ne&&je.return&&je.return()}finally{if(ke)throw Ot}}var lt=V+1;he-C>Y((P-j)/lt)&&pe("overflow"),j+=(he-C)*lt,C=he;var Ce=!0,Ge=!1,ut=void 0;try{for(var Le=a[Symbol.iterator](),Er;!(Ce=(Er=Le.next()).done);Ce=!0){var An=Er.value;if(An<C&&++j>P&&pe("overflow"),An==C){for(var Sr=j,Tr=T;;Tr+=T){var kr=Tr<=L?v:Tr>=L+g?g:Tr-L;if(Sr<kr)break;var Dn=Sr-kr,Mn=T-kr;p.push(Se(A(kr+Dn%Mn,0))),Sr=Y(Dn/Mn)}p.push(Se(A(Sr,0))),L=w(j,lt,V==le),j=0,++V}}}catch(or){Ge=!0,ut=or}finally{try{!Ce&&Le.return&&Le.return()}finally{if(Ge)throw ut}}++j,++C}return p.join("")},c=function(a){return ot(a,function(p){return S.test(p)?O(p.slice(4).toLowerCase()):p})},y=function(a){return ot(a,function(p){return I.test(p)?"xn--"+_(p):p})},N={version:"2.1.0",ucs2:{decode:St,encode:Yt},decode:O,encode:_,toASCII:y,toUnicode:c},D={};function M(a){var p=a.charCodeAt(0),h=void 0;return p<16?h="%0"+p.toString(16).toUpperCase():p<128?h="%"+p.toString(16).toUpperCase():p<2048?h="%"+(p>>6|192).toString(16).toUpperCase()+"%"+(p&63|128).toString(16).toUpperCase():h="%"+(p>>12|224).toString(16).toUpperCase()+"%"+(p>>6&63|128).toString(16).toUpperCase()+"%"+(p&63|128).toString(16).toUpperCase(),h}function J(a){for(var p="",h=0,C=a.length;h<C;){var j=parseInt(a.substr(h+1,2),16);if(j<128)p+=String.fromCharCode(j),h+=3;else if(j>=194&&j<224){if(C-h>=6){var L=parseInt(a.substr(h+4,2),16);p+=String.fromCharCode((j&31)<<6|L&63)}else p+=a.substr(h,6);h+=6}else if(j>=224){if(C-h>=9){var F=parseInt(a.substr(h+4,2),16),te=parseInt(a.substr(h+7,2),16);p+=String.fromCharCode((j&15)<<12|(F&63)<<6|te&63)}else p+=a.substr(h,9);h+=9}else p+=a.substr(h,3),h+=3}return p}function Z(a,p){function h(C){var j=J(C);return j.match(p.UNRESERVED)?j:C}return a.scheme&&(a.scheme=String(a.scheme).replace(p.PCT_ENCODED,h).toLowerCase().replace(p.NOT_SCHEME,"")),a.userinfo!==void 0&&(a.userinfo=String(a.userinfo).replace(p.PCT_ENCODED,h).replace(p.NOT_USERINFO,M).replace(p.PCT_ENCODED,i)),a.host!==void 0&&(a.host=String(a.host).replace(p.PCT_ENCODED,h).toLowerCase().replace(p.NOT_HOST,M).replace(p.PCT_ENCODED,i)),a.path!==void 0&&(a.path=String(a.path).replace(p.PCT_ENCODED,h).replace(a.scheme?p.NOT_PATH:p.NOT_PATH_NOSCHEME,M).replace(p.PCT_ENCODED,i)),a.query!==void 0&&(a.query=String(a.query).replace(p.PCT_ENCODED,h).replace(p.NOT_QUERY,M).replace(p.PCT_ENCODED,i)),a.fragment!==void 0&&(a.fragment=String(a.fragment).replace(p.PCT_ENCODED,h).replace(p.NOT_FRAGMENT,M).replace(p.PCT_ENCODED,i)),a}function ce(a){return a.replace(/^0*(.*)/,"$1")||"0"}function Me(a,p){var h=a.match(p.IPV4ADDRESS)||[],C=$(h,2),j=C[1];return j?j.split(".").map(ce).join("."):a}function kt(a,p){var h=a.match(p.IPV6ADDRESS)||[],C=$(h,3),j=C[1],L=C[2];if(j){for(var F=j.toLowerCase().split("::").reverse(),te=$(F,2),de=te[0],se=te[1],Q=se?se.split(":").map(ce):[],oe=de.split(":").map(ce),le=p.IPV4ADDRESS.test(oe[oe.length-1]),V=le?7:8,he=oe.length-V,ne=Array(V),ke=0;ke<V;++ke)ne[ke]=Q[ke]||oe[he+ke]||"";le&&(ne[V-1]=Me(ne[V-1],p));var Ot=ne.reduce(function(Ce,Ge,ut){if(!Ge||Ge==="0"){var Le=Ce[Ce.length-1];Le&&Le.index+Le.length===ut?Le.length++:Ce.push({index:ut,length:1})}return Ce},[]),je=Ot.sort(function(Ce,Ge){return Ge.length-Ce.length})[0],Be=void 0;if(je&&je.length>1){var ct=ne.slice(0,je.index),lt=ne.slice(je.index+je.length);Be=ct.join(":")+"::"+lt.join(":")}else Be=ne.join(":");return L&&(Be+="%"+L),Be}else return a}var Qt=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Xt="".match(/(){0}/)[1]===void 0;function Ee(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h={},C=p.iri!==!1?m:d;p.reference==="suffix"&&(a=(p.scheme?p.scheme+":":"")+"//"+a);var j=a.match(Qt);if(j){Xt?(h.scheme=j[1],h.userinfo=j[3],h.host=j[4],h.port=parseInt(j[5],10),h.path=j[6]||"",h.query=j[7],h.fragment=j[8],isNaN(h.port)&&(h.port=j[5])):(h.scheme=j[1]||void 0,h.userinfo=a.indexOf("@")!==-1?j[3]:void 0,h.host=a.indexOf("//")!==-1?j[4]:void 0,h.port=parseInt(j[5],10),h.path=j[6]||"",h.query=a.indexOf("?")!==-1?j[7]:void 0,h.fragment=a.indexOf("#")!==-1?j[8]:void 0,isNaN(h.port)&&(h.port=a.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?j[4]:void 0)),h.host&&(h.host=kt(Me(h.host,C),C)),h.scheme===void 0&&h.userinfo===void 0&&h.host===void 0&&h.port===void 0&&!h.path&&h.query===void 0?h.reference="same-document":h.scheme===void 0?h.reference="relative":h.fragment===void 0?h.reference="absolute":h.reference="uri",p.reference&&p.reference!=="suffix"&&p.reference!==h.reference&&(h.error=h.error||"URI is not a "+p.reference+" reference.");var L=D[(p.scheme||h.scheme||"").toLowerCase()];if(!p.unicodeSupport&&(!L||!L.unicodeSupport)){if(h.host&&(p.domainHost||L&&L.domainHost))try{h.host=N.toASCII(h.host.replace(C.PCT_ENCODED,J).toLowerCase())}catch(F){h.error=h.error||"Host's domain name can not be converted to ASCII via punycode: "+F}Z(h,d)}else Z(h,C);L&&L.parse&&L.parse(h,p)}else h.error=h.error||"URI can not be parsed.";return h}function er(a,p){var h=p.iri!==!1?m:d,C=[];return a.userinfo!==void 0&&(C.push(a.userinfo),C.push("@")),a.host!==void 0&&C.push(kt(Me(String(a.host),h),h).replace(h.IPV6ADDRESS,function(j,L,F){return"["+L+(F?"%25"+F:"")+"]"})),(typeof a.port=="number"||typeof a.port=="string")&&(C.push(":"),C.push(String(a.port))),C.length?C.join(""):void 0}var Ct=/^\.\.?\//,Nt=/^\/\.(\/|$)/,jt=/^\/\.\.(\/|$)/,tr=/^\/?(?:.|\n)*?(?=\/|$)/;function Ue(a){for(var p=[];a.length;)if(a.match(Ct))a=a.replace(Ct,"");else if(a.match(Nt))a=a.replace(Nt,"/");else if(a.match(jt))a=a.replace(jt,"/"),p.pop();else if(a==="."||a==="..")a="";else{var h=a.match(tr);if(h){var C=h[0];a=a.slice(C.length),p.push(C)}else throw new Error("Unexpected dot segment condition")}return p.join("")}function be(a){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},h=p.iri?m:d,C=[],j=D[(p.scheme||a.scheme||"").toLowerCase()];if(j&&j.serialize&&j.serialize(a,p),a.host&&!h.IPV6ADDRESS.test(a.host)&&(p.domainHost||j&&j.domainHost))try{a.host=p.iri?N.toUnicode(a.host):N.toASCII(a.host.replace(h.PCT_ENCODED,J).toLowerCase())}catch(te){a.error=a.error||"Host's domain name can not be converted to "+(p.iri?"Unicode":"ASCII")+" via punycode: "+te}Z(a,h),p.reference!=="suffix"&&a.scheme&&(C.push(a.scheme),C.push(":"));var L=er(a,p);if(L!==void 0&&(p.reference!=="suffix"&&C.push("//"),C.push(L),a.path&&a.path.charAt(0)!=="/"&&C.push("/")),a.path!==void 0){var F=a.path;!p.absolutePath&&(!j||!j.absolutePath)&&(F=Ue(F)),L===void 0&&(F=F.replace(/^\/\//,"/%2F")),C.push(F)}return a.query!==void 0&&(C.push("?"),C.push(a.query)),a.fragment!==void 0&&(C.push("#"),C.push(a.fragment)),C.join("")}function xt(a,p){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},C=arguments[3],j={};return C||(a=Ee(be(a,h),h),p=Ee(be(p,h),h)),h=h||{},!h.tolerant&&p.scheme?(j.scheme=p.scheme,j.userinfo=p.userinfo,j.host=p.host,j.port=p.port,j.path=Ue(p.path||""),j.query=p.query):(p.userinfo!==void 0||p.host!==void 0||p.port!==void 0?(j.userinfo=p.userinfo,j.host=p.host,j.port=p.port,j.path=Ue(p.path||""),j.query=p.query):(p.path?(p.path.charAt(0)==="/"?j.path=Ue(p.path):((a.userinfo!==void 0||a.host!==void 0||a.port!==void 0)&&!a.path?j.path="/"+p.path:a.path?j.path=a.path.slice(0,a.path.lastIndexOf("/")+1)+p.path:j.path=p.path,j.path=Ue(j.path)),j.query=p.query):(j.path=a.path,p.query!==void 0?j.query=p.query:j.query=a.query),j.userinfo=a.userinfo,j.host=a.host,j.port=a.port),j.scheme=a.scheme),j.fragment=p.fragment,j}function rr(a,p,h){var C=f({scheme:"null"},h);return be(xt(Ee(a,C),Ee(p,C),C,!0),C)}function it(a,p){return typeof a=="string"?a=be(Ee(a,p),p):o(a)==="object"&&(a=Ee(be(a,p),p)),a}function sr(a,p,h){return typeof a=="string"?a=be(Ee(a,h),h):o(a)==="object"&&(a=be(a,h)),typeof p=="string"?p=be(Ee(p,h),h):o(p)==="object"&&(p=be(p,h)),a===p}function Pr(a,p){return a&&a.toString().replace(!p||!p.iri?d.ESCAPE:m.ESCAPE,M)}function Te(a,p){return a&&a.toString().replace(!p||!p.iri?d.PCT_ENCODED:m.PCT_ENCODED,J)}var at={scheme:"http",domainHost:!0,parse:function(a,p){return a.host||(a.error=a.error||"HTTP URIs must have a host."),a},serialize:function(a,p){var h=String(a.scheme).toLowerCase()==="https";return(a.port===(h?443:80)||a.port==="")&&(a.port=void 0),a.path||(a.path="/"),a}},Cn={scheme:"https",domainHost:at.domainHost,parse:at.parse,serialize:at.serialize};function Nn(a){return typeof a.secure=="boolean"?a.secure:String(a.scheme).toLowerCase()==="wss"}var nr={scheme:"ws",domainHost:!0,parse:function(a,p){var h=a;return h.secure=Nn(h),h.resourceName=(h.path||"/")+(h.query?"?"+h.query:""),h.path=void 0,h.query=void 0,h},serialize:function(a,p){if((a.port===(Nn(a)?443:80)||a.port==="")&&(a.port=void 0),typeof a.secure=="boolean"&&(a.scheme=a.secure?"wss":"ws",a.secure=void 0),a.resourceName){var h=a.resourceName.split("?"),C=$(h,2),j=C[0],L=C[1];a.path=j&&j!=="/"?j:void 0,a.query=L,a.resourceName=void 0}return a.fragment=void 0,a}},jn={scheme:"wss",domainHost:nr.domainHost,parse:nr.parse,serialize:nr.serialize},Li={},xn="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Fe="[0-9A-Fa-f]",zi=n(n("%[EFef]"+Fe+"%"+Fe+Fe+"%"+Fe+Fe)+"|"+n("%[89A-Fa-f]"+Fe+"%"+Fe+Fe)+"|"+n("%"+Fe+Fe)),Hi="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Vi="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Wi=s(Vi,'[\\"\\\\]'),Ki="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Bi=new RegExp(xn,"g"),Rt=new RegExp(zi,"g"),Gi=new RegExp(s("[^]",Hi,"[\\.]",'[\\"]',Wi),"g"),Rn=new RegExp(s("[^]",xn,Ki),"g"),Ji=Rn;function ws(a){var p=J(a);return p.match(Bi)?p:a}var On={scheme:"mailto",parse:function(a,p){var h=a,C=h.to=h.path?h.path.split(","):[];if(h.path=void 0,h.query){for(var j=!1,L={},F=h.query.split("&"),te=0,de=F.length;te<de;++te){var se=F[te].split("=");switch(se[0]){case"to":for(var Q=se[1].split(","),oe=0,le=Q.length;oe<le;++oe)C.push(Q[oe]);break;case"subject":h.subject=Te(se[1],p);break;case"body":h.body=Te(se[1],p);break;default:j=!0,L[Te(se[0],p)]=Te(se[1],p);break}}j&&(h.headers=L)}h.query=void 0;for(var V=0,he=C.length;V<he;++V){var ne=C[V].split("@");if(ne[0]=Te(ne[0]),p.unicodeSupport)ne[1]=Te(ne[1],p).toLowerCase();else try{ne[1]=N.toASCII(Te(ne[1],p).toLowerCase())}catch(ke){h.error=h.error||"Email address's domain name can not be converted to ASCII via punycode: "+ke}C[V]=ne.join("@")}return h},serialize:function(a,p){var h=a,C=l(a.to);if(C){for(var j=0,L=C.length;j<L;++j){var F=String(C[j]),te=F.lastIndexOf("@"),de=F.slice(0,te).replace(Rt,ws).replace(Rt,i).replace(Gi,M),se=F.slice(te+1);try{se=p.iri?N.toUnicode(se):N.toASCII(Te(se,p).toLowerCase())}catch(V){h.error=h.error||"Email address's domain name can not be converted to "+(p.iri?"Unicode":"ASCII")+" via punycode: "+V}C[j]=de+"@"+se}h.path=C.join(",")}var Q=a.headers=a.headers||{};a.subject&&(Q.subject=a.subject),a.body&&(Q.body=a.body);var oe=[];for(var le in Q)Q[le]!==Li[le]&&oe.push(le.replace(Rt,ws).replace(Rt,i).replace(Rn,M)+"="+Q[le].replace(Rt,ws).replace(Rt,i).replace(Ji,M));return oe.length&&(h.query=oe.join("&")),h}},Zi=/^([^\:]+)\:(.*)/,In={scheme:"urn",parse:function(a,p){var h=a.path&&a.path.match(Zi),C=a;if(h){var j=p.scheme||C.scheme||"urn",L=h[1].toLowerCase(),F=h[2],te=j+":"+(p.nid||L),de=D[te];C.nid=L,C.nss=F,C.path=void 0,de&&(C=de.parse(C,p))}else C.error=C.error||"URN can not be parsed.";return C},serialize:function(a,p){var h=p.scheme||a.scheme||"urn",C=a.nid,j=h+":"+(p.nid||C),L=D[j];L&&(a=L.serialize(a,p));var F=a,te=a.nss;return F.path=(C||p.nid)+":"+te,F}},Yi=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,qn={scheme:"urn:uuid",parse:function(a,p){var h=a;return h.uuid=h.nss,h.nss=void 0,!p.tolerant&&(!h.uuid||!h.uuid.match(Yi))&&(h.error=h.error||"UUID is not valid."),h},serialize:function(a,p){var h=a;return h.nss=(a.uuid||"").toLowerCase(),h}};D[at.scheme]=at,D[Cn.scheme]=Cn,D[nr.scheme]=nr,D[jn.scheme]=jn,D[On.scheme]=On,D[In.scheme]=In,D[qn.scheme]=qn,r.SCHEMES=D,r.pctEncChar=M,r.pctDecChars=J,r.parse=Ee,r.removeDotSegments=Ue,r.serialize=be,r.resolveComponents=xt,r.resolve=rr,r.normalize=it,r.equal=sr,r.escapeComponent=Pr,r.unescapeComponent=Te,Object.defineProperty(r,"__esModule",{value:!0})})})(xs,xs.exports);var Jl=xs.exports;Object.defineProperty(Bs,"__esModule",{value:!0});const Ei=Jl;Ei.code='require("ajv/dist/runtime/uri").default';Bs.default=Ei;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=Ie;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=B;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const s=$r,n=br,o=_t,i=Pe,l=B,f=ge,u=vr,d=ee,m=Gl,$=Bs,x=(A,w)=>new RegExp(A,w);x.code="new RegExp";const P=["removeAdditional","useDefaults","coerceTypes"],T=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),v={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},g={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},E=200;function k(A){var w,O,_,c,y,N,D,M,J,Z,ce,Me,kt,Qt,Xt,Ee,er,Ct,Nt,jt,tr,Ue,be,xt,rr;const it=A.strict,sr=(w=A.code)===null||w===void 0?void 0:w.optimize,Pr=sr===!0||sr===void 0?1:sr||0,Te=(_=(O=A.code)===null||O===void 0?void 0:O.regExp)!==null&&_!==void 0?_:x,at=(c=A.uriResolver)!==null&&c!==void 0?c:$.default;return{strictSchema:(N=(y=A.strictSchema)!==null&&y!==void 0?y:it)!==null&&N!==void 0?N:!0,strictNumbers:(M=(D=A.strictNumbers)!==null&&D!==void 0?D:it)!==null&&M!==void 0?M:!0,strictTypes:(Z=(J=A.strictTypes)!==null&&J!==void 0?J:it)!==null&&Z!==void 0?Z:"log",strictTuples:(Me=(ce=A.strictTuples)!==null&&ce!==void 0?ce:it)!==null&&Me!==void 0?Me:"log",strictRequired:(Qt=(kt=A.strictRequired)!==null&&kt!==void 0?kt:it)!==null&&Qt!==void 0?Qt:!1,code:A.code?{...A.code,optimize:Pr,regExp:Te}:{optimize:Pr,regExp:Te},loopRequired:(Xt=A.loopRequired)!==null&&Xt!==void 0?Xt:E,loopEnum:(Ee=A.loopEnum)!==null&&Ee!==void 0?Ee:E,meta:(er=A.meta)!==null&&er!==void 0?er:!0,messages:(Ct=A.messages)!==null&&Ct!==void 0?Ct:!0,inlineRefs:(Nt=A.inlineRefs)!==null&&Nt!==void 0?Nt:!0,schemaId:(jt=A.schemaId)!==null&&jt!==void 0?jt:"$id",addUsedSchema:(tr=A.addUsedSchema)!==null&&tr!==void 0?tr:!0,validateSchema:(Ue=A.validateSchema)!==null&&Ue!==void 0?Ue:!0,validateFormats:(be=A.validateFormats)!==null&&be!==void 0?be:!0,unicodeRegExp:(xt=A.unicodeRegExp)!==null&&xt!==void 0?xt:!0,int32range:(rr=A.int32range)!==null&&rr!==void 0?rr:!0,uriResolver:at}}class R{constructor(w={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,w=this.opts={...w,...k(w)};const{es5:O,lines:_}=this.opts.code;this.scope=new l.ValueScope({scope:{},prefixes:T,es5:O,lines:_}),this.logger=Y(w.logger);const c=w.validateFormats;w.validateFormats=!1,this.RULES=(0,o.getRules)(),q.call(this,v,w,"NOT SUPPORTED"),q.call(this,g,w,"DEPRECATED","warn"),this._metaOpts=G.call(this),w.formats&&I.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),w.keywords&&H.call(this,w.keywords),typeof w.meta=="object"&&this.addMetaSchema(w.meta),S.call(this),w.validateFormats=c}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:w,meta:O,schemaId:_}=this.opts;let c=m;_==="id"&&(c={...m},c.id=c.$id,delete c.$id),O&&w&&this.addMetaSchema(c,c[_],!1)}defaultMeta(){const{meta:w,schemaId:O}=this.opts;return this.opts.defaultMeta=typeof w=="object"?w[O]||w:void 0}validate(w,O){let _;if(typeof w=="string"){if(_=this.getSchema(w),!_)throw new Error(`no schema with key or ref "${w}"`)}else _=this.compile(w);const c=_(O);return"$async"in _||(this.errors=_.errors),c}compile(w,O){const _=this._addSchema(w,O);return _.validate||this._compileSchemaEnv(_)}compileAsync(w,O){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:_}=this.opts;return c.call(this,w,O);async function c(Z,ce){await y.call(this,Z.$schema);const Me=this._addSchema(Z,ce);return Me.validate||N.call(this,Me)}async function y(Z){Z&&!this.getSchema(Z)&&await c.call(this,{$ref:Z},!0)}async function N(Z){try{return this._compileSchemaEnv(Z)}catch(ce){if(!(ce instanceof n.default))throw ce;return D.call(this,ce),await M.call(this,ce.missingSchema),N.call(this,Z)}}function D({missingSchema:Z,missingRef:ce}){if(this.refs[Z])throw new Error(`AnySchema ${Z} is loaded but ${ce} cannot be resolved`)}async function M(Z){const ce=await J.call(this,Z);this.refs[Z]||await y.call(this,ce.$schema),this.refs[Z]||this.addSchema(ce,Z,O)}async function J(Z){const ce=this._loading[Z];if(ce)return ce;try{return await(this._loading[Z]=_(Z))}finally{delete this._loading[Z]}}}addSchema(w,O,_,c=this.opts.validateSchema){if(Array.isArray(w)){for(const N of w)this.addSchema(N,void 0,_,c);return this}let y;if(typeof w=="object"){const{schemaId:N}=this.opts;if(y=w[N],y!==void 0&&typeof y!="string")throw new Error(`schema ${N} must be string`)}return O=(0,f.normalizeId)(O||y),this._checkUnique(O),this.schemas[O]=this._addSchema(w,_,O,c,!0),this}addMetaSchema(w,O,_=this.opts.validateSchema){return this.addSchema(w,O,!0,_),this}validateSchema(w,O){if(typeof w=="boolean")return!0;let _;if(_=w.$schema,_!==void 0&&typeof _!="string")throw new Error("$schema must be a string");if(_=_||this.opts.defaultMeta||this.defaultMeta(),!_)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const c=this.validate(_,w);if(!c&&O){const y="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(y);else throw new Error(y)}return c}getSchema(w){let O;for(;typeof(O=b.call(this,w))=="string";)w=O;if(O===void 0){const{schemaId:_}=this.opts,c=new i.SchemaEnv({schema:{},schemaId:_});if(O=i.resolveSchema.call(this,c,w),!O)return;this.refs[w]=O}return O.validate||this._compileSchemaEnv(O)}removeSchema(w){if(w instanceof RegExp)return this._removeAllSchemas(this.schemas,w),this._removeAllSchemas(this.refs,w),this;switch(typeof w){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const O=b.call(this,w);return typeof O=="object"&&this._cache.delete(O.schema),delete this.schemas[w],delete this.refs[w],this}case"object":{const O=w;this._cache.delete(O);let _=w[this.opts.schemaId];return _&&(_=(0,f.normalizeId)(_),delete this.schemas[_],delete this.refs[_]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(w){for(const O of w)this.addKeyword(O);return this}addKeyword(w,O){let _;if(typeof w=="string")_=w,typeof O=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),O.keyword=_);else if(typeof w=="object"&&O===void 0){if(O=w,_=O.keyword,Array.isArray(_)&&!_.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(pe.call(this,_,O),!O)return(0,d.eachItem)(_,y=>nt.call(this,y)),this;St.call(this,O);const c={...O,type:(0,u.getJSONTypes)(O.type),schemaType:(0,u.getJSONTypes)(O.schemaType)};return(0,d.eachItem)(_,c.type.length===0?y=>nt.call(this,y,c):y=>c.type.forEach(N=>nt.call(this,y,c,N))),this}getKeyword(w){const O=this.RULES.all[w];return typeof O=="object"?O.definition:!!O}removeKeyword(w){const{RULES:O}=this;delete O.keywords[w],delete O.all[w];for(const _ of O.rules){const c=_.rules.findIndex(y=>y.keyword===w);c>=0&&_.rules.splice(c,1)}return this}addFormat(w,O){return typeof O=="string"&&(O=new RegExp(O)),this.formats[w]=O,this}errorsText(w=this.errors,{separator:O=", ",dataVar:_="data"}={}){return!w||w.length===0?"No errors":w.map(c=>`${_}${c.instancePath} ${c.message}`).reduce((c,y)=>c+O+y)}$dataMetaSchema(w,O){const _=this.RULES.all;w=JSON.parse(JSON.stringify(w));for(const c of O){const y=c.split("/").slice(1);let N=w;for(const D of y)N=N[D];for(const D in _){const M=_[D];if(typeof M!="object")continue;const{$data:J}=M.definition,Z=N[D];J&&Z&&(N[D]=Tt(Z))}}return w}_removeAllSchemas(w,O){for(const _ in w){const c=w[_];(!O||O.test(_))&&(typeof c=="string"?delete w[_]:c&&!c.meta&&(this._cache.delete(c.schema),delete w[_]))}}_addSchema(w,O,_,c=this.opts.validateSchema,y=this.opts.addUsedSchema){let N;const{schemaId:D}=this.opts;if(typeof w=="object")N=w[D];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof w!="boolean")throw new Error("schema must be object or boolean")}let M=this._cache.get(w);if(M!==void 0)return M;_=(0,f.normalizeId)(N||_);const J=f.getSchemaRefs.call(this,w,_);return M=new i.SchemaEnv({schema:w,schemaId:D,meta:O,baseId:_,localRefs:J}),this._cache.set(M.schema,M),y&&!_.startsWith("#")&&(_&&this._checkUnique(_),this.refs[_]=M),c&&this.validateSchema(w,!0),M}_checkUnique(w){if(this.schemas[w]||this.refs[w])throw new Error(`schema with key or id "${w}" already exists`)}_compileSchemaEnv(w){if(w.meta?this._compileMetaSchema(w):i.compileSchema.call(this,w),!w.validate)throw new Error("ajv implementation error");return w.validate}_compileMetaSchema(w){const O=this.opts;this.opts=this._metaOpts;try{i.compileSchema.call(this,w)}finally{this.opts=O}}}e.default=R,R.ValidationError=s.default,R.MissingRefError=n.default;function q(A,w,O,_="error"){for(const c in A){const y=c;y in w&&this.logger[_](`${O}: option ${c}. ${A[y]}`)}}function b(A){return A=(0,f.normalizeId)(A),this.schemas[A]||this.refs[A]}function S(){const A=this.opts.schemas;if(A)if(Array.isArray(A))this.addSchema(A);else for(const w in A)this.addSchema(A[w],w)}function I(){for(const A in this.opts.formats){const w=this.opts.formats[A];w&&this.addFormat(A,w)}}function H(A){if(Array.isArray(A)){this.addVocabulary(A);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const w in A){const O=A[w];O.keyword||(O.keyword=w),this.addKeyword(O)}}function G(){const A={...this.opts};for(const w of P)delete A[w];return A}const ae={log(){},warn(){},error(){}};function Y(A){if(A===!1)return ae;if(A===void 0)return console;if(A.log&&A.warn&&A.error)return A;throw new Error("logger must implement log, warn and error methods")}const Se=/^[a-z_$][a-z0-9_$:-]*$/i;function pe(A,w){const{RULES:O}=this;if((0,d.eachItem)(A,_=>{if(O.keywords[_])throw new Error(`Keyword ${_} is already defined`);if(!Se.test(_))throw new Error(`Keyword ${_} has invalid name`)}),!!w&&w.$data&&!("code"in w||"validate"in w))throw new Error('$data keyword must have "code" or "validate" function')}function nt(A,w,O){var _;const c=w==null?void 0:w.post;if(O&&c)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:y}=this;let N=c?y.post:y.rules.find(({type:M})=>M===O);if(N||(N={type:O,rules:[]},y.rules.push(N)),y.keywords[A]=!0,!w)return;const D={keyword:A,definition:{...w,type:(0,u.getJSONTypes)(w.type),schemaType:(0,u.getJSONTypes)(w.schemaType)}};w.before?ot.call(this,N,D,w.before):N.rules.push(D),y.all[A]=D,(_=w.implements)===null||_===void 0||_.forEach(M=>this.addKeyword(M))}function ot(A,w,O){const _=A.rules.findIndex(c=>c.keyword===O);_>=0?A.rules.splice(_,0,w):(A.rules.push(w),this.logger.warn(`rule ${O} is not defined`))}function St(A){let{metaSchema:w}=A;w!==void 0&&(A.$data&&this.opts.$data&&(w=Tt(w)),A.validateSchema=this.compile(w,!0))}const Yt={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function Tt(A){return{anyOf:[A,Yt]}}})(Xo);var Gs={},Js={},Zs={};Object.defineProperty(Zs,"__esModule",{value:!0});const Zl={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};Zs.default=Zl;var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.callRef=Pt.getValidate=void 0;const Yl=br,oo=K,_e=B,At=Ke,io=Pe,Cr=ee,Ql={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:r,it:s}=e,{baseId:n,schemaEnv:o,validateName:i,opts:l,self:f}=s,{root:u}=o;if((r==="#"||r==="#/")&&n===u.baseId)return m();const d=io.resolveRef.call(f,u,n,r);if(d===void 0)throw new Yl.default(s.opts.uriResolver,n,r);if(d instanceof io.SchemaEnv)return $(d);return x(d);function m(){if(o===u)return Ar(e,i,o,o.$async);const P=t.scopeValue("root",{ref:u});return Ar(e,(0,_e._)`${P}.validate`,u,u.$async)}function $(P){const T=Si(e,P);Ar(e,T,P,P.$async)}function x(P){const T=t.scopeValue("schema",l.code.source===!0?{ref:P,code:(0,_e.stringify)(P)}:{ref:P}),v=t.name("valid"),g=e.subschema({schema:P,dataTypes:[],schemaPath:_e.nil,topSchemaRef:T,errSchemaPath:r},v);e.mergeEvaluated(g),e.ok(v)}}};function Si(e,t){const{gen:r}=e;return t.validate?r.scopeValue("validate",{ref:t.validate}):(0,_e._)`${r.scopeValue("wrapper",{ref:t})}.validate`}Pt.getValidate=Si;function Ar(e,t,r,s){const{gen:n,it:o}=e,{allErrors:i,schemaEnv:l,opts:f}=o,u=f.passContext?At.default.this:_e.nil;s?d():m();function d(){if(!l.$async)throw new Error("async schema referenced by sync schema");const P=n.let("valid");n.try(()=>{n.code((0,_e._)`await ${(0,oo.callValidateCode)(e,t,u)}`),x(t),i||n.assign(P,!0)},T=>{n.if((0,_e._)`!(${T} instanceof ${o.ValidationError})`,()=>n.throw(T)),$(T),i||n.assign(P,!1)}),e.ok(P)}function m(){e.result((0,oo.callValidateCode)(e,t,u),()=>x(t),()=>$(t))}function $(P){const T=(0,_e._)`${P}.errors`;n.assign(At.default.vErrors,(0,_e._)`${At.default.vErrors} === null ? ${T} : ${At.default.vErrors}.concat(${T})`),n.assign(At.default.errors,(0,_e._)`${At.default.vErrors}.length`)}function x(P){var T;if(!o.opts.unevaluated)return;const v=(T=r==null?void 0:r.validate)===null||T===void 0?void 0:T.evaluated;if(o.props!==!0)if(v&&!v.dynamicProps)v.props!==void 0&&(o.props=Cr.mergeEvaluated.props(n,v.props,o.props));else{const g=n.var("props",(0,_e._)`${P}.evaluated.props`);o.props=Cr.mergeEvaluated.props(n,g,o.props,_e.Name)}if(o.items!==!0)if(v&&!v.dynamicItems)v.items!==void 0&&(o.items=Cr.mergeEvaluated.items(n,v.items,o.items));else{const g=n.var("items",(0,_e._)`${P}.evaluated.items`);o.items=Cr.mergeEvaluated.items(n,g,o.items,_e.Name)}}}Pt.callRef=Ar;Pt.default=Ql;Object.defineProperty(Js,"__esModule",{value:!0});const Xl=Zs,eu=Pt,tu=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",Xl.default,eu.default];Js.default=tu;var Ys={},Qs={};Object.defineProperty(Qs,"__esModule",{value:!0});const zr=B,Xe=zr.operators,Hr={maximum:{okStr:"<=",ok:Xe.LTE,fail:Xe.GT},minimum:{okStr:">=",ok:Xe.GTE,fail:Xe.LT},exclusiveMaximum:{okStr:"<",ok:Xe.LT,fail:Xe.GTE},exclusiveMinimum:{okStr:">",ok:Xe.GT,fail:Xe.LTE}},ru={message:({keyword:e,schemaCode:t})=>(0,zr.str)`must be ${Hr[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>(0,zr._)`{comparison: ${Hr[e].okStr}, limit: ${t}}`},su={keyword:Object.keys(Hr),type:"number",schemaType:"number",$data:!0,error:ru,code(e){const{keyword:t,data:r,schemaCode:s}=e;e.fail$data((0,zr._)`${r} ${Hr[t].fail} ${s} || isNaN(${r})`)}};Qs.default=su;var Xs={};Object.defineProperty(Xs,"__esModule",{value:!0});const pr=B,nu={message:({schemaCode:e})=>(0,pr.str)`must be multiple of ${e}`,params:({schemaCode:e})=>(0,pr._)`{multipleOf: ${e}}`},ou={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:nu,code(e){const{gen:t,data:r,schemaCode:s,it:n}=e,o=n.opts.multipleOfPrecision,i=t.let("res"),l=o?(0,pr._)`Math.abs(Math.round(${i}) - ${i}) > 1e-${o}`:(0,pr._)`${i} !== parseInt(${i})`;e.fail$data((0,pr._)`(${s} === 0 || (${i} = ${r}/${s}, ${l}))`)}};Xs.default=ou;var en={},tn={};Object.defineProperty(tn,"__esModule",{value:!0});function Ti(e){const t=e.length;let r=0,s=0,n;for(;s<t;)r++,n=e.charCodeAt(s++),n>=55296&&n<=56319&&s<t&&(n=e.charCodeAt(s),(n&64512)===56320&&s++);return r}tn.default=Ti;Ti.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(en,"__esModule",{value:!0});const ht=B,iu=ee,au=tn,cu={message({keyword:e,schemaCode:t}){const r=e==="maxLength"?"more":"fewer";return(0,ht.str)`must NOT have ${r} than ${t} characters`},params:({schemaCode:e})=>(0,ht._)`{limit: ${e}}`},lu={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:cu,code(e){const{keyword:t,data:r,schemaCode:s,it:n}=e,o=t==="maxLength"?ht.operators.GT:ht.operators.LT,i=n.opts.unicode===!1?(0,ht._)`${r}.length`:(0,ht._)`${(0,iu.useFunc)(e.gen,au.default)}(${r})`;e.fail$data((0,ht._)`${i} ${o} ${s}`)}};en.default=lu;var rn={};Object.defineProperty(rn,"__esModule",{value:!0});const uu=K,Vr=B,pu={message:({schemaCode:e})=>(0,Vr.str)`must match pattern "${e}"`,params:({schemaCode:e})=>(0,Vr._)`{pattern: ${e}}`},du={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:pu,code(e){const{data:t,$data:r,schema:s,schemaCode:n,it:o}=e,i=o.opts.unicodeRegExp?"u":"",l=r?(0,Vr._)`(new RegExp(${n}, ${i}))`:(0,uu.usePattern)(e,s);e.fail$data((0,Vr._)`!${l}.test(${t})`)}};rn.default=du;var sn={};Object.defineProperty(sn,"__esModule",{value:!0});const dr=B,hu={message({keyword:e,schemaCode:t}){const r=e==="maxProperties"?"more":"fewer";return(0,dr.str)`must NOT have ${r} than ${t} properties`},params:({schemaCode:e})=>(0,dr._)`{limit: ${e}}`},fu={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:hu,code(e){const{keyword:t,data:r,schemaCode:s}=e,n=t==="maxProperties"?dr.operators.GT:dr.operators.LT;e.fail$data((0,dr._)`Object.keys(${r}).length ${n} ${s}`)}};sn.default=fu;var nn={};Object.defineProperty(nn,"__esModule",{value:!0});const ar=K,hr=B,mu=ee,yu={message:({params:{missingProperty:e}})=>(0,hr.str)`must have required property '${e}'`,params:({params:{missingProperty:e}})=>(0,hr._)`{missingProperty: ${e}}`},gu={keyword:"required",type:"object",schemaType:"array",$data:!0,error:yu,code(e){const{gen:t,schema:r,schemaCode:s,data:n,$data:o,it:i}=e,{opts:l}=i;if(!o&&r.length===0)return;const f=r.length>=l.loopRequired;if(i.allErrors?u():d(),l.strictRequired){const x=e.parentSchema.properties,{definedProperties:P}=e.it;for(const T of r)if((x==null?void 0:x[T])===void 0&&!P.has(T)){const v=i.schemaEnv.baseId+i.errSchemaPath,g=`required property "${T}" is not defined at "${v}" (strictRequired)`;(0,mu.checkStrictMode)(i,g,i.opts.strictRequired)}}function u(){if(f||o)e.block$data(hr.nil,m);else for(const x of r)(0,ar.checkReportMissingProp)(e,x)}function d(){const x=t.let("missing");if(f||o){const P=t.let("valid",!0);e.block$data(P,()=>$(x,P)),e.ok(P)}else t.if((0,ar.checkMissingProp)(e,r,x)),(0,ar.reportMissingProp)(e,x),t.else()}function m(){t.forOf("prop",s,x=>{e.setParams({missingProperty:x}),t.if((0,ar.noPropertyInData)(t,n,x,l.ownProperties),()=>e.error())})}function $(x,P){e.setParams({missingProperty:x}),t.forOf(x,s,()=>{t.assign(P,(0,ar.propertyInData)(t,n,x,l.ownProperties)),t.if((0,hr.not)(P),()=>{e.error(),t.break()})},hr.nil)}}};nn.default=gu;var on={};Object.defineProperty(on,"__esModule",{value:!0});const fr=B,wu={message({keyword:e,schemaCode:t}){const r=e==="maxItems"?"more":"fewer";return(0,fr.str)`must NOT have ${r} than ${t} items`},params:({schemaCode:e})=>(0,fr._)`{limit: ${e}}`},vu={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:wu,code(e){const{keyword:t,data:r,schemaCode:s}=e,n=t==="maxItems"?fr.operators.GT:fr.operators.LT;e.fail$data((0,fr._)`${r}.length ${n} ${s}`)}};on.default=vu;var an={},_r={};Object.defineProperty(_r,"__esModule",{value:!0});const ki=ai;ki.code='require("ajv/dist/runtime/equal").default';_r.default=ki;Object.defineProperty(an,"__esModule",{value:!0});const Es=vr,ye=B,$u=ee,bu=_r,_u={message:({params:{i:e,j:t}})=>(0,ye.str)`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>(0,ye._)`{i: ${e}, j: ${t}}`},Pu={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:_u,code(e){const{gen:t,data:r,$data:s,schema:n,parentSchema:o,schemaCode:i,it:l}=e;if(!s&&!n)return;const f=t.let("valid"),u=o.items?(0,Es.getSchemaTypes)(o.items):[];e.block$data(f,d,(0,ye._)`${i} === false`),e.ok(f);function d(){const P=t.let("i",(0,ye._)`${r}.length`),T=t.let("j");e.setParams({i:P,j:T}),t.assign(f,!0),t.if((0,ye._)`${P} > 1`,()=>(m()?$:x)(P,T))}function m(){return u.length>0&&!u.some(P=>P==="object"||P==="array")}function $(P,T){const v=t.name("item"),g=(0,Es.checkDataTypes)(u,v,l.opts.strictNumbers,Es.DataType.Wrong),E=t.const("indices",(0,ye._)`{}`);t.for((0,ye._)`;${P}--;`,()=>{t.let(v,(0,ye._)`${r}[${P}]`),t.if(g,(0,ye._)`continue`),u.length>1&&t.if((0,ye._)`typeof ${v} == "string"`,(0,ye._)`${v} += "_"`),t.if((0,ye._)`typeof ${E}[${v}] == "number"`,()=>{t.assign(T,(0,ye._)`${E}[${v}]`),e.error(),t.assign(f,!1).break()}).code((0,ye._)`${E}[${v}] = ${P}`)})}function x(P,T){const v=(0,$u.useFunc)(t,bu.default),g=t.name("outer");t.label(g).for((0,ye._)`;${P}--;`,()=>t.for((0,ye._)`${T} = ${P}; ${T}--;`,()=>t.if((0,ye._)`${v}(${r}[${P}], ${r}[${T}])`,()=>{e.error(),t.assign(f,!1).break(g)})))}}};an.default=Pu;var cn={};Object.defineProperty(cn,"__esModule",{value:!0});const Rs=B,Eu=ee,Su=_r,Tu={message:"must be equal to constant",params:({schemaCode:e})=>(0,Rs._)`{allowedValue: ${e}}`},ku={keyword:"const",$data:!0,error:Tu,code(e){const{gen:t,data:r,$data:s,schemaCode:n,schema:o}=e;s||o&&typeof o=="object"?e.fail$data((0,Rs._)`!${(0,Eu.useFunc)(t,Su.default)}(${r}, ${n})`):e.fail((0,Rs._)`${o} !== ${r}`)}};cn.default=ku;var ln={};Object.defineProperty(ln,"__esModule",{value:!0});const cr=B,Cu=ee,Nu=_r,ju={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>(0,cr._)`{allowedValues: ${e}}`},xu={keyword:"enum",schemaType:"array",$data:!0,error:ju,code(e){const{gen:t,data:r,$data:s,schema:n,schemaCode:o,it:i}=e;if(!s&&n.length===0)throw new Error("enum must have non-empty array");const l=n.length>=i.opts.loopEnum;let f;const u=()=>f??(f=(0,Cu.useFunc)(t,Nu.default));let d;if(l||s)d=t.let("valid"),e.block$data(d,m);else{if(!Array.isArray(n))throw new Error("ajv implementation error");const x=t.const("vSchema",o);d=(0,cr.or)(...n.map((P,T)=>$(x,T)))}e.pass(d);function m(){t.assign(d,!1),t.forOf("v",o,x=>t.if((0,cr._)`${u()}(${r}, ${x})`,()=>t.assign(d,!0).break()))}function $(x,P){const T=n[P];return typeof T=="object"&&T!==null?(0,cr._)`${u()}(${r}, ${x}[${P}])`:(0,cr._)`${r} === ${T}`}}};ln.default=xu;Object.defineProperty(Ys,"__esModule",{value:!0});const Ru=Qs,Ou=Xs,Iu=en,qu=rn,Au=sn,Du=nn,Mu=on,Uu=an,Fu=cn,Lu=ln,zu=[Ru.default,Ou.default,Iu.default,qu.default,Au.default,Du.default,Mu.default,Uu.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},Fu.default,Lu.default];Ys.default=zu;var un={},Jt={};Object.defineProperty(Jt,"__esModule",{value:!0});Jt.validateAdditionalItems=void 0;const ft=B,Os=ee,Hu={message:({params:{len:e}})=>(0,ft.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,ft._)`{limit: ${e}}`},Vu={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Hu,code(e){const{parentSchema:t,it:r}=e,{items:s}=t;if(!Array.isArray(s)){(0,Os.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}Ci(e,s)}};function Ci(e,t){const{gen:r,schema:s,data:n,keyword:o,it:i}=e;i.items=!0;const l=r.const("len",(0,ft._)`${n}.length`);if(s===!1)e.setParams({len:t.length}),e.pass((0,ft._)`${l} <= ${t.length}`);else if(typeof s=="object"&&!(0,Os.alwaysValidSchema)(i,s)){const u=r.var("valid",(0,ft._)`${l} <= ${t.length}`);r.if((0,ft.not)(u),()=>f(u)),e.ok(u)}function f(u){r.forRange("i",t.length,l,d=>{e.subschema({keyword:o,dataProp:d,dataPropType:Os.Type.Num},u),i.allErrors||r.if((0,ft.not)(u),()=>r.break())})}}Jt.validateAdditionalItems=Ci;Jt.default=Vu;var pn={},Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.validateTuple=void 0;const ao=B,Dr=ee,Wu=K,Ku={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:r}=e;if(Array.isArray(t))return Ni(e,"additionalItems",t);r.items=!0,!(0,Dr.alwaysValidSchema)(r,t)&&e.ok((0,Wu.validateArray)(e))}};function Ni(e,t,r=e.schema){const{gen:s,parentSchema:n,data:o,keyword:i,it:l}=e;d(n),l.opts.unevaluated&&r.length&&l.items!==!0&&(l.items=Dr.mergeEvaluated.items(s,r.length,l.items));const f=s.name("valid"),u=s.const("len",(0,ao._)`${o}.length`);r.forEach((m,$)=>{(0,Dr.alwaysValidSchema)(l,m)||(s.if((0,ao._)`${u} > ${$}`,()=>e.subschema({keyword:i,schemaProp:$,dataProp:$},f)),e.ok(f))});function d(m){const{opts:$,errSchemaPath:x}=l,P=r.length,T=P===m.minItems&&(P===m.maxItems||m[t]===!1);if($.strictTuples&&!T){const v=`"${i}" is ${P}-tuple, but minItems or maxItems/${t} are not specified or different at path "${x}"`;(0,Dr.checkStrictMode)(l,v,$.strictTuples)}}}Zt.validateTuple=Ni;Zt.default=Ku;Object.defineProperty(pn,"__esModule",{value:!0});const Bu=Zt,Gu={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,Bu.validateTuple)(e,"items")};pn.default=Gu;var dn={};Object.defineProperty(dn,"__esModule",{value:!0});const co=B,Ju=ee,Zu=K,Yu=Jt,Qu={message:({params:{len:e}})=>(0,co.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,co._)`{limit: ${e}}`},Xu={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:Qu,code(e){const{schema:t,parentSchema:r,it:s}=e,{prefixItems:n}=r;s.items=!0,!(0,Ju.alwaysValidSchema)(s,t)&&(n?(0,Yu.validateAdditionalItems)(e,n):e.ok((0,Zu.validateArray)(e)))}};dn.default=Xu;var hn={};Object.defineProperty(hn,"__esModule",{value:!0});const Ne=B,Nr=ee,ep={message:({params:{min:e,max:t}})=>t===void 0?(0,Ne.str)`must contain at least ${e} valid item(s)`:(0,Ne.str)`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>t===void 0?(0,Ne._)`{minContains: ${e}}`:(0,Ne._)`{minContains: ${e}, maxContains: ${t}}`},tp={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:ep,code(e){const{gen:t,schema:r,parentSchema:s,data:n,it:o}=e;let i,l;const{minContains:f,maxContains:u}=s;o.opts.next?(i=f===void 0?1:f,l=u):i=1;const d=t.const("len",(0,Ne._)`${n}.length`);if(e.setParams({min:i,max:l}),l===void 0&&i===0){(0,Nr.checkStrictMode)(o,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(l!==void 0&&i>l){(0,Nr.checkStrictMode)(o,'"minContains" > "maxContains" is always invalid'),e.fail();return}if((0,Nr.alwaysValidSchema)(o,r)){let T=(0,Ne._)`${d} >= ${i}`;l!==void 0&&(T=(0,Ne._)`${T} && ${d} <= ${l}`),e.pass(T);return}o.items=!0;const m=t.name("valid");l===void 0&&i===1?x(m,()=>t.if(m,()=>t.break())):i===0?(t.let(m,!0),l!==void 0&&t.if((0,Ne._)`${n}.length > 0`,$)):(t.let(m,!1),$()),e.result(m,()=>e.reset());function $(){const T=t.name("_valid"),v=t.let("count",0);x(T,()=>t.if(T,()=>P(v)))}function x(T,v){t.forRange("i",0,d,g=>{e.subschema({keyword:"contains",dataProp:g,dataPropType:Nr.Type.Num,compositeRule:!0},T),v()})}function P(T){t.code((0,Ne._)`${T}++`),l===void 0?t.if((0,Ne._)`${T} >= ${i}`,()=>t.assign(m,!0).break()):(t.if((0,Ne._)`${T} > ${l}`,()=>t.assign(m,!1).break()),i===1?t.assign(m,!0):t.if((0,Ne._)`${T} >= ${i}`,()=>t.assign(m,!0)))}}};hn.default=tp;var ji={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=B,r=ee,s=K;e.error={message:({params:{property:f,depsCount:u,deps:d}})=>{const m=u===1?"property":"properties";return(0,t.str)`must have ${m} ${d} when property ${f} is present`},params:({params:{property:f,depsCount:u,deps:d,missingProperty:m}})=>(0,t._)`{property: ${f},
    missingProperty: ${m},
    depsCount: ${u},
    deps: ${d}}`};const n={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(f){const[u,d]=o(f);i(f,u),l(f,d)}};function o({schema:f}){const u={},d={};for(const m in f){if(m==="__proto__")continue;const $=Array.isArray(f[m])?u:d;$[m]=f[m]}return[u,d]}function i(f,u=f.schema){const{gen:d,data:m,it:$}=f;if(Object.keys(u).length===0)return;const x=d.let("missing");for(const P in u){const T=u[P];if(T.length===0)continue;const v=(0,s.propertyInData)(d,m,P,$.opts.ownProperties);f.setParams({property:P,depsCount:T.length,deps:T.join(", ")}),$.allErrors?d.if(v,()=>{for(const g of T)(0,s.checkReportMissingProp)(f,g)}):(d.if((0,t._)`${v} && (${(0,s.checkMissingProp)(f,T,x)})`),(0,s.reportMissingProp)(f,x),d.else())}}e.validatePropertyDeps=i;function l(f,u=f.schema){const{gen:d,data:m,keyword:$,it:x}=f,P=d.name("valid");for(const T in u)(0,r.alwaysValidSchema)(x,u[T])||(d.if((0,s.propertyInData)(d,m,T,x.opts.ownProperties),()=>{const v=f.subschema({keyword:$,schemaProp:T},P);f.mergeValidEvaluated(v,P)},()=>d.var(P,!0)),f.ok(P))}e.validateSchemaDeps=l,e.default=n})(ji);var fn={};Object.defineProperty(fn,"__esModule",{value:!0});const xi=B,rp=ee,sp={message:"property name must be valid",params:({params:e})=>(0,xi._)`{propertyName: ${e.propertyName}}`},np={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:sp,code(e){const{gen:t,schema:r,data:s,it:n}=e;if((0,rp.alwaysValidSchema)(n,r))return;const o=t.name("valid");t.forIn("key",s,i=>{e.setParams({propertyName:i}),e.subschema({keyword:"propertyNames",data:i,dataTypes:["string"],propertyName:i,compositeRule:!0},o),t.if((0,xi.not)(o),()=>{e.error(!0),n.allErrors||t.break()})}),e.ok(o)}};fn.default=np;var gs={};Object.defineProperty(gs,"__esModule",{value:!0});const jr=K,Re=B,op=Ke,xr=ee,ip={message:"must NOT have additional properties",params:({params:e})=>(0,Re._)`{additionalProperty: ${e.additionalProperty}}`},ap={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:ip,code(e){const{gen:t,schema:r,parentSchema:s,data:n,errsCount:o,it:i}=e;if(!o)throw new Error("ajv implementation error");const{allErrors:l,opts:f}=i;if(i.props=!0,f.removeAdditional!=="all"&&(0,xr.alwaysValidSchema)(i,r))return;const u=(0,jr.allSchemaProperties)(s.properties),d=(0,jr.allSchemaProperties)(s.patternProperties);m(),e.ok((0,Re._)`${o} === ${op.default.errors}`);function m(){t.forIn("key",n,v=>{!u.length&&!d.length?P(v):t.if($(v),()=>P(v))})}function $(v){let g;if(u.length>8){const E=(0,xr.schemaRefOrVal)(i,s.properties,"properties");g=(0,jr.isOwnProperty)(t,E,v)}else u.length?g=(0,Re.or)(...u.map(E=>(0,Re._)`${v} === ${E}`)):g=Re.nil;return d.length&&(g=(0,Re.or)(g,...d.map(E=>(0,Re._)`${(0,jr.usePattern)(e,E)}.test(${v})`))),(0,Re.not)(g)}function x(v){t.code((0,Re._)`delete ${n}[${v}]`)}function P(v){if(f.removeAdditional==="all"||f.removeAdditional&&r===!1){x(v);return}if(r===!1){e.setParams({additionalProperty:v}),e.error(),l||t.break();return}if(typeof r=="object"&&!(0,xr.alwaysValidSchema)(i,r)){const g=t.name("valid");f.removeAdditional==="failing"?(T(v,g,!1),t.if((0,Re.not)(g),()=>{e.reset(),x(v)})):(T(v,g),l||t.if((0,Re.not)(g),()=>t.break()))}}function T(v,g,E){const k={keyword:"additionalProperties",dataProp:v,dataPropType:xr.Type.Str};E===!1&&Object.assign(k,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(k,g)}}};gs.default=ap;var mn={};Object.defineProperty(mn,"__esModule",{value:!0});const cp=Ie,lo=K,Ss=ee,uo=gs,lp={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,parentSchema:s,data:n,it:o}=e;o.opts.removeAdditional==="all"&&s.additionalProperties===void 0&&uo.default.code(new cp.KeywordCxt(o,uo.default,"additionalProperties"));const i=(0,lo.allSchemaProperties)(r);for(const m of i)o.definedProperties.add(m);o.opts.unevaluated&&i.length&&o.props!==!0&&(o.props=Ss.mergeEvaluated.props(t,(0,Ss.toHash)(i),o.props));const l=i.filter(m=>!(0,Ss.alwaysValidSchema)(o,r[m]));if(l.length===0)return;const f=t.name("valid");for(const m of l)u(m)?d(m):(t.if((0,lo.propertyInData)(t,n,m,o.opts.ownProperties)),d(m),o.allErrors||t.else().var(f,!0),t.endIf()),e.it.definedProperties.add(m),e.ok(f);function u(m){return o.opts.useDefaults&&!o.compositeRule&&r[m].default!==void 0}function d(m){e.subschema({keyword:"properties",schemaProp:m,dataProp:m},f)}}};mn.default=lp;var yn={};Object.defineProperty(yn,"__esModule",{value:!0});const po=K,Rr=B,ho=ee,fo=ee,up={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,data:s,parentSchema:n,it:o}=e,{opts:i}=o,l=(0,po.allSchemaProperties)(r),f=l.filter(T=>(0,ho.alwaysValidSchema)(o,r[T]));if(l.length===0||f.length===l.length&&(!o.opts.unevaluated||o.props===!0))return;const u=i.strictSchema&&!i.allowMatchingProperties&&n.properties,d=t.name("valid");o.props!==!0&&!(o.props instanceof Rr.Name)&&(o.props=(0,fo.evaluatedPropsToName)(t,o.props));const{props:m}=o;$();function $(){for(const T of l)u&&x(T),o.allErrors?P(T):(t.var(d,!0),P(T),t.if(d))}function x(T){for(const v in u)new RegExp(T).test(v)&&(0,ho.checkStrictMode)(o,`property ${v} matches pattern ${T} (use allowMatchingProperties)`)}function P(T){t.forIn("key",s,v=>{t.if((0,Rr._)`${(0,po.usePattern)(e,T)}.test(${v})`,()=>{const g=f.includes(T);g||e.subschema({keyword:"patternProperties",schemaProp:T,dataProp:v,dataPropType:fo.Type.Str},d),o.opts.unevaluated&&m!==!0?t.assign((0,Rr._)`${m}[${v}]`,!0):!g&&!o.allErrors&&t.if((0,Rr.not)(d),()=>t.break())})})}}};yn.default=up;var gn={};Object.defineProperty(gn,"__esModule",{value:!0});const pp=ee,dp={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:r,it:s}=e;if((0,pp.alwaysValidSchema)(s,r)){e.fail();return}const n=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},n),e.failResult(n,()=>e.reset(),()=>e.error())},error:{message:"must NOT be valid"}};gn.default=dp;var wn={};Object.defineProperty(wn,"__esModule",{value:!0});const hp=K,fp={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:hp.validateUnion,error:{message:"must match a schema in anyOf"}};wn.default=fp;var vn={};Object.defineProperty(vn,"__esModule",{value:!0});const Mr=B,mp=ee,yp={message:"must match exactly one schema in oneOf",params:({params:e})=>(0,Mr._)`{passingSchemas: ${e.passing}}`},gp={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:yp,code(e){const{gen:t,schema:r,parentSchema:s,it:n}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(n.opts.discriminator&&s.discriminator)return;const o=r,i=t.let("valid",!1),l=t.let("passing",null),f=t.name("_valid");e.setParams({passing:l}),t.block(u),e.result(i,()=>e.reset(),()=>e.error(!0));function u(){o.forEach((d,m)=>{let $;(0,mp.alwaysValidSchema)(n,d)?t.var(f,!0):$=e.subschema({keyword:"oneOf",schemaProp:m,compositeRule:!0},f),m>0&&t.if((0,Mr._)`${f} && ${i}`).assign(i,!1).assign(l,(0,Mr._)`[${l}, ${m}]`).else(),t.if(f,()=>{t.assign(i,!0),t.assign(l,m),$&&e.mergeEvaluated($,Mr.Name)})})}}};vn.default=gp;var $n={};Object.defineProperty($n,"__esModule",{value:!0});const wp=ee,vp={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:r,it:s}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");const n=t.name("valid");r.forEach((o,i)=>{if((0,wp.alwaysValidSchema)(s,o))return;const l=e.subschema({keyword:"allOf",schemaProp:i},n);e.ok(n),e.mergeEvaluated(l)})}};$n.default=vp;var bn={};Object.defineProperty(bn,"__esModule",{value:!0});const Wr=B,Ri=ee,$p={message:({params:e})=>(0,Wr.str)`must match "${e.ifClause}" schema`,params:({params:e})=>(0,Wr._)`{failingKeyword: ${e.ifClause}}`},bp={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:$p,code(e){const{gen:t,parentSchema:r,it:s}=e;r.then===void 0&&r.else===void 0&&(0,Ri.checkStrictMode)(s,'"if" without "then" and "else" is ignored');const n=mo(s,"then"),o=mo(s,"else");if(!n&&!o)return;const i=t.let("valid",!0),l=t.name("_valid");if(f(),e.reset(),n&&o){const d=t.let("ifClause");e.setParams({ifClause:d}),t.if(l,u("then",d),u("else",d))}else n?t.if(l,u("then")):t.if((0,Wr.not)(l),u("else"));e.pass(i,()=>e.error(!0));function f(){const d=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},l);e.mergeEvaluated(d)}function u(d,m){return()=>{const $=e.subschema({keyword:d},l);t.assign(i,l),e.mergeValidEvaluated($,i),m?t.assign(m,(0,Wr._)`${d}`):e.setParams({ifClause:d})}}}};function mo(e,t){const r=e.schema[t];return r!==void 0&&!(0,Ri.alwaysValidSchema)(e,r)}bn.default=bp;var _n={};Object.defineProperty(_n,"__esModule",{value:!0});const _p=ee,Pp={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:r}){t.if===void 0&&(0,_p.checkStrictMode)(r,`"${e}" without "if" is ignored`)}};_n.default=Pp;Object.defineProperty(un,"__esModule",{value:!0});const Ep=Jt,Sp=pn,Tp=Zt,kp=dn,Cp=hn,Np=ji,jp=fn,xp=gs,Rp=mn,Op=yn,Ip=gn,qp=wn,Ap=vn,Dp=$n,Mp=bn,Up=_n;function Fp(e=!1){const t=[Ip.default,qp.default,Ap.default,Dp.default,Mp.default,Up.default,jp.default,xp.default,Np.default,Rp.default,Op.default];return e?t.push(Sp.default,kp.default):t.push(Ep.default,Tp.default),t.push(Cp.default),t}un.default=Fp;var Pn={},En={};Object.defineProperty(En,"__esModule",{value:!0});const ue=B,Lp={message:({schemaCode:e})=>(0,ue.str)`must match format "${e}"`,params:({schemaCode:e})=>(0,ue._)`{format: ${e}}`},zp={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:Lp,code(e,t){const{gen:r,data:s,$data:n,schema:o,schemaCode:i,it:l}=e,{opts:f,errSchemaPath:u,schemaEnv:d,self:m}=l;if(!f.validateFormats)return;n?$():x();function $(){const P=r.scopeValue("formats",{ref:m.formats,code:f.code.formats}),T=r.const("fDef",(0,ue._)`${P}[${i}]`),v=r.let("fType"),g=r.let("format");r.if((0,ue._)`typeof ${T} == "object" && !(${T} instanceof RegExp)`,()=>r.assign(v,(0,ue._)`${T}.type || "string"`).assign(g,(0,ue._)`${T}.validate`),()=>r.assign(v,(0,ue._)`"string"`).assign(g,T)),e.fail$data((0,ue.or)(E(),k()));function E(){return f.strictSchema===!1?ue.nil:(0,ue._)`${i} && !${g}`}function k(){const R=d.$async?(0,ue._)`(${T}.async ? await ${g}(${s}) : ${g}(${s}))`:(0,ue._)`${g}(${s})`,q=(0,ue._)`(typeof ${g} == "function" ? ${R} : ${g}.test(${s}))`;return(0,ue._)`${g} && ${g} !== true && ${v} === ${t} && !${q}`}}function x(){const P=m.formats[o];if(!P){E();return}if(P===!0)return;const[T,v,g]=k(P);T===t&&e.pass(R());function E(){if(f.strictSchema===!1){m.logger.warn(q());return}throw new Error(q());function q(){return`unknown format "${o}" ignored in schema at path "${u}"`}}function k(q){const b=q instanceof RegExp?(0,ue.regexpCode)(q):f.code.formats?(0,ue._)`${f.code.formats}${(0,ue.getProperty)(o)}`:void 0,S=r.scopeValue("formats",{key:o,ref:q,code:b});return typeof q=="object"&&!(q instanceof RegExp)?[q.type||"string",q.validate,(0,ue._)`${S}.validate`]:["string",q,S]}function R(){if(typeof P=="object"&&!(P instanceof RegExp)&&P.async){if(!d.$async)throw new Error("async format in sync schema");return(0,ue._)`await ${g}(${s})`}return typeof v=="function"?(0,ue._)`${g}(${s})`:(0,ue._)`${g}.test(${s})`}}}};En.default=zp;Object.defineProperty(Pn,"__esModule",{value:!0});const Hp=En,Vp=[Hp.default];Pn.default=Vp;var Gt={};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.contentVocabulary=Gt.metadataVocabulary=void 0;Gt.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];Gt.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(Gs,"__esModule",{value:!0});const Wp=Js,Kp=Ys,Bp=un,Gp=Pn,yo=Gt,Jp=[Wp.default,Kp.default,(0,Bp.default)(),Gp.default,yo.metadataVocabulary,yo.contentVocabulary];Gs.default=Jp;var Sn={},Oi={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiscrError=void 0,function(t){t.Tag="tag",t.Mapping="mapping"}(e.DiscrError||(e.DiscrError={}))})(Oi);Object.defineProperty(Sn,"__esModule",{value:!0});const Dt=B,Is=Oi,go=Pe,Zp=ee,Yp={message:({params:{discrError:e,tagName:t}})=>e===Is.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:r}})=>(0,Dt._)`{error: ${e}, tag: ${r}, tagValue: ${t}}`},Qp={keyword:"discriminator",type:"object",schemaType:"object",error:Yp,code(e){const{gen:t,data:r,schema:s,parentSchema:n,it:o}=e,{oneOf:i}=n;if(!o.opts.discriminator)throw new Error("discriminator: requires discriminator option");const l=s.propertyName;if(typeof l!="string")throw new Error("discriminator: requires propertyName");if(s.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");const f=t.let("valid",!1),u=t.const("tag",(0,Dt._)`${r}${(0,Dt.getProperty)(l)}`);t.if((0,Dt._)`typeof ${u} == "string"`,()=>d(),()=>e.error(!1,{discrError:Is.DiscrError.Tag,tag:u,tagName:l})),e.ok(f);function d(){const x=$();t.if(!1);for(const P in x)t.elseIf((0,Dt._)`${u} === ${P}`),t.assign(f,m(x[P]));t.else(),e.error(!1,{discrError:Is.DiscrError.Mapping,tag:u,tagName:l}),t.endIf()}function m(x){const P=t.name("valid"),T=e.subschema({keyword:"oneOf",schemaProp:x},P);return e.mergeEvaluated(T,Dt.Name),P}function $(){var x;const P={},T=g(n);let v=!0;for(let R=0;R<i.length;R++){let q=i[R];q!=null&&q.$ref&&!(0,Zp.schemaHasRulesButRef)(q,o.self.RULES)&&(q=go.resolveRef.call(o.self,o.schemaEnv.root,o.baseId,q==null?void 0:q.$ref),q instanceof go.SchemaEnv&&(q=q.schema));const b=(x=q==null?void 0:q.properties)===null||x===void 0?void 0:x[l];if(typeof b!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${l}"`);v=v&&(T||g(q)),E(b,R)}if(!v)throw new Error(`discriminator: "${l}" must be required`);return P;function g({required:R}){return Array.isArray(R)&&R.includes(l)}function E(R,q){if(R.const)k(R.const,q);else if(R.enum)for(const b of R.enum)k(b,q);else throw new Error(`discriminator: "properties/${l}" must have "const" or "enum"`)}function k(R,q){if(typeof R!="string"||R in P)throw new Error(`discriminator: "${l}" values must be unique strings`);P[R]=q}}}};Sn.default=Qp;const Xp="http://json-schema.org/draft-07/schema#",ed="http://json-schema.org/draft-07/schema#",td="Core schema meta-schema",rd={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},sd=["object","boolean"],nd={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},od={$schema:Xp,$id:ed,title:td,definitions:rd,type:sd,properties:nd,default:!0};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const r=Xo,s=Gs,n=Sn,o=od,i=["/properties"],l="http://json-schema.org/draft-07/schema";class f extends r.default{_addVocabularies(){super._addVocabularies(),s.default.forEach(P=>this.addVocabulary(P)),this.opts.discriminator&&this.addKeyword(n.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const P=this.opts.$data?this.$dataMetaSchema(o,i):o;this.addMetaSchema(P,l,!1),this.refs["http://json-schema.org/schema"]=l}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(l)?l:void 0)}}e.exports=t=f,Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;var u=Ie;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return u.KeywordCxt}});var d=B;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var m=$r;Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return m.default}});var $=br;Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return $.default}})})(Cs,Cs.exports);var id=Cs.exports;const ad=mc(id),cd="http://json-schema.org/schema",ld="#/definitions/Blueprint",ud={Blueprint:{type:"object",properties:{landingPage:{type:"string",description:"The URL to navigate to after the blueprint has been run."},preferredVersions:{type:"object",properties:{php:{anyOf:[{$ref:"#/definitions/SupportedPHPVersion"},{type:"string",const:"latest"}],description:"The preferred PHP version to use. If not specified, the latest supported version will be used"},wp:{type:"string",description:"The preferred WordPress version to use. If not specified, the latest supported version will be used"}},required:["php","wp"],additionalProperties:!1,description:"The preferred PHP and WordPress versions to use."},phpExtensionBundles:{type:"array",items:{$ref:"#/definitions/SupportedPHPExtensionBundle"},description:"The PHP extensions to use."},steps:{type:"array",items:{anyOf:[{$ref:"#/definitions/StepDefinition"},{type:"string"},{not:{}},{type:"boolean",const:!1},{type:"null"}]},description:"The steps to run."},$schema:{type:"string"}},additionalProperties:!1},SupportedPHPVersion:{type:"string",enum:["8.2","8.1","8.0","7.4","7.3","7.2","7.1","7.0","5.6"]},SupportedPHPExtensionBundle:{type:"string",const:"kitchen-sink"},StepDefinition:{type:"object",discriminator:{propertyName:"step"},required:["step"],oneOf:[{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"activatePlugin"},pluginPath:{type:"string",description:"Path to the plugin directory as absolute path (/wordpress/wp-content/plugins/plugin-name); or the plugin entry file relative to the plugins directory (plugin-name/plugin-name.php)."},pluginName:{type:"string",description:"Optional. Plugin name to display in the progress bar."}},required:["pluginPath","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"activateTheme"},themeFolderName:{type:"string",description:"The name of the theme folder inside wp-content/themes/"}},required:["step","themeFolderName"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"applyWordPressPatches"},siteUrl:{type:"string"},wordpressPath:{type:"string"},addPhpInfo:{type:"boolean"},patchSecrets:{type:"boolean"},disableSiteHealth:{type:"boolean"},disableWpNewBlogNotification:{type:"boolean"},makeEditorFrameControlled:{type:"boolean"},prepareForRunningInsideWebBrowser:{type:"boolean"}},required:["step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"cp"},fromPath:{type:"string",description:"Source path"},toPath:{type:"string",description:"Target path"}},required:["fromPath","step","toPath"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"defineWpConfigConsts"},consts:{type:"object",additionalProperties:{},description:"The constants to define"},virtualize:{type:"boolean",description:"Enables the virtualization of wp-config.php and playground-consts.json files, leaving the local system files untouched. The variables defined in the /vfs-blueprints/playground-consts.json file are loaded via the auto_prepend_file directive in the php.ini file.",default:!1}},required:["consts","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"defineSiteUrl"},siteUrl:{type:"string",description:"The URL"}},required:["siteUrl","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"importFile"},file:{$ref:"#/definitions/FileReference",description:"The file to import"}},required:["file","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"installPlugin",description:"The step identifier."},pluginZipFile:{$ref:"#/definitions/FileReference",description:"The plugin zip file to install."},options:{$ref:"#/definitions/InstallPluginOptions",description:"Optional installation options."}},required:["pluginZipFile","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"installTheme",description:"The step identifier."},themeZipFile:{$ref:"#/definitions/FileReference",description:"The theme zip file to install."},options:{type:"object",properties:{activate:{type:"boolean",description:"Whether to activate the theme after installing it."}},additionalProperties:!1,description:"Optional installation options."}},required:["step","themeZipFile"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"login"},username:{type:"string",description:"The user to log in as. Defaults to 'admin'."},password:{type:"string",description:"The password to log in with. Defaults to 'password'."}},required:["step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"mkdir"},path:{type:"string",description:"The path of the directory you want to create"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"mv"},fromPath:{type:"string",description:"Source path"},toPath:{type:"string",description:"Target path"}},required:["fromPath","step","toPath"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"request"},request:{$ref:"#/definitions/PHPRequest",description:"Request details (See /wordpress-playground/api/universal/interface/PHPRequest)"}},required:["request","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"replaceSite"},fullSiteZip:{$ref:"#/definitions/FileReference",description:"The zip file containing the new WordPress site"}},required:["fullSiteZip","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"rm"},path:{type:"string",description:"The path to remove"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"rmdir"},path:{type:"string",description:"The path to remove"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runPHP",description:"The step identifier."},code:{type:"string",description:"The PHP code to run."}},required:["code","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runPHPWithOptions"},options:{$ref:"#/definitions/PHPRunOptions",description:"Run options (See /wordpress-playground/api/universal/interface/PHPRunOptions)"}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runWpInstallationWizard"},options:{$ref:"#/definitions/WordPressInstallationOptions"}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"setPhpIniEntry"},key:{type:"string",description:'Entry name e.g. "display_errors"'},value:{type:"string",description:'Entry value as a string e.g. "1"'}},required:["key","step","value"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"setSiteOptions",description:'The name of the step. Must be "setSiteOptions".'},options:{type:"object",additionalProperties:{},description:"The options to set on the site."}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"unzip"},zipPath:{type:"string",description:"The zip file to extract"},extractToPath:{type:"string",description:"The path to extract the zip file to"}},required:["extractToPath","step","zipPath"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"updateUserMeta"},meta:{type:"object",additionalProperties:{},description:'An object of user meta values to set, e.g. { "first_name": "John" }'},userId:{type:"number",description:"User ID"}},required:["meta","step","userId"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"writeFile"},path:{type:"string",description:"The path of the file to write to"},data:{anyOf:[{$ref:"#/definitions/FileReference"},{type:"string"},{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}],description:"The data to write"}},required:["data","path","step"]}]},FileReference:{anyOf:[{$ref:"#/definitions/VFSReference"},{$ref:"#/definitions/LiteralReference"},{$ref:"#/definitions/CoreThemeReference"},{$ref:"#/definitions/CorePluginReference"},{$ref:"#/definitions/UrlReference"}]},VFSReference:{type:"object",properties:{resource:{type:"string",const:"vfs",description:"Identifies the file resource as Virtual File System (VFS)"},path:{type:"string",description:"The path to the file in the VFS"}},required:["resource","path"],additionalProperties:!1},LiteralReference:{type:"object",properties:{resource:{type:"string",const:"literal",description:"Identifies the file resource as a literal file"},name:{type:"string",description:"The name of the file"},contents:{anyOf:[{type:"string"},{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}],description:"The contents of the file"}},required:["resource","name","contents"],additionalProperties:!1},CoreThemeReference:{type:"object",properties:{resource:{type:"string",const:"wordpress.org/themes",description:"Identifies the file resource as a WordPress Core theme"},slug:{type:"string",description:"The slug of the WordPress Core theme"}},required:["resource","slug"],additionalProperties:!1},CorePluginReference:{type:"object",properties:{resource:{type:"string",const:"wordpress.org/plugins",description:"Identifies the file resource as a WordPress Core plugin"},slug:{type:"string",description:"The slug of the WordPress Core plugin"}},required:["resource","slug"],additionalProperties:!1},UrlReference:{type:"object",properties:{resource:{type:"string",const:"url",description:"Identifies the file resource as a URL"},url:{type:"string",description:"The URL of the file"},caption:{type:"string",description:"Optional caption for displaying a progress message"}},required:["resource","url"],additionalProperties:!1},InstallPluginOptions:{type:"object",properties:{activate:{type:"boolean",description:"Whether to activate the plugin after installing it."}},additionalProperties:!1},PHPRequest:{type:"object",properties:{method:{$ref:"#/definitions/HTTPMethod",description:"Request method. Default: `GET`."},url:{type:"string",description:"Request path or absolute URL."},headers:{$ref:"#/definitions/PHPRequestHeaders",description:"Request headers."},files:{type:"object",additionalProperties:{type:"object",properties:{size:{type:"number"},type:{type:"string"},lastModified:{type:"number"},name:{type:"string"},webkitRelativePath:{type:"string"}},required:["lastModified","name","size","type","webkitRelativePath"],additionalProperties:!1},description:"Uploaded files"},body:{type:"string",description:"Request body without the files."},formData:{type:"object",additionalProperties:{},description:"Form data. If set, the request body will be ignored and the content-type header will be set to `application/x-www-form-urlencoded`."}},required:["url"],additionalProperties:!1},HTTPMethod:{type:"string",enum:["GET","POST","HEAD","OPTIONS","PATCH","PUT","DELETE"]},PHPRequestHeaders:{type:"object",additionalProperties:{type:"string"}},PHPRunOptions:{type:"object",properties:{relativeUri:{type:"string",description:"Request path following the domain:port part."},scriptPath:{type:"string",description:"Path of the .php file to execute."},protocol:{type:"string",description:"Request protocol."},method:{$ref:"#/definitions/HTTPMethod",description:"Request method. Default: `GET`."},headers:{$ref:"#/definitions/PHPRequestHeaders",description:"Request headers."},body:{type:"string",description:"Request body without the files."},fileInfos:{type:"array",items:{$ref:"#/definitions/FileInfo"},description:"Uploaded files."},code:{type:"string",description:"The code snippet to eval instead of a php file."}},additionalProperties:!1},FileInfo:{type:"object",properties:{key:{type:"string"},name:{type:"string"},type:{type:"string"},data:{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}},required:["key","name","type","data"],additionalProperties:!1},WordPressInstallationOptions:{type:"object",properties:{adminUsername:{type:"string"},adminPassword:{type:"string"}},additionalProperties:!1}},pd={$schema:cd,$ref:ld,definitions:ud};function dd(e,{progress:t=new hs,semaphore:r=new ko({concurrency:3}),onStepCompleted:s=()=>{}}={}){var u,d;e={...e,steps:(e.steps||[]).filter(gd)};const{valid:n,errors:o}=fd(e);if(!n){const m=new Error(`Invalid blueprint: ${o[0].message} at ${o[0].instancePath}`);throw m.errors=o,m}const i=e.steps||[],l=i.reduce((m,$)=>{var x;return m+(((x=$.progress)==null?void 0:x.weight)||1)},0),f=i.map(m=>wd(m,{semaphore:r,rootProgressTracker:t,totalProgressWeight:l}));return{versions:{php:md((u=e.preferredVersions)==null?void 0:u.php,xo,Va),wp:((d=e.preferredVersions)==null?void 0:d.wp)||"latest"},phpExtensions:yd([],e.phpExtensionBundles||[]),run:async m=>{try{for(const{resources:$}of f)for(const x of $)x.setPlayground(m),x.isAsync&&x.resolve();for(const{run:$,step:x}of f){const P=await $(m);s(P,x)}}finally{try{await m.goTo(e.landingPage||"/")}catch{}t.finish()}}}}const hd=new ad({discriminator:!0});let Or;function fd(e){var n;Or=hd.compile(pd);const t=Or(e);if(t)return{valid:t};const r=new Set;for(const o of Or.errors)o.schemaPath.startsWith("#/properties/steps/items/anyOf")||r.add(o.instancePath);const s=(n=Or.errors)==null?void 0:n.filter(o=>!(o.schemaPath.startsWith("#/properties/steps/items/anyOf")&&r.has(o.instancePath)));return{valid:t,errors:s}}function md(e,t,r){return e&&t.includes(e)?e:r}function yd(e,t){const r=Ro.filter(n=>e.includes(n)),s=t.flatMap(n=>n in Gn?Gn[n]:[]);return Array.from(new Set([...r,...s]))}function gd(e){return!!(typeof e=="object"&&e)}function wd(e,{semaphore:t,rootProgressTracker:r,totalProgressWeight:s}){var d;const n=r.stage((((d=e.progress)==null?void 0:d.weight)||1)/s),o={};for(const m of Object.keys(e)){let $=e[m];oc($)&&($=Et.create($,{semaphore:t})),o[m]=$}const i=async m=>{var $;try{return n.fillSlowly(),await xa[e.step](m,await vd(o),{tracker:n,initialCaption:($=e.progress)==null?void 0:$.caption})}finally{n.finish()}},l=wo(o),f=wo(o).filter(m=>m.isAsync),u=1/(f.length+1);for(const m of f)m.progress=n.stage(u);return{run:i,step:e,resources:l}}function wo(e){const t=[];for(const r in e){const s=e[r];s instanceof Et&&t.push(s)}return t}async function vd(e){const t={};for(const r in e){const s=e[r];s instanceof Et?t[r]=await s.resolve():t[r]=s}return t}async function $d(e,t){await e.run(t)}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ii=Symbol("Comlink.proxy"),bd=Symbol("Comlink.endpoint"),_d=Symbol("Comlink.releaseProxy"),Ts=Symbol("Comlink.finalizer"),Ur=Symbol("Comlink.thrown"),qi=e=>typeof e=="object"&&e!==null||typeof e=="function",Pd={canHandle:e=>qi(e)&&e[Ii],serialize(e){const{port1:t,port2:r}=new MessageChannel;return Tn(e,t),[r,[r]]},deserialize(e){return e.start(),kn(e)}},Ed={canHandle:e=>qi(e)&&Ur in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},mr=new Map([["proxy",Pd],["throw",Ed]]);function Sd(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function Tn(e,t=globalThis,r=["*"]){t.addEventListener("message",function s(n){if(!n||!n.data)return;if(!Sd(r,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:o,type:i,path:l}=Object.assign({path:[]},n.data),f=(n.data.argumentList||[]).map(mt);let u;try{const d=l.slice(0,-1).reduce(($,x)=>$[x],e),m=l.reduce(($,x)=>$[x],e);switch(i){case"GET":u=m;break;case"SET":d[l.slice(-1)[0]]=mt(n.data.value),u=!0;break;case"APPLY":u=m.apply(d,f);break;case"CONSTRUCT":{const $=new m(...f);u=Ui($)}break;case"ENDPOINT":{const{port1:$,port2:x}=new MessageChannel;Tn(e,x),u=jd($,[$])}break;case"RELEASE":u=void 0;break;default:return}}catch(d){u={value:d,[Ur]:0}}Promise.resolve(u).catch(d=>({value:d,[Ur]:0})).then(d=>{const[m,$]=Gr(d);t.postMessage(Object.assign(Object.assign({},m),{id:o}),$),i==="RELEASE"&&(t.removeEventListener("message",s),Ai(t),Ts in e&&typeof e[Ts]=="function"&&e[Ts]())}).catch(d=>{const[m,$]=Gr({value:new TypeError("Unserializable return value"),[Ur]:0});t.postMessage(Object.assign(Object.assign({},m),{id:o}),$)})}),t.start&&t.start()}function Td(e){return e.constructor.name==="MessagePort"}function Ai(e){Td(e)&&e.close()}function kn(e,t){return qs(e,[],t)}function Ir(e){if(e)throw new Error("Proxy has been released and is not useable")}function Di(e){return Mt(e,{type:"RELEASE"}).then(()=>{Ai(e)})}const Kr=new WeakMap,Br="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(Kr.get(e)||0)-1;Kr.set(e,t),t===0&&Di(e)});function kd(e,t){const r=(Kr.get(t)||0)+1;Kr.set(t,r),Br&&Br.register(e,t,e)}function Cd(e){Br&&Br.unregister(e)}function qs(e,t=[],r=function(){}){let s=!1;const n=new Proxy(r,{get(o,i){if(Ir(s),i===_d)return()=>{Cd(n),Di(e),s=!0};if(i==="then"){if(t.length===0)return{then:()=>n};const l=Mt(e,{type:"GET",path:t.map(f=>f.toString())}).then(mt);return l.then.bind(l)}return qs(e,[...t,i])},set(o,i,l){Ir(s);const[f,u]=Gr(l);return Mt(e,{type:"SET",path:[...t,i].map(d=>d.toString()),value:f},u).then(mt)},apply(o,i,l){Ir(s);const f=t[t.length-1];if(f===bd)return Mt(e,{type:"ENDPOINT"}).then(mt);if(f==="bind")return qs(e,t.slice(0,-1));const[u,d]=vo(l);return Mt(e,{type:"APPLY",path:t.map(m=>m.toString()),argumentList:u},d).then(mt)},construct(o,i){Ir(s);const[l,f]=vo(i);return Mt(e,{type:"CONSTRUCT",path:t.map(u=>u.toString()),argumentList:l},f).then(mt)}});return kd(n,e),n}function Nd(e){return Array.prototype.concat.apply([],e)}function vo(e){const t=e.map(Gr);return[t.map(r=>r[0]),Nd(t.map(r=>r[1]))]}const Mi=new WeakMap;function jd(e,t){return Mi.set(e,t),e}function Ui(e){return Object.assign(e,{[Ii]:!0})}function xd(e,t=globalThis,r="*"){return{postMessage:(s,n)=>e.postMessage(s,r,n),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function Gr(e){for(const[t,r]of mr)if(r.canHandle(e)){const[s,n]=r.serialize(e);return[{type:"HANDLER",name:t,value:s},n]}return[{type:"RAW",value:e},Mi.get(e)||[]]}function mt(e){switch(e.type){case"HANDLER":return mr.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Mt(e,t,r){return new Promise(s=>{const n=Rd();e.addEventListener("message",function o(i){!i.data||!i.data.id||i.data.id!==n||(e.removeEventListener("message",o),s(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:n},t),r)})}function Rd(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function Od(e){qd();const t=e instanceof Worker?e:xd(e),r=kn(t),s=Fi(r);return new Proxy(s,{get:(n,o)=>o==="isConnected"?async()=>{for(let i=0;i<10;i++)try{await Id(r.isConnected(),200);break}catch{}}:r[o]})}async function Id(e,t){return new Promise((r,s)=>{setTimeout(s,t),e.then(r)})}let $o=!1;function qd(){$o||($o=!0,mr.set("EVENT",{canHandle:e=>e instanceof CustomEvent,serialize:e=>[{detail:e.detail},[]],deserialize:e=>e}),mr.set("FUNCTION",{canHandle:e=>typeof e=="function",serialize(e){console.debug("[Comlink][Performance] Proxying a function");const{port1:t,port2:r}=new MessageChannel;return Tn(e,t),[r,[r]]},deserialize(e){return e.start(),kn(e)}}),mr.set("PHPResponse",{canHandle:e=>typeof e=="object"&&e!==null&&"headers"in e&&"bytes"in e&&"errors"in e&&"exitCode"in e&&"httpStatusCode"in e,serialize(e){return[e.toRawData(),[]]},deserialize(e){return bt.fromRawData(e)}}))}function Fi(e){return new Proxy(e,{get(t,r){switch(typeof t[r]){case"function":return(...s)=>t[r](...s);case"object":return t[r]===null?t[r]:Fi(t[r]);case"undefined":case"number":case"string":return t[r];default:return Ui(t[r])}}})}async function Ad({iframe:e,blueprint:t,remoteUrl:r,progressTracker:s=new hs,disableProgressBar:n,onBlueprintStepCompleted:o}){if(Md(r),Dd(e),r=_o(r,{progressbar:!n}),s.setCaption("Preparing WordPress"),!t)return bo(e,r,s);const i=dd(t,{progress:s.stage(.5),onStepCompleted:o}),l=await bo(e,_o(r,{php:i.versions.php,wp:i.versions.wp,["php-extension"]:i.phpExtensions}),s);return await $d(i,l),s.finish(),l}function Dd(e){var t,r;(t=e.sandbox)!=null&&t.length&&!((r=e.sandbox)!=null&&r.contains("allow-storage-access-by-user-activation"))&&e.sandbox.add("allow-storage-access-by-user-activation")}async function bo(e,t,r){await new Promise(o=>{e.src=t,e.addEventListener("load",o,!1)});const s=Od(e.contentWindow);await s.isConnected(),r.pipe(s);const n=r.stage();return await s.onDownloadProgress(n.loadingListener),await s.isReady(),n.finish(),s}const Fr="https://playground.wordpress.net";function Md(e){const t=new URL(e,Fr);if((t.origin===Fr||t.hostname==="localhost")&&t.pathname!=="/remote.html")throw new Error(`Invalid remote URL: ${t}. Expected origin to be ${Fr}/remote.html.`)}function _o(e,t){const r=new URL(e,Fr),s=new URLSearchParams(r.search);for(const[n,o]of Object.entries(t))if(o!=null&&o!==!1)if(Array.isArray(o))for(const i of o)s.append(n,i.toString());else s.set(n,o.toString());return r.search=s.toString(),r.toString()}async function Ud(){const e=document.getElementById("root"),t=Fd(e),s=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"'dark'":"'light'";await Ad({iframe:t,remoteUrl:"https://playground.wordpress.net/remote.html",blueprint:{landingPage:"/wp-admin/",preferredVersions:{php:"8.0",wp:"latest"},steps:[{step:"runPHP",code:`<?php require_once 'wordpress/wp-load.php'; update_option('fbwpmdp_theme', ${s}); ?>`},{step:"login",username:"admin",password:"password"},{step:"setSiteOptions",options:{WPLANG:"en",permalink_structure:"/%postname%/",gp_enable_local_translation:1,gp_enable_inline_translation:1}},{step:"updateUserMeta",meta:{show_welcome_panel:"1"},userId:1},{step:"installPlugin",pluginZipFile:{resource:"wordpress.org/plugins",slug:"material-board"}}]}})}function Fd(e){const t=document.createElement("iframe");return t.title="Playground Viewport",t.className="playground__viewport--full-size",e.appendChild(t),t}Ud();
